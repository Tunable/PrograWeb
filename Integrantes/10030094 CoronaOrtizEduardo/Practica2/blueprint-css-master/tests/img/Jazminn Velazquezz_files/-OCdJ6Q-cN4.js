/*!CK:1294622405!*//*1379540872,173224501*/

if (self.CavalryLogger) { CavalryLogger.start_js(["ulQoJ"]); }

__d("FileInputUploader",["ArbiterMixin","DOM","Env","FileForm","Form","copyProperties","mixin","submitForm"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('DOM'),i=b('Env'),j=b('FileForm'),k=b('Form'),l=b('copyProperties'),m=b('mixin'),n=b('submitForm'),o=m(g);for(var p in o)if(o.hasOwnProperty(p))r[p]=o[p];var q=o===null?null:o.prototype;r.prototype=Object.create(q);r.prototype.constructor=r;r.__superConstructor__=o;function r(s){this._inputElem=s;this._data={};}r.prototype.setInput=function(s){this._inputElem=s;return this;};r.prototype.setURI=function(s){this._uri=s;return this;};r.prototype.setData=function(s){this._data=s;return this;};r.prototype.setFiles=function(s){this._files=s;return this;};r.prototype.setAllowCrossOrigin=function(s){this._allowCrossOrigin=!!s;return this;};r.prototype.setUploadInParallel=function(s){this._uploadInParallel=!!s;return this;};r.prototype.send=function(){this._createForm();var s=this._inputElem.cloneNode(false);h.replace(this._inputElem,s);h.appendContent(this._formElem,this._inputElem);h.appendContent(document.body,this._formElem);n(this._formElem);h.replace(s,this._inputElem);this._cleanup();};r.prototype._onFileFormEvent=function(s,t){this.inform(s,t);};r.prototype._createForm=function(){this._formElem=h.create('form',{action:this._uri,method:'post'});this._fileForm=new j(this._formElem,null,{allowCrossOrigin:this._allowCrossOrigin,uploadInParallel:this._uploadInParallel});if(this._files)this._fileForm.setFiles(this._files);this._fileForm.subscribe(j.EVENTS,this._onFileFormEvent.bind(this));k.createHiddenInputs(l({fb_dtsg:i.fb_dtsg},this._data),this._formElem);};r.prototype._cleanup=function(){this._fileForm.destroy();this._fileForm=null;h.remove(this._formElem);this._formElem=null;};l(r.prototype,{_formElem:null,_fileForm:null,_uri:null,_files:null,_allowCrossOrigin:false,_uploadInParallel:false});e.exports=r;});
__d("PhotosUploadWaterfallX",["AsyncSignal","PhotosUploadWaterfallXConfig"],function(a,b,c,d,e,f){var g=b('AsyncSignal'),h=b('PhotosUploadWaterfallXConfig'),i={WEB_SIMPLE:'web_simple',WEB_FLASH:'web_flash',WEB_HTML5:'web_html5',WEB_COMPOSER:'web_composer',WEB_ARCHIVE:'web_archive',WEB_MESSENGER:'web_messenger',MOBILE_FB4IOS:'mobile_fb4ios',MOBILE_FB4A:'mobile_fb4a',THIRD_PARTY:'third_party',CLIENT_FLOW_BEGIN:'client_flow_begin',CLIENT_FLOW_POST:'client_flow_post',CLIENT_FLOW_SUCCESS:'client_flow_success',CLIENT_FLOW_CANCEL:'client_flow_cancel',CLIENT_FLOW_FAIL:'client_flow_fail',CLIENT_SELECT_BEGIN:'client_select_begin',CLIENT_SELECT_SUCCESS:'client_select_success',CLIENT_SELECT_CANCEL:'client_select_cancel',CLIENT_SELECT_FAIL:'client_select_fail',CLIENT_PROCESS_BEGIN:'client_process_begin',CLIENT_PROCESS_SUCCESS:'client_process_success',CLIENT_PROCESS_CANCEL:'client_process_cancel',CLIENT_PROCESS_FAIL:'client_process_fail',CLIENT_TRANSFER_BEGIN:'client_transfer_begin',CLIENT_TRANSFER_SUCCESS:'client_transfer_success',CLIENT_TRANSFER_CANCEL:'client_transfer_cancel',CLIENT_TRANSFER_FAIL:'client_transfer_fail',CLIENT_RECEIVE_FBID_SUCCESS:'client_receive_fbid_success',CLIENT_RECEIVE_FBID_FAIL:'client_receive_fbid_fail',CLIENT_TRANSFER_BATCH_BEGIN:'client_transfer_batch_begin',CLIENT_TRANSFER_BATCH_SUCCESS:'client_transfer_batch_success',CLIENT_TRANSFER_BATCH_CANCEL:'client_transfer_batch_cancel',CLIENT_TRANSFER_BATCH_FAIL:'client_transfer_batch_fail',CLIENT_PUBLISH_BEGIN:'client_publish_begin',CLIENT_PUBLISH_SUCCESS:'client_publish_success',CLIENT_PUBLISH_FAIL:'client_publish_fail',METHOD_DRAGDROP:'dragdrop',METHOD_FILE_SELECTOR:'file_selector',METHOD_VAULT:'vault',METHOD_PHOTOS_OF_YOU:'photos_of_you',METHOD_RECENT_PHOTOS:'recent_photos',METHOD_EDITOR:'editor',sendSignal:function(j,k){new g(h.loggingEndpoint,{data:JSON.stringify(j)}).setHandler(k).send();}};e.exports=i;});
__d("PhotosUploadWaterfallXMixin",["PhotosUploadWaterfallX","copyProperties"],function(a,b,c,d,e,f){var g=b('PhotosUploadWaterfallX'),h=b('copyProperties');e.exports={getWaterfallID:function(){},getWaterfallAppName:function(){},logStep:function(i,j,k){var l=this.getWaterfallID(),m=this.getWaterfallAppName();if(!l||!m)return;g.sendSignal(h({step:i,qn:l,uploader:m},j),k);}};});
__d("BanzaiScribe",["Banzai"],function(a,b,c,d,e,f){var g=b('Banzai');function h(j){return {log:function(k,l,m){var n=[l];if(m!=null)n.push(m);g.post('scribe:'+k,n,j);}};}var i=h({});i.create=h;e.exports=i;});
__d("SamplingPolicyBase",[],function(a,b,c,d,e,f){function g(){throw 'Tried to instantiate SamplingPolicyBase';}g.prototype.getName=function(){return this.name;};g.prototype.isSampled=function(){if(typeof(this.sampled)=='undefined')this.sampled=this.decideIfSampled();return this.sampled;};e.exports=g;});
__d("FbtraceForcedByServerPolicy",["FbtraceForcedByServer","SamplingPolicyBase","copyProperties"],function(a,b,c,d,e,f){var g=b('FbtraceForcedByServer'),h=b('SamplingPolicyBase'),i=b('copyProperties'),j;function k(){this.name='FbtraceForcedByServerPolicy';}k.get=function(){if(typeof(j)=='undefined')j=new k();return j;};function l(){return g.forced;}i(k.prototype,h.prototype,{decideIfSampled:l});e.exports=k;});
/**
 * @generated SignedSource<<091461a353d9b40c12f5a66d653a6b62>>
 * 
 * !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 * !! This file is a check-in of a static_upstream project!      !!
 * !!                                                            !!
 * !! You should not modify this file directly. Instead:         !!
 * !! 1) Use `fjs use-upstream` to temporarily replace this with !!
 * !!    the latest version from upstream.                       !!
 * !! 2) Make your changes, test them, etc.                      !!
 * !! 3) Use `fjs push-upstream` to copy your changes back to    !!
 * !!    static_upstream.                                        !!
 * !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 * 
 * Copyright (C) 2010 by Johannes Baagoe <baagoe@baagoe.org>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 * @providesModule Alea
 * @preserve-header
 */__d("Alea",[],function(a,b,c,d,e,f){function g(){var i=4022871197,j=function(k){k=k.toString();for(var l=0;l<k.length;l++){i+=k.charCodeAt(l);var m=.02519603282416938*i;i=m>>>0;m-=i;m*=i;i=m>>>0;m-=i;i+=m*4294967296;}return (i>>>0)*2.3283064365386963e-10;};j.version='Mash 0.9';return j;}function h(){return (function(i){var j=0,k=0,l=0,m=1;if(i.length===0)i=[new Date()];var n=new g();j=n(' ');k=n(' ');l=n(' ');for(var o=0;o<i.length;o++){j-=n(i[o]);if(j<0)j+=1;k-=n(i[o]);if(k<0)k+=1;l-=n(i[o]);if(l<0)l+=1;}n=null;var p=function(){var q=2091639*j+m*2.3283064365386963e-10;j=k;k=l;l=q-(m=q|0);return l;};p.version='Alea 0.9';p.args=i;return p;}(Array.prototype.slice.call(arguments)));}e.exports=h;});
__d("Random",["Alea","ServerNonce"],function(a,b,c,d,e,f){var g=b('Alea'),h=b('ServerNonce').ServerNonce,i=g(h),j={random:i,uint32:function(){return Math.floor(i()*4294967296);}};e.exports=j;});
__d("guardFunction",[],function(a,b,c,d,e,f){function g(h,i,j){return function(){if(h.apply(j||this,arguments))i.apply(j||this,arguments);};}e.exports=g;});
__d("Fbtrace",["BanzaiScribe","copyProperties","FbtraceForcedByServerPolicy","FbtraceForcedByServer","Env","Random","ErrorUtils","Arbiter","guardFunction"],function(a,b,c,d,e,f){var g=b('BanzaiScribe'),h=b('copyProperties'),i=b('FbtraceForcedByServerPolicy'),j=b('FbtraceForcedByServer'),k=b('Env'),l=b('Random'),m=b('ErrorUtils'),n=b('Arbiter'),o=b('guardFunction'),p='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/',q='AAAAAAAAAAA';for(var r in Error)if(Error.hasOwnProperty(r))t[r]=Error[r];var s=Error===null?null:Error.prototype;t.prototype=Object.create(s);t.prototype.constructor=t;t.__superConstructor__=Error;function t(ia){Error.call(this,ia);}function u(ia){m.reportError(new t(ia));}function v(){var ia=function(){var la=0,ma=0,na='';for(var oa=10;oa>=0;oa--){if(la<6){ma=l.uint32();la=32;}if(oa===0)ma=ma&7;na=p.charAt(ma&63)+na;ma>>=6;la-=6;}return na;},ja,ka;for(ja=3;ja>0;ja--){ka=ia();if(ka!=q)return ka;}u('failed to generate valid Fbtrace id');return q;}function w(){h(this,w);}h(w,{isOn:function(){return false;},replySend:function(ia,ja){},requestSend:function(ia,ja,ka){ca(ia,ja);return {metadata:function(){return undefined;},replyReceive:function(la){}};}});var x=new w();function y(ia,ja,ka){if(!ia)throw {name:'ArgumentError',message:'no valid service name specified'};if(!ja)throw {name:'ArgumentError',message:'no valid version specified'};var la=g,ma=0,na=v(),oa=v(),pa=ba(na),qa={service:ia,version:ja},ra=function(wa){if(typeof(wa)=='undefined')return 'undefined';if(typeof(wa)!='string')wa=ra(JSON.stringify(wa));return wa;},sa=function(wa){var xa='';for(var ya in wa){if(xa.length>0)xa+='\x02';xa+=ra(ya)+'\x03'+ra(wa[ya]);}return xa;},ta=function(wa,xa,event,ya,za){ma++;return [za,ma,na,wa,xa,ra(event),sa(ya)].join('\x01');},ua=function(wa,xa,event,ya,za){if(!za&&typeof(za)=='undefined')za=Date.now()*1000;var ab=ta(wa,xa,event,ya,za);la.log('fbtrace',ab,pa);},va=function(){return oa;};ua(q,oa,'#rqrecv',h(ka,qa));h(this,y);h(this,{replySend:function(wa,xa){xa=h(xa,qa,{success:wa?'true':'false'});ua(q,oa,'#rpsend',xa);},requestSend:function(wa,xa,ya){ca(wa,xa);var za=va(),ab=v();ya=h(ya,qa,{op:wa,'remote:service':xa});ua(za,ab,'#rqsend',ya);return {metadata:function(){return na+ab;},replyReceive:function(bb){ua(za,ab,'#rprecv',h(bb,qa));}};}});}h(y,{isOn:function(){return true;}});function z(){return x;}function aa(ia,ja,ka){ka=ka||{};ka.init=true;var la=i.get();if(la.isSampled()){return new y(ia,ja,ka);}else return new w();}function ba(ia){var ja=ia.charAt(ia.length-1);return p.indexOf(ja)%32;}function ca(ia,ja){if(!ia)throw {name:'ArgumentError',message:'no valid operation specified'};if(!ja)throw {name:'ArgumentError',message:'no valid remote:service specified'};}function da(ia,ja){var ka=x,la;x=ia;try{la=ja();}finally{x=ka;}return la;}var ea=function(ia,ja){var ka=z(),la=ja.request;if(!ka.isOn()&&j.forced&&/\/upload\/(?:composer|photos)\/|\/ajax\/composerx\/attachment\/media\//.test(la.uri.toString()))ka=aa('photo_upload_kludge',String(k.svn_rev||'dev'));if(ka.isOn()){var ma={};if(la.userActionId)ma.user_action_id=la.userActionId;var na=ka.requestSend(la.uri.toString(),'www',ma);la.fbtraceRemoteNode=na;la.transport.setRequestHeader('X-Fbtrace-Meta',na.metadata());}},fa=function(ia,ja){ja.request.fbtraceRemoteNode.replyReceive({is_last:ja.response.is_last,success:true});},ga=function(ia,ja){ja.request.fbtraceRemoteNode.replyReceive({is_last:ja.response.is_last,success:false,error_code:ja.response.error,error_summary:ja.response.errorSummary,error_description:ja.response.errorDescription});},ha=function(ia,ja){return ja.request.fbtraceRemoteNode;};n.subscribe('AsyncRequest/send',ea);n.subscribe('AsyncRequest/response',o(ha,fa));n.subscribe('AsyncRequest/error',o(ha,ga));e.exports={defaultNode:z,requestReceive:aa,withDefaultNode:da};});
__d("PhotosMultiUploadInput",["Arbiter","Animation","AsyncUploadRequest","ComposerXController","ComposerXDragDrop","CSS","Dialog","DOM","DOMQuery","DragDropTarget","Event","FileForm","FileInputUploader","JSLogger","Parent","PhotosUploadID","PhotosUploadWaterfallX","PhotosUploadWaterfallXMixin","ProgressBar","$","copyProperties","createArrayFrom","csx","cx","mixin","tx","Fbtrace"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Animation'),i=b('AsyncUploadRequest'),j=b('ComposerXController'),k=b('ComposerXDragDrop'),l=b('CSS'),m=b('Dialog'),n=b('DOM'),o=b('DOMQuery'),p=b('DragDropTarget'),q=b('Event'),r=b('FileForm'),s=b('FileInputUploader'),t=b('JSLogger'),u=b('Parent'),v=b('PhotosUploadID'),w=b('PhotosUploadWaterfallX'),x=b('PhotosUploadWaterfallXMixin'),y=b('ProgressBar'),z=b('$'),aa=b('copyProperties'),ba=b('createArrayFrom'),ca=b('csx'),da=b('cx'),ea=t.create('composer'),fa=b('mixin'),ga=b('tx');b("Fbtrace");function ha(qa,ra,sa,ta){this._grid=na.getInstance(ta.gridID);this._grid.setProgressBarMarkup(qa).setVideoIconMarkup(ra).setConfig(ta);sa.getInput().multiple=(ta.maxselect!=1)&&i.isSupported();sa.subscribe('change',function(ua,event){if(event.getTarget().value)this._grid.doFileUpload(sa);}.bind(this));if(!this._grid.sessionStarted){this._grid.sessionStarted=true;this._grid.logStep(w.CLIENT_FLOW_BEGIN);}this._grid.logStep(w.CLIENT_SELECT_BEGIN);g.inform('PhotosMultiUploadInput/loaded/'+ta.gridID,g.BEHAVIOR_PERSISTENT);}aa(ha,{imageUploadDone:function(qa,ra,sa,ta){ia[qa].imageUploadDone(ra,sa,ta);},initDragDrop:function(qa,ra){g.inform('PhotosMultiUploadInput/initDragDrop/'+qa,{dragDropArea:ra},g.BEHAVIOR_PERSISTENT);},imageUploadFail:function(qa,ra){ia[qa].removeLoadingIndicator(ra.getFile().uploadID);},doFileUpload:function(qa,ra){ia[qa].doFileUpload(ra);},onFilesDrop:function(qa,ra){ia[qa]._onFilesDrop(ra);},setWaterfallID:function(qa,ra){},getWaterfallID:function(qa){return ia[qa].getWaterfallID();},clearSession:function(qa){ia[qa].clearSession();},getConfig:function(qa){return ia[qa].getConfig();}});var ia={},ja=0,ka=fa(x);for(var la in ka)if(ka.hasOwnProperty(la))na[la]=ka[la];var ma=ka===null?null:ka.prototype;na.prototype=Object.create(ma);na.prototype.constructor=na;na.__superConstructor__=ka;function na(qa){this._loadingIndicators={};this._numRemainingFiles=0;this._progressBarMarkup=null;this._videoIconMarkup=null;this._gridID=qa;this._dragDropTarget=null;this._submitListener=null;this._fileInputInstances=[];this._videoFileInput=null;this._videoFileInputContainer=null;this._videoUploadSubscriptions=[];this._uploadTimers={};this._sessionsStarted=false;g.subscribe('multi-upload/video-removed/'+this._gridID,function(){n.remove(this._videoIconMarkup);this._submitListener&&this._submitListener.remove();this._submitListener=null;this._videoFileInput=null;this._videoFileInputContainer=null;this._videoUploadSubscriptions.forEach(function(ra){ra.unsubscribe();}.bind(this));this._videoUploadSubscriptions=[];this._fileInputInstances.forEach(function(ra){ra.clear();});}.bind(this));g.subscribe('PhotosMultiUploadInput/initDragDrop/'+qa,function(ra,sa){this.initDragDrop(sa.dragDropArea);}.bind(this));g.subscribe('AttachmentsPhotoEditor/newImage'+qa,this._onEditedImage.bind(this));}na.prototype.getWaterfallID=function(){return this._config.waterfallID;};na.prototype.getWaterfallAppName=function(){return w.WEB_COMPOSER;};na.prototype.getLoadingIndicator=function(qa){var ra=this._loadingIndicators[qa];return ra;};na.prototype.initDragDrop=function(qa){this._dragDropTarget&&this._dragDropTarget.disable();this._dragDropTarget=new p(qa).setOnFilesDropCallback(this._onFilesDrop.bind(this)).setFileFilter(k.filterImages).enable();};na.prototype.setConfig=function(qa){this._config=qa;return this;};na.prototype.setProgressBarMarkup=function(qa){this._progressBarMarkup=qa;return this;};na.prototype.setVideoIconMarkup=function(qa){this._videoIconMarkup=qa;var ra=n.find(qa,"._3ev");q.listen(ra,'click',this._onVideoRemoved.bind(this));return this;};na.prototype.imageUploadDone=function(qa,ra,sa){var ta=this.getLoadingIndicator(ra);if(!ta)return;if(n.contains(document.body,ta.getRoot()))n.replace(ta.getRoot(),qa);g.inform('multi-upload/images-added/'+this._gridID,{fbids:[sa],tagInfo:{}});this._numRemainingFiles--;if(this._numRemainingFiles===0)g.inform('multi-upload/images-upload-completed/'+this._gridID);this._loadingIndicators[ra]=null;};na.prototype._generateLoadingIndicator=function(qa){this._numRemainingFiles++;var ra=this._progressBarMarkup.cloneNode(true);this.insertIntoGrid(ra);this._loadingIndicators[qa]=new y(ra);};na.prototype._generateUploadIDsAndLoadingIndicators=function(qa){for(var ra=0;ra<qa.length;ra++){if(!qa[ra].uploadID)qa[ra].uploadID=v.getNewID();this._generateLoadingIndicator(qa[ra].uploadID);}};na.prototype.fileUploadFailure=function(qa,ra){var sa=Date.now()-this._uploadTimers[qa];this.logStep(w.CLIENT_TRANSFER_FAIL,{dt:sa,error_code:ra.response?ra.response.getError():undefined,bytes:ra.upload.getFile().size});if(o.scry(this.getLoadingIndicator(qa).getRoot(),"._5l82").length){this._showUploadFailedMessage(qa);this._fadeOutFileUpload(qa);}else this.removeFileUpload(qa);};na.prototype._fadeOutFileUpload=function(qa){new h(this.getLoadingIndicator(qa).getRoot()).duration(2000).checkpoint().from('opacity',1).to('opacity',0).duration(1000).ondone(this.removeFileUpload.bind(this,qa)).go();};na.prototype._showUploadFailedMessage=function(qa){l.hide(o.find(this.getLoadingIndicator(qa).getRoot(),"._5l83"));l.show(o.find(this.getLoadingIndicator(qa).getRoot(),"._5l82"));};na.prototype.fileUploadCanceled=function(qa,ra){var sa=Date.now()-this._uploadTimers[qa];this.logStep(w.CLIENT_TRANSFER_CANCEL,{dt:sa,bytes:ra.upload.getFile().size});this.removeFileUpload(qa);};na.prototype.removeFileUpload=function(qa){this._numRemainingFiles=Math.max(0,this._numRemainingFiles-1);this.removeLoadingIndicator(qa);if(this._numRemainingFiles===0)g.inform('multi-upload/images-upload-completed/'+this._gridID);};na.prototype.doFileUpload=function(qa){var ra=false,sa=false;switch(this._config.supportedFileTypes){case 'photos':sa=true;break;case 'videos':ra=true;break;case 'both':ra=sa=true;break;}var ta=ra&&this._config.videoUploader.isVideoFile(qa.getInput());this._submitListener&&this._submitListener.remove();if(ta){this._videoSelected(qa);}else if(sa){this._photosSelected(qa);}else new m().setBody("Solo puedes seleccionar archivos de video.").setTitle("Archivo no compatible").setModal(true).setButtons(m.OK).show();};na.prototype.getConfig=function(){return this._config;};na.prototype._photosSelected=function(qa){var ra=qa.getInput(),sa=oa(ra);if(this._config.maxselect>1&&sa>this._config.maxselect){new m().setTitle("Demasiadas fotos").setBody(ga._("Solo puedes agregar{maxselect} fotos a un mensaje. Si quieres, puedes agregar fotos a otros mensajes.",{maxselect:this._config.maxselect})).setButtons(m.OK).setModal(true).show();return;}this._onBeforeAddUploadedImages();var ta=this._config.uploadData,ua=null;if(!pa(ra)){ra.uploadID=v.getNewID();this._generateLoadingIndicator(ra.uploadID);ta.upload_id=ra.uploadID;}else{ua=ba(ra.files);this._generateUploadIDsAndLoadingIndicators(ua);}g.inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:sa});if(this._config.waterfallID)ta.qn=this._config.waterfallID;var va=new s(ra).setURI(this._config.photoEndpoint).setData(ta).setAllowCrossOrigin(true).setUploadInParallel(true);if(ua)va.setFiles(ua);va.subscribe('progress',this._onProgress.bind(this));va.subscribe('failure',function(xa,ya){this.fileUploadFailure(ya.upload.getFile().uploadID,ya);}.bind(this));va.subscribe('start',this._onFileUploadStart.bind(this));va.subscribe('success',function(xa,ya){var za;if(ya.upload){za=ya.upload.getFile().uploadID;}else za=ra.uploadID;this._onFileUploadSuccess(za,ya);}.bind(this));try{va.send();qa.clear();}catch(wa){ea.error('error_send_unpublished_files',wa);throw wa;}this.logStep(w.CLIENT_SELECT_SUCCESS,{times_selected:ja++,volume:sa,method:'file_selector'});};na.prototype._videoSelected=function(qa){var ra=qa.getInput();if(ra.files&&ra.files.length>1){new m().setTitle("Demasiados archivos").setBody("Selecciona solo un archivo de video a la vez.").setButtons(m.OK).show();return;}g.inform('multi-upload/composer-reset/'+this._gridID);this._dragDropTarget&&this._dragDropTarget.disable();this.insertIntoGrid(this._videoIconMarkup);g.inform('multi-upload/video-added/'+this._gridID);this._fileInputInstances.push(qa);this._videoUploadSubscriptions=[this._config.videoUploader.subscribe('upload-succeeded',this._onVideoUploadFinished.bind(this)),this._config.videoUploader.subscribe('upload-failed',this._onVideoUploadFinished.bind(this)),this._config.videoUploader.subscribe('file-invalidated',this._onVideoUploadFinished.bind(this))];var sa=u.byTag(z(this._gridID),'form');this._submitListener=q.listen(n.find(sa,"._11b"),'click',this._onVideoSubmitted.bind(this,sa,ra));};na.prototype._onVideoRemoved=function(){this._dragDropTarget&&this._dragDropTarget.enable();g.inform('multi-upload/video-removed/'+this._gridID);};na.prototype._onVideoSubmitted=function(qa,ra){qa.action=this._config.videoEndpoint;ra.name='video';this._videoFileInput=ra;this._videoFileInputContainer=ra.parentNode;l.hide(ra);n.appendContent(qa,ra);l.addClass(qa,"_4_8");this._config.videoUploader.upload(r.getInstance(qa),ra);return false;};na.prototype._onVideoUploadFinished=function(qa,ra){n.appendContent(this._videoFileInputContainer,this._videoFileInput);l.show(this._videoFileInput);this._onVideoRemoved();var sa=u.byTag(z(this._gridID),'form');l.removeClass(sa,"_4_8");j.reset(sa);};na.prototype.removeLoadingIndicator=function(qa){var ra=this.getLoadingIndicator(qa);ra&&n.remove(ra.getRoot());delete this._loadingIndicators[qa];};na.prototype._onFileUploadStart=function(qa,ra){var sa=ra.upload.getFile().uploadID,ta=n.find(this.getLoadingIndicator(sa).getRoot(),"._639");l.show(ta);q.listen(ta,'click',function(){ra.upload.abort();this.fileUploadCanceled(sa,ra);}.bind(this));this._uploadTimers[sa]=Date.now();this.logStep(w.CLIENT_TRANSFER_BEGIN,{bytes:ra.upload.getFile().size});};na.prototype._onProgress=function(qa,ra){var sa=ra.event,ta=this.getLoadingIndicator(ra.upload.getFile().uploadID);if(!ta)return;l.hide(n.find(ta.getRoot(),"._2om"));l.show(n.find(ta.getRoot(),"._5e4h"));if(sa.loaded==sa.total){ta.setPosition(50);ta.setTarget(100,2000);}else ta.setPosition(50*sa.loaded/sa.total);};na.prototype._onFileUploadSuccess=function(qa,ra){var sa=Date.now()-this._uploadTimers[qa],ta={dt:sa};if(ra.upload)ta.bytes=ra.upload.getFile().size;this.logStep(w.CLIENT_TRANSFER_SUCCESS,ta);};na.prototype._onEditedImage=function(qa,ra){this._onBeforeAddUploadedImages();this.logStep(w.CLIENT_SELECT_BEGIN);this._generateUploadIDsAndLoadingIndicators([ra]);g.inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:1,method:w.METHOD_EDITOR});var sa=new i().setData(this._config.uploadData).setFiles([ra]).setAllowCrossOrigin(true).setURI(this._config.photoEndpoint);sa.subscribe('failure',function(ta,ua){this.fileUploadFailure(ua.getFile().uploadID,{upload:ua});}.bind(this));sa.subscribe('progress',function(ta,ua){this._onProgress(ta,{upload:ua,event:ua.getProgressEvent()});}.bind(this));sa.subscribe('start',function(ta,ua){this._onFileUploadStart(ta,{upload:ua});}.bind(this));sa.subscribe('success',function(ta,ua){this._onFileUploadSuccess(ua.getFile().uploadID,{upload:ua});}.bind(this));sa.send();this.logStep(w.CLIENT_SELECT_SUCCESS,{volume:1,method:w.METHOD_EDITOR});};na.prototype._onFilesDrop=function(qa){this._onBeforeAddUploadedImages();this.logStep(w.CLIENT_SELECT_BEGIN);this._generateUploadIDsAndLoadingIndicators(qa);g.inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:qa.length,method:w.METHOD_DRAGDROP||'dragdrop'});var ra=new i().setData(this._config.uploadData).setFiles(qa).setAllowCrossOrigin(true).setURI(this._config.photoEndpoint);ra.subscribe('failure',function(sa,ta){this.fileUploadFailure(ta.getFile().uploadID,{upload:ta});}.bind(this));ra.subscribe('progress',function(sa,ta){this._onProgress(sa,{upload:ta,event:ta.getProgressEvent()});}.bind(this));ra.subscribe('start',function(sa,ta){this._onFileUploadStart(sa,{upload:ta});}.bind(this));ra.subscribe('success',function(sa,ta){this._onFileUploadSuccess(ta.getFile().uploadID,{upload:ta});}.bind(this));ra.send();this.logStep(w.CLIENT_SELECT_SUCCESS,{volume:qa.length,method:'drag_drop'});};na.prototype._onBeforeAddUploadedImages=function(){if(!this.sessionStarted)this.logStep(w.CLIENT_FLOW_BEGIN);if(this._config.maxselect==1)g.inform('multi-upload/composer-reset/'+this._gridID);this.sessionStarted=true;};na.prototype.clearSession=function(){this.sessionStarted=false;};na.prototype.insertIntoGrid=function(qa){var ra=n.scry(z(this._gridID),"._577")[0];if(ra){n.insertBefore(ra,qa);}else n.prependContent(z(this._gridID),qa);};na.getInstance=function(qa){ia[qa]=ia[qa]||new na(qa);return ia[qa];};function oa(qa){if(!pa(qa))return 1;return qa.files.length;}function pa(qa){return !!qa.files;}e.exports=ha;});
__d("TimelineMapScrollableArea",["Animation","ArbiterMixin","CSS","DOM","Event","Run","SimpleDrag","Style","Vector","$","copyProperties","shield"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('ArbiterMixin'),i=b('CSS'),j=b('DOM'),k=b('Event'),l=b('Run'),m=b('SimpleDrag'),n=b('Style'),o=b('Vector'),p=b('$'),q=b('copyProperties'),r=b('shield');function s(t,u){t&&this.init(p(t),u);}q(s.prototype,h,{init:function(t,u){u=u||{};this._elem=t;this._wrap=j.find(t,'div.fbScrollableAreaWrap');this._body=j.find(this._wrap,'div.fbScrollableAreaBody');this._track=j.find(t,'div.fbScrollableAreaTrack');this._gripper=j.find(this._track,'div.fbScrollableAreaGripper');this._options=u;this.adjustGripper();this._listeners=[k.listen(this._wrap,'scroll',this._handleScroll.bind(this))];if(u.fade!==false)this._listeners.push(k.listen(t,'mouseenter',r(this.adjustGripper,this)),k.listen(t,'mouseenter',r(this.showScrollbar,this)),k.listen(t,'mousemove',this._handleMousemove.bind(this)),k.listen(t,'mouseout',r(this.hideScrollbar,this)));if(u.fade!==undefined)this._listeners.push(k.listen(this._track,'click',this.clickToScroll.bind(this)));if(u.verticalscroll)this._listeners.push(k.listen(this._wrap,'mousewheel',this.mouseWheel.bind(this)),k.listen(this._wrap,'DOMMouseScroll',this.mouseWheel.bind(this)));this.initDrag();if(!u.persistent)l.onLeave(this.destroy.bind(this));},initDrag:function(){var t=new m(this._gripper);t.subscribe('start',function(u,event){if(!((event.which&&event.which===1)||(event.button&&event.button===1)))return;this.inform('dragstart');var v=o.getEventPosition(event).x,w=this._gripper.offsetLeft,x=t.subscribe('update',function(z,aa){var ba=o.getEventPosition(aa).x-v,ca=this._elem.clientWidth,da=this._body.offsetWidth,ea=this._track.offsetWidth,fa=ca/da*ea,ga=da-this._wrap.offsetWidth,ha=w+ba,ia=ea-fa;ha=Math.max(Math.min(ha,ia),0);var ja=ha/ia*ga;this._wrap.scrollLeft=ja;}.bind(this)),y=t.subscribe('end',function(){t.unsubscribe(x);t.unsubscribe(y);this.inform('dragend');}.bind(this));}.bind(this));},adjustGripper:function(){var t=this._elem.clientWidth,u=this._body.offsetWidth,v=this._track.offsetWidth,w=t/u*v;if(w<v){n.set(this._gripper,'width',w+'px');var x=this._wrap.scrollLeft/u*v;n.set(this._gripper,'left',x+'px');i.show(this._gripper);}else i.hide(this._gripper);this._checkContentBoundaries();return this;},_checkContentBoundaries:function(){var t=this._wrap.scrollLeft,u=this._wrap.scrollWidth-this._wrap.clientWidth;i.conditionClass(this._elem,'contentBefore',t>0);i.conditionClass(this._elem,'contentAfter',t<u);},destroy:function(){this._listeners.forEach(function(t){t.remove();});this._listeners.length=0;},_handleMousemove:function(event){var t=o.getElementPosition(this._track).y,u=o.getElementDimensions(this._track).y;if(Math.abs(t+u/2-o.getEventPosition(event).y)<25){this.showScrollbar(false);}else this.hideScrollbar();},_handleScroll:function(event){this.adjustGripper();if(this._options.fade!==false)this.showScrollbar();},hideScrollbar:function(){if(!this._scrollbarVisible)return this;this._scrollbarVisible=false;if(this._hideTimeout){clearTimeout(this._hideTimeout);this._hideTimeout=null;}this._hideTimeout=function(){if(this._scrollbarAnimation){this._scrollbarAnimation.stop();this._scrollbarAnimation=null;}this._scrollbarAnimation=new g(this._track).from('opacity',1).to('opacity',0).duration(250).ondone(i.addClass.curry(this._track,'invisible_elem')).go();}.bind(this).defer(750);return this;},showScrollbar:function(t){if(this._scrollbarVisible)return this;this._scrollbarVisible=true;if(this._hideTimeout){clearTimeout(this._hideTimeout);this._hideTimeout=null;}if(this._scrollbarAnimation){this._scrollbarAnimation.stop();this._scrollbarAnimation=null;}this.adjustGripper();n.set(this._track,'opacity',1);i.removeClass(this._track,'invisible_elem');if(t!==false)this.hideScrollbar();return this;},clickToScroll:function(event){var t=o.getEventPosition(event).x,u=this._elem.clientWidth,v=this._body.offsetWidth,w=this._track.offsetWidth,x=u/v*w,y=o.getElementPosition(this._gripper);if(t>=y.x&&t<=y.x+x)return;var z=t<y.x?-1:1,aa=this._wrap.offsetWidth*.8*z;this.scrollBy(aa);},scrollBy:function(t){this.setScroll(this._wrap.scrollLeft+t);},setScroll:function(t){var u=this._body.offsetWidth-this._wrap.offsetWidth,v=t;v=Math.max(Math.min(v,u),0);this._wrap.scrollLeft=v;},scrollIntoView:function(t){var u=this._wrap.clientWidth,v=t.offsetWidth,w=this._wrap.scrollLeft,x=w+u,y=t.offsetLeft,z=y+v;if(y<w||u<v){this.setScroll(y);}else if(z>x)this.setScroll(w+(z-x));},mouseWheel:function(event){var t=0;if(event.wheelDelta){var u=event.wheelDelta;if(event.wheelDeltaX&&event.wheelDeltaY)u=Math.abs(event.wheelDeltaX)>Math.abs(event.wheelDeltaY)?event.wheelDeltaX:event.wheelDeltaY;t=-u*10/40;}else if(event.detail)t=event.detail*10;this.scrollBy(t);event.prevent();}});e.exports=a.TimelineMapScrollableArea||s;});
__d("VaultEditableGrid",["Event","Arbiter","AsyncRequest","CSS","DOM","$","copyProperties","csx","ge","removeFromArray"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('CSS'),k=b('DOM'),l=b('$'),m=b('copyProperties'),n=b('csx'),o=b('ge'),p=b('removeFromArray'),q={};function r(s,t){q[s.id]=this;this._grid=s;this._gridID=s.id;this._dialogEndpoint=t;this._selectedVaultImageIDs=[];h.subscribe('multi-upload/image-removed/'+this._gridID,function(u,v){p(this._selectedVaultImageIDs,v);}.bind(this));h.subscribe('multi-upload/composer-reset/'+this._gridID,this.removeImages.bind(this));h.inform('fbVaultEditableGrid/created/'+s.id,this,h.BEHAVIOR_PERSISTENT);h.subscribe('multi-upload/images-upload-start/'+this._gridID,this._scrollToRight.bind(this));}m(r,{VAULT_IMAGE:'vault_image',getInstance:function(s){return q[s];},registerDialogWithGrid:function(s,t,u){h.subscribe(['multi-upload/images-upload-start/'+s,'multi-upload/video-added/'+s],u.hide.bind(u));h.subscribe('fbVaultEditableGrid/created/'+s,function(v,w){w._registerDialogWithGrid(t,u);});},onImagesSelected:function(s,t,u){q[s]._onImagesSelected(t,u);}});m(r.prototype,{getRoot:function(){var s=o(this._gridID);if(s){return s;}else return this._grid;},_registerDialogWithGrid:function(s,t){this._dialog=t;var u=this.getMoreLink();u&&g.listen(u,'click',function(){t.show();return false;});t.subscribe('aftershow',function(){var v=[];k.scry(l(this._gridID),'input[type="hidden"]').forEach(function(x){if(x.name.match('composer_vault_images')||x.name.match('composer_unpublished_photo'))v.push(x.value);});var w=s.getGrid();w.bulkChange(function(){var x=w.getSelectionSet();x.clear();x.addAll(v);});}.bind(this));},getID:function(){return this._gridID;},_onImagesSelected:function(s,t){var u=k.find(this.getRoot(),"._577");this.removeImages();this._selectedVaultImageIDs=t;s.forEach(function(v){k.insertBefore(u,v);});h.inform('multi-upload/images-added/'+this._gridID,{fbids:t});this._scrollToRight();},removeImages:function(){k.scry(this.getRoot(),'.fbVaultGridItem').forEach(function(s){if(!j.hasClass(s,'fbVaultEditableGridMoreLink'))k.remove(s);});this._selectedVaultImageIDs=[];h.inform('multi-upload/all-images-removed/'+this._gridID);},_scrollToRight:function(){var s=this.getRoot(),t=k.find(s,'.fbScrollableAreaWrap');t.scrollLeft=Math.max(0,k.find(s,'.fbScrollableAreaBody').offsetWidth-t.offsetWidth);},showDialog:function(s,t){if(this._dialog){this._dialog.show();}else i.bootstrap(this._dialogEndpoint,s);},getMoreLink:function(){return k.scry(this.getRoot(),'.fbVaultEditableGridMoreLink')[0];}});e.exports=r;});
__d("BasePhotoUploader",["Arbiter","ArbiterMixin","CSS","DOM","PhotosMultiUploadInput","VaultEditableGrid","TimelineMapScrollableArea","removeFromArray","mixin"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('CSS'),j=b('DOM'),k=b('PhotosMultiUploadInput'),l=b('VaultEditableGrid'),m=b('TimelineMapScrollableArea'),n=b('removeFromArray'),o=b("mixin"),p=o(h);for(var q in p)if(p.hasOwnProperty(q))s[q]=p[q];var r=p===null?null:p.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=p;function s(t,u){new m(t,{verticalscroll:true});this.$BasePhotoUploader0=t;this.$BasePhotoUploader1=this.$BasePhotoUploader2();this.$BasePhotoUploader3=false;this.$BasePhotoUploader4=null;u.addSubscriptions(g.subscribe('multi-upload/images-added/'+this.$BasePhotoUploader0.id,function(v,w){this.$BasePhotoUploader1=this.$BasePhotoUploader1.concat(w.fbids);this.$BasePhotoUploader5();this.inform('upload-completed',{fbids:w.fbids});}.bind(this)),g.subscribe('multi-upload/image-removed/'+this.$BasePhotoUploader0.id,function(v,w){n(this.$BasePhotoUploader1,w);this.$BasePhotoUploader5();}.bind(this)),g.subscribe('multi-upload/images-upload-start/'+this.$BasePhotoUploader0.id,function(v,w){i.show(this.$BasePhotoUploader0);this.$BasePhotoUploader3=true;this.inform('dom-updated');this.inform('upload-started',w);}.bind(this)),g.subscribe('multi-upload/composer-reset/'+this.$BasePhotoUploader0.id,this.clear.bind(this)),g.subscribe('multi-upload/all-images-removed/'+this.$BasePhotoUploader0.id,this.$BasePhotoUploader6.bind(this)),g.subscribe('multi-upload/images-upload-completed/'+this.$BasePhotoUploader0.id,function(v){this.$BasePhotoUploader3=false;this.inform('all-uploads-completed');}.bind(this)));i.conditionShow(this.$BasePhotoUploader0,this.$BasePhotoUploader1.length);}s.prototype.getSelectedFBIDs=function(){return this.$BasePhotoUploader1;};s.prototype.isUploading=function(){return this.$BasePhotoUploader3;};s.prototype.clear=function(){var t=l.getInstance(this.$BasePhotoUploader0.id);t&&t.removeImages();};s.prototype.setWaterfallID=function(t){};s.prototype.getWaterfallID=function(){return k.getWaterfallID(this.$BasePhotoUploader0.id);};s.prototype.$BasePhotoUploader6=function(){this.$BasePhotoUploader1=[];this.$BasePhotoUploader3=false;i.hide(this.$BasePhotoUploader0);this.inform('all-uploads-completed');this.inform('dom-updated');};s.prototype.$BasePhotoUploader2=function(){var t=[];j.scry(this.$BasePhotoUploader0,'input[type="hidden"]').forEach(function(u){if(u.name.match('composer_vault_images'))t.push(u.value);});return t;};s.prototype.$BasePhotoUploader5=function(){i.conditionShow(this.$BasePhotoUploader0,this.$BasePhotoUploader1.length>0);this.inform('dom-updated');};s.prototype.setCurrentMethod=function(t){this.$BasePhotoUploader4=t;};s.prototype.getCurrentMethod=function(){return this.$BasePhotoUploader4;};e.exports=s;});
__d("MercuryPhotoUploader",["Arbiter","AsyncRequest","copyProperties","DOM","FileInput","Parent","PhotosMultiUploadInput","PhotosUploadWaterfall","VaultEditableGrid","csx","cx","Event","BasePhotoUploader"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('copyProperties'),j=b('DOM'),k=b('FileInput'),l=b('Parent'),m=b('PhotosMultiUploadInput'),n=b('PhotosUploadWaterfall'),o=b('VaultEditableGrid'),p=b('csx'),q=b('cx'),r=b('Event'),s=b('BasePhotoUploader');for(var t in s)if(s.hasOwnProperty(t))v[t]=s[t];var u=s===null?null:s.prototype;v.prototype=Object.create(u);v.prototype.constructor=v;v.__superConstructor__=s;function v(w,x,y,z){s.call(this,w,y);this.$MercuryPhotoUploader0=w.id;this.$MercuryPhotoUploader1=false;g.subscribe('PhotosMultiUploadInput/loaded/'+w.id,function(){this.$MercuryPhotoUploader1=true;}.bind(this));g.subscribe('MercuryPhotoUploader/initUploadButton/'+w.id,function(){var aa=j.scry(x,'input[type="file"]')[0];if(!aa)aa=j.create('input',{accept:'image/*',type:'file',className:"_n",name:'composer_unpublished_photo[]',multiple:1});var ba=l.byClass(x,"_9_h"),ca=new k(ba,j.find(ba,"._214"),aa);ca.subscribe('change',m.doFileUpload.curry(w.id,ca));});g.subscribe('MercuryPhotoUploader/registerPhotoMenu/'+w.id,function(aa,ba){var ca=ba.menu.getRoot();ba.menu.setContext(x);var da=j.scry(ca,"._d2p"),ea=da&&da[0];ea&&r.listen(ea,'click',function(){o.getInstance(w.id).showDialog(ea,o.VAULT_IMAGE);this.setCurrentMethod(n.METHOD_VAULT);this.inform('selection-start',{method:n.METHOD_VAULT});}.bind(this));r.listen(x,'click',function(){if(!this.$MercuryPhotoUploader1)return;if(!ba.menu.isShown()){this.inform('menu-show');ba.menu.show();}else{this.inform('menu-hide');ba.menu.hide();}}.bind(this));r.listen(document.documentElement,'click',function(event){if(!j.contains(x,event.getTarget())&&!j.contains(ea,event.getTarget())){if(ba.menu.isShown())this.inform('menu-hide');ba.menu.hide();}}.bind(this));var fa=j.find(ca,"._9_h");r.listen(fa,'click',function(){this.setCurrentMethod(n.METHOD_FILE_SELECTOR);this.inform('selection-start',{method:n.METHOD_FILE_SELECTOR});}.bind(this));}.bind(this));z&&m.initDragDrop(w.id,z);}v.prototype.addCachedPhotos=function(w){h.post('/ajax/vault/selected.php',{max_select:10,grid_id:this.$MercuryPhotoUploader0,source:'messenger',image_ids:w});};i(v,{initUploadButton:function(w){g.inform('MercuryPhotoUploader/initUploadButton/'+w,{},g.BEHAVIOR_PERSISTENT);},registerPhotoMenu:function(w,x){g.inform('MercuryPhotoUploader/registerPhotoMenu/'+w,{menu:x},g.BEHAVIOR_PERSISTENT);}});e.exports=v;});
__d("MercuryDataSources",[],function(a,b,c,d,e,f){var g={},h={add:function(i,j){g[i]=j;},get:function(i){!g[i];return g[i];}};e.exports=h;});
__d("MercuryTypeaheadRenderer",["Event","CSS","MercuryConstants","DOM","Image.react","MercuryParticipantsConstants","React","MercuryTypeaheadTemplates","copyProperties","cx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('MercuryConstants'),j=b('DOM'),k=b('Image.react'),l=b('MercuryParticipantsConstants'),m=b('React'),n=b('MercuryTypeaheadTemplates'),o=b('copyProperties'),p=b('cx');function q(s,t){var u=i.MercuryTypeaheadConstants,v;switch(s.type){case u.HEADER_TYPE:v=n[':fb:mercury:typeahead:header'].build();q.renderHeader(v,s);break;case u.USER_TYPE:v=n[':fb:mercury:typeahead:result'].build();q.renderPerson(v,s);break;default:throw new Error('Unsupported result type: '+s.type);}return v.getRoot();}o(q,{renderHeader:function(s,t){if(t.disabled){h.hide(s.getRoot());return;}var u=t.getLinkHandler&&t.getLinkHandler();if(u){var v=s.getNode('link');j.setContent(v,t.linkText);g.listen(v,'click',u);}else h.hide(s.getNode('link'));s.setNodeContent('text',t.text);},renderPersonWithBigPhoto:function(s,t){r(s,t,l.BIG_IMAGE_SIZE);},renderPerson:function(s,t){r(s,t,l.IMAGE_SIZE);}});function r(s,t,u){if(t.photo){var v=k({width:u,height:u,src:t.photo});m.renderComponent(v,s.getNode('image'));}if(t.text){j.setContent(s.getNode('name'),t.text);s.getRoot().setAttribute('aria-label',t.text);}var w=[];if(t.subtext||t.category){if(t.subtext)w.push(t.subtext);if(t.category)w.push(t.category);j.appendContent(s.getNode('snippet'),w.join(" \u00b7 "));}if(t.non_employee){if(w.length)j.prependContent(s.getNode('snippet')," \u00b7 ");var x=j.create('span',{className:"_52l8 highlight"},'(Non-Employee)');j.prependContent(s.getNode('snippet'),x);}}e.exports=q;});
__d("WebMessengerAddPeopleToConversationDialog",["ContextualTypeaheadView","Dialog","DOM","FreeformTokenizerBehavior","MercuryAPIArgsSource","MercuryDataSources","MercuryLogMessageType","MercurySourceType","MercuryTypeahead","MercuryTypeaheadRenderer","MercuryMessages","WebMessengerTemplates","MercuryThreads","WebMessengerConstants","tx"],function(a,b,c,d,e,f){var g=b('ContextualTypeaheadView'),h=b('Dialog'),i=b('DOM'),j=b('FreeformTokenizerBehavior'),k=b('MercuryAPIArgsSource'),l=b('MercuryDataSources'),m=b('MercuryLogMessageType'),n=b('MercurySourceType'),o=b('MercuryTypeahead'),p=b('MercuryTypeaheadRenderer'),q=b('MercuryMessages').get(),r=b('WebMessengerTemplates'),s=b('MercuryThreads').get(),t=b('WebMessengerConstants'),u=b('tx'),v={show:function(x){var y="Agregar personas",z={};z[t.FRIEND_TYPE]={uid:t.FRIEND_TYPE,type:t.HEADER_TYPE,disabled:true};z[t.NON_FRIEND_TYPE]={uid:t.NON_FRIEND_TYPE,text:"Otras personas",type:t.HEADER_TYPE};var aa=new o(l.get('MercuryRecipientsDataSource'),g);aa.setViewOption('renderer',p);aa.setViewOption('typeObjects',z);aa.setPlaceholder("Agregar amigos a este chat");var ba=[];ba.push({name:'subscribe',label:y,handler:w.bind(null,x,aa)});ba.push(h.CANCEL);var ca=r[':fb:web-messenger:add-people-dialog'].build(),da=new h().setTitle(y).setBody(ca.getRoot()).setButtons(ba).showLoading();s.getThreadMeta(x,function(ea){aa.setFullWidthView(ca.getNode('participantsTypeahead'));aa.setExcludedParticipants(ea.participants);aa.build();i.appendContent(ca.getNode('participantsTypeahead'),aa.getElement());da.show();aa.focus();},k.WEBMESSENGER);}};function w(x,y){var z=y.getTokens(),aa=z.map(function(ba){if(ba.getInfo().type==t.USER_TYPE){return 'fbid:'+ba.getValue();}else return 'email:'+ba.getValue();});if(!aa.length)return false;q.sendMessage(q.constructLogMessageObject(n.TITAN_WEB,x,m.SUBSCRIBE,{added_participants:aa}),null,k.WEBMESSENGER);return true;}e.exports=v;});
__d("Autosize",["CSS","cx","DOM","Style"],function(a,b,c,d,e,f){var g=b("CSS"),h=b('cx'),i=b("DOM"),j=b("Style"),k=['fontFamily','fontStyle','fontVariant','fontWeight','letterSpacing','textDecoration','textIndent','textTransform','whiteSpace','wordSpacing','wordWrap'],l=/^[0-9]+$/;function m(r){var s=r.cloneNode(true);g.addClass(s,"_4g");var t=r.clientWidth-j.getFloat(r,'paddingLeft')-j.getFloat(r,'paddingRight');j.set(s,'width',t+'px');var u=r.clientHeight-j.getFloat(r,'paddingTop')-j.getFloat(r,'paddingBottom');j.set(s,'height',u+'px');i.insertAfter(r,s);return s;}function n(r,s,t,u,v){var w=r.style.fontSize,x=r.style.height;j.set(r,"height","auto");if(s!==null){var y=r.style.width;j.set(r,"width","auto");}var z=0,aa=v.length-1;while(z<aa){var ba=Math.ceil((z+aa)/2);j.set(r,"font-size",v[ba]+u);if((t!==null&&r.scrollHeight>t)||(s!==null&&r.scrollWidth>s)){aa=ba-1;}else z=ba;}r.style.fontSize=w;r.style.height=x;if(s!==null)r.style.width=y;return v[z]+u;}function o(r,s,t,u,v,w){var x=r.style.fontSize,y=r.style.height;j.set(r,"height","auto");if(s!==null){var z=r.style.width;j.set(r,"width","auto");}j.set(r,"font-size",w+u);if((t===null||r.scrollHeight<=t)&&(s===null||r.scrollWidth<=s)){r.style.fontSize=x;r.style.height=y;if(s!==null)r.style.width=z;return w+u;}j.set(r,"font-size",v+u);if((t!==null&&r.scrollHeight>t)||(s!==null&&r.scrollWidth>s)){r.style.fontSize=x;r.style.height=y;if(s!==null)r.style.width=z;return v+u;}while(v+1<w){var aa=Math.ceil((v+w)/2);j.set(r,"font-size",aa+u);if((t!==null&&r.scrollHeight>t)||(s!==null&&r.scrollWidth>s)){w=aa;}else v=aa;}r.style.fontSize=x;r.style.height=y;if(s!==null)r.style.width=z;return v+u;}function p(r,s){this._wrap=r;this._attr=s;if(this._attr.sizes){var t=this._attr.sizes;for(var u=1,v=t.length;u<v;u++){if(t[u-1]<=t[u])continue;t.sort(function(x,y){return x-y;});break;}}else if(s.min>s.max){var w=s.min;s.min=s.max;s.max=w;}this.fit();}p.prototype.fit=function(r,s){var t=this._wrap;if(!t.clientWidth){q.push(this);return;}var u=m(t);if(typeof r==="undefined")r=this._attr.width;if(l.test(r)){u.style.width=r+"px";}else if(r!==null&&r!=="auto")u.style.width=r;if(typeof s==="undefined")s=this._attr.height;if(l.test(s)){u.style.height=s+"px";}else if(s!==null&&s!=="auto")u.style.height=s;var v=null;if(!this._attr.wrap)v=u.clientWidth;var w=null;if(this._attr.wrap||s!==null)w=u.clientHeight;var x;if(this._attr.sizes){x=n(u,v,w,"px",this._attr.sizes);}else x=o(u,v,w,"px",this._attr.min,this._attr.max);i.remove(u);j.set(t,"font-size",x);g.removeClass(t,"invisible_elem");};var q=[];p.onNodeInserted=function(){var r=q;q=[];r.forEach(function(s){s.fit();});};e.exports=p;});
__d("WebMessengerEditThreadDialog",["Event","Button","ContextualDialog","CSS","DOM","FileInput","FileInputUploader","Input","InputSelection","LayerFadeOnHide","LayerFadeOnShow","MercuryAPIArgsSource","MercuryLogMessageType","MercurySourceType","MercuryMessages","WebMessengerTemplates","MercuryThreads","URI","WebMessengerSubscriptionsHandler","csx","cx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Button'),i=b('ContextualDialog'),j=b('CSS'),k=b('DOM'),l=b('FileInput'),m=b('FileInputUploader'),n=b('Input'),o=b('InputSelection'),p=b('LayerFadeOnHide'),q=b('LayerFadeOnShow'),r=b('MercuryAPIArgsSource'),s=b('MercuryLogMessageType'),t=b('MercurySourceType'),u=b('MercuryMessages').get(),v=b('WebMessengerTemplates'),w=b('MercuryThreads').get(),x=b('URI'),y=b('WebMessengerSubscriptionsHandler'),z=b('csx'),aa=b('cx'),ba=':fb:web-messenger:read-view:header:edit-multichat';function ca(){var da=v[ba].build();this._dialog=new i({position:'below',addedBehaviors:[p,q]},da.getRoot());this._saveButton=da.getNode('saveButton');this._cancelButton=da.getNode('cancelButton');this._pictureInput=da.getNode('newPicture');this._uploadButton=da.getNode('uploadButton');this._uploadingThrobber=da.getNode('uploadingThrobber');this._uploadedFileDetails=da.getNode('uploadedFileDetails');this._fileNameNode=da.getNode('fileName');this._cancelImageButton=da.getNode('cancelImage');this._threadID=null;var ea=da.getNode('newName');this._uploadedImage=null;if(!this._pictureInput){var fa=k.scry(da.getRoot(),"._8-9")[0];this._pictureInput=k.create('input',{accept:'image/*',type:'file',className:"_n",name:'attachment[]',tabindex:2});new l(fa,this._uploadButton,this._pictureInput);}this._uploader=new m(this._pictureInput);this._uploader.setURI(x('/ajax/mercury/upload.php').setSubdomain('upload').toString());y.addSubscriptions(this._uploader.subscribe('success',this._onFileUploadSuccess.bind(this)),g.listen(this._pictureInput,'change',this._onFileUploadChange.bind(this)),g.listen(this._cancelImageButton,'click',this._resetImageUpload.bind(this)));g.listen(this._saveButton,'click',function(){this.save(n.getValue(ea));this._dialog.hide();}.bind(this));g.listen(this._cancelButton,'click',function(){this._dialog.hide();}.bind(this));this._dialog.subscribe('show',function(){var ga=w.getThreadMetaNow(this._threadID);n.setValue(ea,ga.name);this._resetImageUpload();}.bind(this));this._dialog.subscribe('aftershow',function(){o.set(ea,0,n.getValue(ea).length);}.bind(this));}ca.prototype.toggleShown=function(da,ea){if(!this._dialog.isShown()){this._dialog.setContext(da);this._threadID=ea;this._uploadedImage=null;this._dialog.show();}else this._dialog.hide();};ca.prototype.save=function(da){var ea=null,fa=w.getThreadMetaNow(this._threadID);if(fa)ea=fa.name;if((da||ea)&&(da!=ea))u.sendMessage(u.constructLogMessageObject(t.CHAT_WEB,this._threadID,s.THREAD_NAME,{name:da}),null,r.WEBMESSENGER);if(this._uploadedImage)u.sendMessage(u.constructLogMessageObject(t.CHAT_WEB,this._threadID,s.THREAD_IMAGE,{image:this._uploadedImage}));};ca.prototype._onFileUploadChange=function(event){var da=n.getValue(event.getTarget());if(da){h.setEnabled(this._saveButton,false);j.hide(this._uploadButton);j.hide(this._uploadedFileDetails);j.show(this._uploadingThrobber);this._uploader.send();}};ca.prototype._onFileUploadSuccess=function(da,ea){var fa=ea.response.getPayload();this._uploadedImage=fa.metadata[0];k.setContent(this._fileNameNode,this._uploadedImage.filename);j.hide(this._uploadingThrobber);j.hide(this._uploadButton);j.show(this._uploadedFileDetails);h.setEnabled(this._saveButton,true);};ca.prototype._resetImageUpload=function(){this._uploadedImage=null;j.hide(this._uploadingThrobber);j.hide(this._uploadedFileDetails);j.show(this._uploadButton);};e.exports=ca;});
__d("WebMessengerStateConstants",[],function(a,b,c,d,e,f){var g={STATE_CHANGE_EVENT:'state-changed',DETAIL:{COMPOSE_MAIN:'compose-main',COMPOSE_TYPEAHEAD_RESULTS:'compose-typeahead-results',COMPOSE_ALL_PEOPLE_RESULTS:'compose-all-people-results',RECENT_MESSAGES:'recent-messages',SEARCH_CONTEXT:'search-context',SEARCH_SNIPPET:'search-snippet',SEARCH_THREAD_SNIPPET:'search-thread-snippet',SHARED_PHOTOS:'shared-photos'},MASTER:{RECENT_THREADS:'recent-threads',SEARCH:'search'},MESSAGE_ACTION:{DELETE:'delete',FORWARD:'forward',REPORT_SPAM:'report_spam'}};e.exports=g;});
__d("WebMessengerOldToNewPermalink",["WebMessengerPermalinkConstants","WebMessengerStateConstants"],function(a,b,c,d,e,f){var g=b('WebMessengerPermalinkConstants'),h=b('WebMessengerStateConstants');function i(n){if(!j(n))return n;k(n);m(n);l(n);return n;}function j(n){var o=n.getQueryData();if(o.sk)switch(o.sk){case 'inbox':n.setPath(g.BASE_PATH);n.removeQueryData('sk');break;case 'other':n.setPath(g.OTHER_PATH);n.removeQueryData('sk');break;default:return false;}return true;}function k(n){var o=n.getQueryData();switch(o.action){case 'read':if(!o.tid){n.addQueryData({action:h.DETAIL.RECENT_MESSAGES});}else n.removeQueryData('action');break;}}function l(n){var o=n.getQueryData();if(o.tid){n.setPath(g.getURIPathForThreadID(o.tid,n.getPath()));n.removeQueryData('tid');}}function m(n){var o=n.getQueryData();if(!n.getPath().match(g.SEARCH_POSTFIX_PATH)&&o.action!=h.DETAIL.SEARCH_SNIPPET&&!o.mid){var p=o.query;if(o.query){var q=/\bis:(archived|spam)\b(.*)/,r=q.exec(o.query);if(r){switch(r[1]){case 'archived':n.setPath(g.ARCHIVED_PATH);break;case 'spam':n.setPath(g.SPAM_PATH);break;}var s=o.query.substr(0,o.query.length-r[0].length),t=r[2];p=(s.trim()+' '+t.trim()).trim();}}if(o.thread_query){n.setPath(n.getPath()+g.SEARCH_POSTFIX_PATH);n.setQueryData({query:o.thread_query});}else if(p){n.setPath(n.getPath()+g.SEARCH_POSTFIX_PATH);n.addQueryData({query:p});}else n.removeQueryData('query');}}e.exports=i;});
__d("WebMessengerStateStore",["MercuryAssert","PresenceState"],function(a,b,c,d,e,f){var g=b('MercuryAssert'),h=b('PresenceState'),i=null;function j(){var l=h.get();if(l&&l.wml)return l.wml;return {};}h.registerStateStorer(function(l){if(i)l.wml=i;i=null;});var k={getLastSeenThreadID:function(){var l=j();return l.thread_id||null;},getLastSeenFolder:function(){var l=j();return l.folder||null;},setLastSeen:function(l,m){m&&g.isThreadID(m);i={folder:l,thread_id:m||null};h.doSync();}};e.exports=k;});
__d("WebMessengerPermalinks",["MercuryAPIArgsSource","MercuryFilters","MercuryIDs","MercuryParticipants","MercuryParticipantTypes","MessagingTag","WebMessengerOldToNewPermalink","WebMessengerPermalinkConstants","MercuryServerRequests","WebMessengerStateConstants","WebMessengerStateStore","MercuryThreads","Token","URI","WebMessengerConstants","WebMessengerPreferences","MercuryUnreadState","isWebMessengerURI","goURI"],function(a,b,c,d,e,f){var g=b('MercuryAPIArgsSource'),h=b('MercuryFilters'),i=b('MercuryIDs'),j=b('MercuryParticipants'),k=b('MercuryParticipantTypes'),l=b('MessagingTag'),m=b('WebMessengerOldToNewPermalink'),n=b('WebMessengerPermalinkConstants'),o=b('MercuryServerRequests').get(),p=b('WebMessengerStateConstants'),q=b('WebMessengerStateStore'),r=b('MercuryThreads').get(),s=b('Token'),t=b('URI'),u=b('WebMessengerConstants'),v=b('WebMessengerPreferences'),w=b('MercuryUnreadState'),x=b('isWebMessengerURI'),y=b('goURI'),z='(/|\\?|$)',aa={getDefaultURI:function(){var na=new t().setSubdomain('www');na.setPath(n.BASE_PATH);return na;},goNextURI:function(na,oa,pa,qa){if(ja(na,oa,pa)){var ra=aa.getURI(na,oa,pa);y(ra,false,qa);return true;}return false;},getURI:function(na,oa,pa){var qa=aa.getDefaultURI();if(!na||!oa||!pa)return qa;switch(pa.folder){case l.OTHER:qa.setPath(n.OTHER_PATH);break;case l.ACTION_ARCHIVED:qa.setPath(n.ARCHIVED_PATH);break;case l.SPAM:qa.setPath(n.SPAM_PATH);break;}if(pa.filter&&(pa.filter!=h.ALL))qa.addQueryData({filter:pa.filter});var ra;switch(na){case p.MASTER.SEARCH:ra=false;qa.setPath(qa.getPath()+n.SEARCH_POSTFIX_PATH);break;}switch(oa){case p.DETAIL.COMPOSE_MAIN:case p.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:case p.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:qa.setPath(qa.getPath()+n.COMPOSE_POSTFIX_PATH);ra=false;break;case p.DETAIL.RECENT_MESSAGES:ra=!pa.thread_id;break;case p.DETAIL.SEARCH_CONTEXT:case p.DETAIL.SHARED_PHOTOS:ra=false;break;default:ra=true;break;}if(ra)qa.addQueryData({action:oa});if(pa.thread_id){var sa=r.getCanonicalUserInThread(pa.thread_id),ta=sa&&j.getNow(j.getIDForUser(sa));if(ta&&ta.type!==k.EVENT){var ua=(ta&&ta.vanity)||sa;qa.setPath(n.getURIPathForIDOrVanity(ua,qa.getPath()));}else{var va=o.getServerThreadIDNow(pa.thread_id),wa=va?va:pa.thread_id;qa.setPath(n.getURIPathForThreadID(wa,qa.getPath()));}}if(pa.query)qa.addQueryData({query:pa.query});if(pa.message_query)qa.addQueryData({mquery:pa.message_query});if(pa.message_id)qa.addQueryData({mid:pa.message_id});if(pa.reuse_composer)qa.addQueryData({rc:true});return qa;},processURI:function(na){na=m(na);if(!x(na))return false;var oa=ka(na);if(!oa.master_state||!oa.detail_state)return la(na);var pa={data:{folder:ha(na),filter:ia(na)},redirect:false,master_state:oa.master_state,detail_state:oa.detail_state};if(na.getQueryData().rc)pa.data.reuse_composer=true;pa=ea(na,pa);switch(oa.detail_state){case p.DETAIL.RECENT_MESSAGES:return ga(na,pa);case p.DETAIL.COMPOSE_MAIN:return ba(na,pa);case p.DETAIL.SEARCH_SNIPPET:pa=fa(na,pa);return pa;case p.DETAIL.SEARCH_CONTEXT:pa=ga(na,pa);pa=fa(na,pa);return da(na,pa);}pa.redirect=true;return pa;}};function ba(na,oa){var pa=null;if(na.getQueryData().to)pa=[].concat(na.getQueryData().to);return ca(pa,oa);}function ca(na,oa){if(na){oa.data.new_tokens=[];na.forEach(function(pa){var qa=j.getNow(j.getIDForUser(pa));if(qa){var ra={uid:pa,text:qa.name,type:u.USER_TYPE};oa.data.new_tokens.push(new s(ra));}});}oa.data.start=true;return oa;}function da(na,oa){var pa=na.getQueryData().mid;if(pa){oa.data.message_id=pa;}else oa.redirect=true;return oa;}function ea(na,oa){var pa=na.getQueryData().query;oa.data.query=pa;return oa;}function fa(na,oa){var pa=na.getQueryData().mquery;oa.data.message_query=pa;return oa;}function ga(na,oa){var pa=n.getThreadIDFromURI(na);if(pa){var qa=i.isValidThreadID(pa)?pa:o.getClientThreadIDNow(pa);if(qa){oa.data.thread_id=qa;}else oa.redirect=true;}else{var ra=n.getUserIDOrVanity(na.getPath());if(ra){var sa=j.getIDFromVanityOrFBID(ra),ta=sa&&r.getCanonicalThreadToParticipant(sa,null,g.WEBMESSENGER);if(ta){if(ta.timestamp){oa.data.thread_id=ta.thread_id;}else{oa.detail_state=p.DETAIL.COMPOSE_MAIN;oa=ca([j.getUserID(sa)],oa);}}else oa.redirect=true;}}return oa;}function ha(na,oa){var pa=na.getPath();if(pa.match('^'+n.ARCHIVED_PATH+z))return l.ACTION_ARCHIVED;if(pa.match('^'+n.OTHER_PATH+z))return l.OTHER;if(pa.match('^'+n.SPAM_PATH+z))return l.SPAM;if(oa!==undefined)return oa;return l.INBOX;}function ia(na){return na.getQueryData().filter||h.ALL;}function ja(na,oa,pa){if(oa===p.DETAIL.SEARCH_CONTEXT||oa===p.DETAIL.SEARCH_THREAD_SNIPPET||oa===p.DETAIL.SHARED_PHOTOS)return false;if(pa&&pa.no_uri===true){delete pa.no_uri;return false;}var qa=oa==p.DETAIL.COMPOSE_MAIN||oa==p.DETAIL.COMPOSE_TYPEAHEAD_RESULTS||oa==p.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS;if(qa&&(!pa.start||pa.new_tokens))return false;if(!na||!oa||!pa)return true;if(pa.bug_reporting_enabled)return false;return !pa.message_action;}function ka(na){var oa={},pa=na.getPath(),qa=na.getQueryData(),ra=pa.match(n.BASE_PATH+'(/[^/]+)?'+n.SEARCH_POSTFIX_PATH+z);oa.master_state=ra&&qa.query?p.MASTER.SEARCH:p.MASTER.RECENT_THREADS;if(qa.action){oa.detail_state=qa.action;return oa;}if(pa.match(n.BASE_PATH+'(/[^/]+)?'+n.COMPOSE_POSTFIX_PATH+z)){oa.detail_state=p.DETAIL.COMPOSE_MAIN;return oa;}if(pa.match(n.TID_POSTFIX_PARTIAL_PATH)||n.getUserIDOrVanity(pa)){if(qa.mid&&qa.mquery){oa.detail_state=p.DETAIL.SEARCH_CONTEXT;}else oa.detail_state=p.DETAIL.RECENT_MESSAGES;}else if(qa.mquery)oa.detail_state=p.DETAIL.SEARCH_SNIPPET;return oa;}function la(na){var oa=ha(na,null)||q.getLastSeenFolder(),pa=q.getLastSeenThreadID()||ma(oa||l.INBOX),qa=w.get();if(oa===l.OTHER&&qa.getUnreadCount(oa)===0){var ra=l.INBOX;if(qa.exceedsMaxCount(ra)||qa.getUnreadCount(ra)>0)oa=ra;}var sa={redirect:!!pa||!!oa,replace:true,master_state:p.MASTER.RECENT_THREADS,detail_state:p.DETAIL.RECENT_MESSAGES,data:{folder:oa||l.INBOX,filter:h.ALL,thread_id:pa}};return sa;}function ma(na){var oa=v.lastReadThreadForFolder[na];if(oa){return o.getClientThreadIDNow(oa.thread_id)||null;}else return null;}e.exports=aa;});
__d("WebMessengerStateManager",["Arbiter","Dialog","Env","Focus","JSLogger","MercuryFilters","WebMessengerPermalinks","WebMessengerStateConstants","WebMessengerEvents","MessagingTag","copyProperties","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Dialog'),i=b('Env'),j=b('Focus'),k=b('JSLogger'),l=b('MercuryFilters'),m=b('WebMessengerPermalinks'),n=b('WebMessengerStateConstants'),o=b('WebMessengerEvents'),p=b('MessagingTag'),q=b('copyProperties'),r=b('tx'),s=k.create('wm_state_manager'),t=i.user,u=q(new g(),{getCurrentUserID:function(){return t;},getCurrentMasterState:function(){return y;},getCurrentDetailState:function(){return z;},getCurrentStateData:function(){return aa;},setUserID:function(ca){t=ca||i.user;},updateMasterState:function(ca,da){u.updateAllStates(ca,z,da);},updateDetailState:function(ca,da){u.updateAllStates(y,ca,da);},updateAllStates:function(ca,da,ea){for(var fa=0;fa<ba.length;fa++)if(ba[fa]){var ga=ba[fa](ca,da,ea);if(ga){x(ga,ca,da,ea);return;}}v(ca,da,ea);},updateStateOnURI:function(ca,da,ea){w(ca,da,ea);},registerConfirmationBeforeStateUpdate:function(ca){var da=ba.length;ba.push(ca);return da;},unregisterConfirmationBeforeStateUpdate:function(ca){delete ba[ca];}});function v(ca,da,ea){if(!ea.folder)ea.folder=aa.folder;if(!ea.filter)ea.filter=aa.filter;if(!m.goNextURI(ca,da,ea))w(ca,da,ea);}function w(ca,da,ea){y=ca;z=da;aa=ea;var fa=q({},aa);fa.new_tokens=[];(aa.new_tokens||[]).forEach(function(ga){fa.new_tokens.push(ga.getInfo());});fa.new_tokens=[];s.log('state_updated',{master_state:y,detail_state:z,data:fa});u.inform(n.STATE_CHANGE_EVENT);}function x(ca,da,ea,fa){s.log('confirmation_dialog',{master_state:y,detail_state:z,data:aa,new_master_state:da,new_detail_state:ea,new_data:fa,text:ca});var ga=[];ga.push({name:'yes',label:"S\u00ed",handler:function(){v(da,ea,fa);o.inform(o.FOCUS_COMPOSER);}});ga.push(q({handler:o.inform.bind(o,o.FOCUS_COMPOSER)},h.CANCEL));var ha=new h().setTitle("\u00bfEst\u00e1s seguro de que quieres salir?").setBody(ca).setButtons(ga).setModal(true).show(),ia=ha.getButtonElement('yes');ia&&j.set(ia);}var y=n.MASTER.RECENT_THREADS,z=n.DETAIL.RECENT_MESSAGES,aa={thread_id:null,folder:p.INBOX,filter:l.ALL},ba=[undefined];e.exports=u;});
__d("WebMessengerDetailViewHeaderControl",["WebMessengerAddPeopleToConversationDialog","Autosize","AvailableListConstants","Bootloader","ContextualDialog","CSS","DOM","WebMessengerEditThreadDialog","Event","HovercardLink","HoverFlyout","JSXDOM","LastMobileActiveTimes","LayerFadeOnHide","LayerFadeOnShow","LayerHideOnTransition","MercuryAPIArgsSource","MercuryConfig","MercuryParticipantTypes","MercuryParticipants","MercuryPresence","ScrollableArea","WebMessengerStateConstants","WebMessengerStateManager","Style","WebMessengerTemplates","MercuryThreadInformer","MercuryThreadMetadataRenderer","MercuryThreads","Tooltip","WebMessengerConstants","WebMessengerEvents","WebMessengerSubscriptionsHandler","copyProperties","csx","cx","curry","fbt","tx"],function(a,b,c,d,e,f){var g=b('WebMessengerAddPeopleToConversationDialog'),h=b('Autosize'),i=b('AvailableListConstants'),j=b('Bootloader'),k=b('ContextualDialog'),l=b('CSS'),m=b('DOM'),n=b('WebMessengerEditThreadDialog'),o=b('Event'),p=b('HovercardLink'),q=b('HoverFlyout'),r=b('JSXDOM'),s=b('LastMobileActiveTimes'),t=b('LayerFadeOnHide'),u=b('LayerFadeOnShow'),v=b('LayerHideOnTransition'),w=b('MercuryAPIArgsSource'),x=b('MercuryConfig'),y=b('MercuryParticipantTypes'),z=b('MercuryParticipants'),aa=b('MercuryPresence'),ba=b('ScrollableArea'),ca=b('WebMessengerStateConstants'),da=b('WebMessengerStateManager'),ea=b('Style'),fa=b('WebMessengerTemplates'),ga=b('MercuryThreadInformer').get(),ha=b('MercuryThreadMetadataRenderer').get(),ia=b('MercuryThreads').get(),ja=b('Tooltip'),ka=b('WebMessengerConstants'),la=b('WebMessengerEvents'),ma=b('WebMessengerSubscriptionsHandler'),na=b('copyProperties'),oa=b('csx'),pa=b('cx'),qa=b('curry'),ra=b('fbt'),sa=b('tx');function ta(ab){this._rootElement=ab;m.empty(this._rootElement);this._renderHeaderBar();}ta.prototype.hideView=function(){l.hide(this._rootElement);};ta.prototype.updateView=function(){l.removeClass(this._rootElement,'isMultichat');l.show(this._rootElement);if(this._listener){ga.unsubscribe(this._listener);this._listener=null;}var ab=ca;switch(da.getCurrentDetailState()){case ab.DETAIL.RECENT_MESSAGES:case ab.DETAIL.SEARCH_CONTEXT:case ab.DETAIL.SEARCH_THREAD_SNIPPET:case ab.DETAIL.SHARED_PHOTOS:this.setThreadID(da.getCurrentStateData().thread_id);break;default:this.setThreadID(null);break;}la.detailDOMChanged();};ta.prototype.setThreadID=function(ab){this._threadID=ab;if(this._threadID){this._listener=ga.listen(this._threadID,this.updateView.bind(this));ma.addSubscriptions(this._listener);}ab&&ia.getThreadMeta(ab,function(bb){if(this._threadID==ab)l.conditionClass(this._rootElement,'isMultichat',!bb.is_canonical&&ia.canReply(ab));}.bind(this));};ta.prototype._renderHeaderBar=function(){this._headerBar=fa[':fb:web-messenger:read-view:header'].build();m.appendContent(this._rootElement,this._headerBar.getRoot());var ab=this._headerBar.getNode('editThreadName'),bb=this._headerBar.getNode('addPeopleToThread'),cb=new n();this._title_node_wrapper=this._headerBar.getNode('headerName');this._relationship_status=this._headerBar.getNode('relationshipStatus');ma.addSubscriptions(o.listen(this._headerBar.getNode('closeButton'),'click',function(){var db=na(da.getCurrentStateData(),{all_people_query:undefined});da.updateDetailState(ca.DETAIL.COMPOSE_MAIN,db);}),o.listen(ab,'click',function(event){this._threadID&&cb.toggleShown(this._headerBar.getNode('headerName'),this._threadID);return true;}.bind(this)),o.listen(bb,'click',function(event){this._threadID&&g.show(this._threadID);return true;}.bind(this)),la.subscribe(la.DETAIL_DOM_CHANGED,this.updateHeaderBar.bind(this)));};ta.prototype.updateHeaderBar=function(){var ab=this._headerBar.getNode('headerButtons');this._title_node_wrapper.style.fontSize='';var bb=r.div(null);m.setContent(this._title_node_wrapper,bb);var cb=this._headerBar.getNode('webMessengerRecIndicator');cb&&l.hide(cb);var db=da.getCurrentDetailState(),eb=db==ca.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS;l.conditionShow(this._headerBar.getNode('closeButton'),eb);l.conditionClass(this._title_node_wrapper,'allPeopleResults',eb);l.hide(this._relationship_status);l.removeClass(this._title_node_wrapper,"_50jz");var fb,gb;switch(db){case ca.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:gb=da.getCurrentStateData().all_people_query;fb=m.tx._("Personas que coinciden con {query}",{query:m.create('strong',{},gb)});break;case ca.DETAIL.COMPOSE_MAIN:case ca.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:fb="Nuevo mensaje";break;case ca.DETAIL.SEARCH_SNIPPET:gb=da.getCurrentStateData().message_query;if(gb)fb=sa._("Mensajes con la palabra: {query}",{query:gb});break;}var hb=!fb&&!this._threadID;if(hb)fb="No hay selecciones";l.conditionClass(this._title_node_wrapper,"_3jd",hb);if(fb){m.setContent(bb,fb);za(this._title_node_wrapper,this._threadID,ab);return;}ha.renderAndSeparatedParticipantList(this._threadID,bb,{check_length:false,names_renderer:function(ib){var jb=ib.map(function(lb){var mb=ib.length===1?lb.name:lb.short_name,nb=z.getUserID(lb.id);if(nb&&lb.href){var ob=r.a({href:lb.href},mb);if(ib.length===1)ob.setAttribute('data-hovercard',p.constructEndpoint({id:nb}));return ob;}else return mb;});if(ib.length===1&&ib[0].fbid!==null){var kb=r.span(null);m.setContent(kb,jb[0]);va(ib[0],kb);jb[0]=kb;}return jb;}.bind(this)});if(cb)ia.getThreadMeta(this._threadID,function(ib){wa(ib,cb);});if(x.SocialContextGK)this.renderRelationshipStatusIndicator();this.renderParticipantListFlyout(bb);this.renderNamedThreadParticipantCount(bb);za(this._title_node_wrapper,this._threadID,ab);new h(this._title_node_wrapper,{min:11,max:16,height:100,width:this._title_node_wrapper.offsetWidth,wrap:false});};ta.prototype.renderNamedThreadParticipantCount=function(ab){ia.getThreadMeta(this._threadID,function(bb){if(bb.name){var cb=ha.renderParticipantCount(bb.thread_id,{count:bb.participants.length-1}),db=m.create('span',{className:"_1us"},sa._("({participants})",{participants:cb}));m.appendContent(ab,db);}},w.WEBMESSENGER);};ta.prototype.renderRelationshipStatusIndicator=function(){var ab=this._relationship_status,bb=this._title_node_wrapper,cb=this._threadID;ia.getThreadMeta(this._threadID,function(db){var eb=db.participants.filter(function(fb){return fb!==z.user;});if(eb.length>1)return;z.getMulti(eb,function(fb){if(this._threadID!=cb)return;var gb=eb.map(function(ib){return fb[ib];}),hb=gb[0];if(hb&&!hb.is_friend&&(hb.type===y.USER||hb.type===y.FRIEND)){m.setContent(ab,ya(hb));l.show(ab);l.addClass(bb,"_50jz");}}.bind(this));}.bind(this),w.WEBMESSENGER);};ta.prototype.renderParticipantListFlyout=function(ab){this._dialog&&this._dialog.destroy();delete this._dialog;this._flyout&&this._flyout.destroy();delete this._flyout;var bb=this._threadID;ia.getThreadMeta(this._threadID,function(cb){var db=cb.participants.filter(function(eb){return eb!==z.user;});if(db.length<=1)return;z.getMulti(db,function(eb){if(this._threadID!=bb)return;var fb=0,gb=fa[':fb:web-messenger:flyoutlist'].build();for(var hb in eb){var ib=eb[hb],jb=fa[':fb:web-messenger:flyoutlist-profile-item'].build();jb.getNode('profilePhoto').setAttribute('src',ib.image_src);var kb=jb.getNode('title');if(ib.href){var lb=r.a({href:ib.href});m.setContent(kb,lb);kb=lb;var mb=jb.getNode('profilePhoto'),nb=r.a({href:ib.href});m.replace(mb,nb);m.setContent(nb,mb);}m.setContent(kb,ib.name);va(ib,jb.getNode('title'));m.setContent(jb.getNode('infoLine'),ya(ib));fb++;m.appendContent(gb.getNode('list'),jb.getRoot());}var ob=gb.getRoot();this._dialog=new k({context:ab,position:'below',addedBehaviors:[t,u,v]},ob);this._flyout=new q();this._flyout.init(this._dialog);this._flyout.initNode(ab);xa(this._flyout,ob,fb);}.bind(this));}.bind(this),w.WEBMESSENGER);};ta.prototype.destroy=function(){};function ua(ab,bb,cb){var db=s.getShortDisplay(cb);if(!db||ab.get(cb)!==i.MOBILE){ja.remove(bb);return;}ja.set(bb,ra._("Activo(a) por \u00faltima vez hace {time}",[ra.param("time",db)]),'right');}function va(ab,bb){var cb=z.getUserID(ab.id);if(!cb)return;var db=r.span(null);aa.updateOnPresenceChanges(cb,db);if(m.isNode(bb)){j.loadModules(['PresenceStatus','ChatOpenTab'],function(eb,fb){o.listen(db,'mouseenter',qa(ua,eb,db,cb));o.listen(db,'click',fb.openUserTab.curry(cb,'web messenger header'));});m.appendContent(bb,db);}}function wa(ab,bb){if(bb)z.getMulti(ab.participants,function(cb){var db=true;for(var eb in cb)db=db&&cb[eb].employee;l.conditionShow(bb,db);});}function xa(ab,bb,cb){if(cb<=ka.MAX_VISIBLE_IN_FLYOUT)return;var db=ba.fromNative(bb,{fade:true});bb.style.height=ka.PARTICIPANTS_FLYOUT_HEIGHT+'px';ab.subscribe('show',function(){db.showScrollbar(false);});}function ya(ab){var bb=ab.social_snippets||{},cb=Object.keys(bb);if(cb.length>0){var db=cb.slice(0,1).map(function(ib){return bb[ib];});return db;}var eb=ab.networks||{},fb=Object.keys(eb),gb=fb.length>0,hb=2;if(gb){var db=fb.slice(0,hb).map(function(ib){return eb[ib];});return db.join(' \u00b7 ');}return '';}function za(ab,bb,cb){var db=cb.offsetWidth,eb=m.scry(document.body,"div._2nd");if(eb.length)db+=eb[0].offsetWidth;var fb=ab.parentNode.offsetWidth;if(fb>db)ea.set(ab,'max-width',(fb-db)+'px');}e.exports=ta;});
__d("WebMessengerFlexibleArea",["Event","ArbiterMixin","CSS","cx","DOM","Style","throttle","Vector","createArrayFrom","mixin"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ArbiterMixin'),i=b('CSS'),j=b('cx'),k=b('DOM'),l=b('Style'),m=b('throttle'),n=b('Vector'),o=b('createArrayFrom'),p=[],q=b("mixin");function r(){p.forEach(function(w){w.draw();});}g.listen(window,'resize',m(r,50));var s=q(h);for(var t in s)if(s.hasOwnProperty(t))v[t]=s[t];var u=s===null?null:s.prototype;v.prototype=Object.create(u);v.prototype.constructor=v;v.__superConstructor__=s;function v(w){this.minFlexAreaHeight=0;this.flexArea=w;this.container=null;this.padding=0;this.sizeToFit=false;p.push(this);}v.prototype.setContainer=function(w){this.container=w;return this;};v.prototype.setPadding=function(w){this.padding=w;return this;};v.prototype.setMinFlexAreaHeight=function(w){this.minFlexAreaHeight=w;return this;};v.prototype.setSizeToFit=function(w){this.sizeToFit=w;return this;};v.prototype.draw=function(){if(this.flexArea){var w=this._flexHeight;this.inform('predraw',{old_height:w});var x=n.getViewportDimensions().y-this.padding;x-=n.getElementPosition(this.container||this.flexArea).y;if(this.container){o(this.container.childNodes).forEach(function(y){x-=n.getElementDimensions(y).y;});x+=n.getElementDimensions(this.flexArea).y;}if(this.sizeToFit)x=Math.min(x,this._getNaturalHeight());if(x<this.minFlexAreaHeight)x=this.minFlexAreaHeight;if(isNaN(x)||x<0)x=0;if(x!==w){l.set(this.flexArea,'height',x+'px');this._flexHeight=x;this.inform('height_changed',{height:x,old_height:w});}}return this;};v.prototype.destroy=function(){var w=p.indexOf(this);w>=0&&p.splice(w,1);r();};v.prototype._getNaturalHeight=function(){var w=this.flexArea.cloneNode(true);i.addClass(w,"_2ys");l.set(w,'height','auto');k.insertAfter(this.flexArea,w);var x=n.getElementDimensions(w).y;k.remove(w);return x;};v.prototype._getFlexHeight=function(){if(isNaN(this._flexHeight))this._flexHeight=n.getElementDimensions(this.flexArea).y;return this._flexHeight;};e.exports=v;});
__d("WebMessengerFlexibleScrollArea",["CSS","DOMQuery","ScrollableArea","Style","WebMessengerFlexibleArea","emptyFunction","throttle"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOMQuery'),i=b('ScrollableArea'),j=b('Style'),k=b('WebMessengerFlexibleArea'),l=b('emptyFunction'),m=b('throttle');for(var n in k)if(k.hasOwnProperty(n))p[n]=k[n];var o=k===null?null:k.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=k;function p(q,r){this._scroll=i.fromNative(q,r);k.call(this,q);this._scrollBody=h.find(this.flexArea,'.uiScrollableAreaBody');var s=h.scry(this.flexArea,'.uiScrollableAreaShadow');this._shadow=s.length?s[0]:null;this._scrollContent=h.find(this.flexArea,'.uiScrollableAreaContent');this._scrollCallback=l;this._drawSubscription=this.subscribe('height_changed',this.poke.bind(this));this._scrollSub=this._scroll.subscribe('scroll',m(this._onScroll,50,this));}p.prototype.setBottomAligned=function(q){var r=q!==false;if(this._bottomEdgeBias===r)return;g.conditionClass(this.flexArea,'uiScrollableAreaBottomAligned',r);this._bottomEdgeBias=r;if(this._bottomEdgeBias){this.scrollToBottom(false);}else this.scrollToTop(false);this.poke.bind(this).defer();return this;};p.prototype.setInfiniteScrollHandler=function(q,r){if(r){this._infiniteUpwardScrollHandler=q;}else this._infiniteDownScrollHandler=q;return this;};p.prototype.setScrollCallback=function(q){this._scrollCallback=q;return this;};p.prototype.setTabbable=function(q){this._scroll._wrap.setAttribute('tabindex',q?'0':'-1');};p.prototype.poke=function(q,r){var s=this._scrollHeight,t=this._scroll.getScrollTop();this._scrollHeight=this._getScrollHeight();if(typeof s=='undefined'||(r&&!r.old_height)){this._bottomEdgeBias&&this._setShadowHeight();return;}var u=this._scrollHeight-s;if(this._bottomEdgeBias){var v=r?r.height-r.old_height:0;clearTimeout(this._pollTimer);this._pollTimer=this.poke.bind(this).defer(200);var w,x=u-v;if(this._scrollHeight>this._getFlexHeight()){w=t+x;w=w<0?0:w;}else w=0;x>0&&this._setShadowHeight();if(w!==t)this._scroll.setScrollTop(w,false);x<0&&this._setShadowHeight();}else if(u)this._scroll.setScrollTop(t,false);};p.prototype.setScrollTop=function(q,r){this._scroll.setScrollTop(q,r);};p.prototype.getScrollableArea=function(){return this._scroll;};p.prototype.isScrolledToBottom=function(){return this._scroll.isScrolledToBottom();};p.prototype.scrollToBottom=function(q){this._scroll.scrollToBottom(q);if(this._bottomEdgeBias)this._scrollBottom=0;};p.prototype.isScrolledToTop=function(){return this._scroll.getScrollTop()===0;};p.prototype.scrollToTop=function(q){this._scroll.scrollToTop(q);};p.prototype.scrollIntoView=function(q,r){this._scroll.scrollIntoView(q,r);};p.prototype.destroy=function(){this._scrollSub&&this._scrollSub.unsubscribe();this.unsubscribe(this._drawSubscription);clearTimeout(this._pollTimer);o.destroy.call(this);this._scroll.destroy();};p.prototype._getScrollHeight=function(){if(this._bottomEdgeBias){return this._scrollContent.offsetHeight;}else return this._scroll.getScrollHeight();};p.prototype._setShadowHeight=function(){var q=this._shadowHeight;this._shadowHeight=this._scrollHeight-this._getFlexHeight();if(this._shadowHeight<0)this._shadowHeight=0;if(this._shadowHeight!==q)j.set(this._shadow,'height',this._shadowHeight+'px');};p.prototype._onScroll=function(){var q=this._scroll.getScrollTop(),r=this._getScrollHeight();if(q<this._getFlexHeight())this._infiniteUpwardScrollHandler&&this._infiniteUpwardScrollHandler();if(q+2*this._getFlexHeight()>r)this._infiniteDownScrollHandler&&this._infiniteDownScrollHandler();this._scrollCallback(this._scroll);};e.exports=p;});
__d("WebMessengerDeleteThreadDialog",["Dialog","tx","MercuryThreads"],function(a,b,c,d,e,f){var g=b('Dialog'),h=b('tx'),i=b('MercuryThreads').get(),j={show:function(k){var l=[];l.push({name:'delete_conversation',label:"Eliminar conversaci\u00f3n",handler:i.deleteThread.bind(i,k)});l.push(g.CANCEL);new g().setTitle("\u00bfQuieres eliminar toda la conversaci\u00f3n?").setBody("Si eliminas tu copia de esta conversaci\u00f3n, no podr\u00e1s recuperarla.").setButtons(l).show();}};e.exports=j;});
__d("ListInputTargetTracker",[],function(a,b,c,d,e,f){function g(){this._index=undefined;this._items=[];}g.prototype.getIndex=function(){return this._index;};g.prototype.setIndex=function(h){this._index=Math.max(0,Math.min(h,this._items.length-1));};g.prototype.getNumItems=function(){return this._items.length;};g.prototype.getItem=function(){if(this._index!==undefined)return this._items[this._index];};g.prototype.setTargetItem=function(h){this.updateIndex(this._items,h);};g.prototype.removeItemAtIndex=function(h){this._items.splice(h,1);};g.prototype.removeItemByValue=function(h){var i=this._items.indexOf(h);this.removeItemAtIndex(i);};g.prototype.moveUp=function(){if(this._index===undefined||this._index===0){if(this._items.length){this._index=this._items.length-1;return true;}}else if(this._index>0){this._index--;return true;}return false;};g.prototype.moveDown=function(){if(this._index===undefined||this._index===this._items.length-1){if(this._items.length){this._index=0;return true;}}else if(this._index<this._items.length-1){this._index++;return true;}return false;};g.prototype.updateIndex=function(h,i){this._items=h||[];if(i){var j=this._items.indexOf(i);if(j>=0){this._index=j;}else if(this._index!==undefined)if(this._items.length>0){this._index=Math.min(this._index,this._items.length-1);}else this._index=undefined;}else this._index=undefined;return this._index;};e.exports=g;});
__d("WebMessengerShortcuts",["DialogX","DOM","KeyEventController","LayerHideOnEscape","ListInputTargetTracker","MercuryAPIArgsSource","MessagingTag","Parent","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","MercuryThreads","UserAgent","WebMessengerEvents","arrayContains","csx","cx","ge","tx"],function(a,b,c,d,e,f){var g=b('DialogX'),h=b('DOM'),i=b('KeyEventController'),j=b('LayerHideOnEscape'),k=b('ListInputTargetTracker'),l=b('MercuryAPIArgsSource'),m=b('MessagingTag'),n=b('Parent'),o=b('WebMessengerStateConstants'),p=b('WebMessengerStateManager'),q=b('WebMessengerTemplates'),r=b('MercuryThreads').get(),s=b('UserAgent'),t=b('WebMessengerEvents'),u=b('arrayContains'),v=b('csx'),w=b('cx'),x=b('ge'),y=b('tx'),z=null,aa=null,ba=null,ca={c:{callback:ha,description:"Iniciar un mensaje nuevo",section:'navigation',uses_meta:true},g:{callback:ia,description:"Buscar conversaciones",section:'searchAndHelp',uses_meta:true},i:{callback:qa.curry(m.INBOX),description:"Ir a la bandeja de entrada",section:'navigation',uses_meta:true},u:{callback:qa.curry(m.OTHER),description:"Ir a otros",section:'navigation',uses_meta:true},z:{callback:ka,description:"Archivar\/desarchivar conversaci\u00f3n",otherKeys:['DELETE','BACKSPACE'],section:'conversation',uses_meta:true},r:{callback:la,description:"Marcar el mensaje como le\u00eddo\/no le\u00eddo",section:'conversation',uses_meta:true},UP:{callback:ma,description:"Seleccionar la siguiente conversaci\u00f3n",section:'navigation',uses_meta:false},DOWN:{callback:na,description:"Seleccionar la conversaci\u00f3n anterior",section:'navigation',uses_meta:false},q:{callback:sa,description:"Mostrar\/ocultar accesos directos",section:'searchAndHelp',uses_meta:true},j:{callback:ta,description:"Marcar como spam",section:'conversation',uses_meta:true}},da={registerGeneralShortcuts:function(){aa=new k();for(var ua in ca){var va=ca[ua],wa=va.otherKeys||[];wa.push(ua);for(var xa=0;xa<wa.length;xa++)i.registerKey(wa[xa],va.callback,ga.curry(va.uses_meta));}},updateThreadlistIndex:function(ua,va,wa){z=ua;if(aa){if(!u(va,wa))wa=null;aa.updateIndex(va,wa);}},openSearchThread:function(){var ua=pa(),va=p.getCurrentMasterState();if(ua&&va==o.MASTER.SEARCH)z.openSearchThread(ua);},showOrHideShortcuts:sa};function ea(){return s.osx()?'CTRL':'ALT';}function fa(ua){function va(){if(!ba){var wa=h.find(document.body,"._ksg");ba=[];do{wa=wa.parentNode;ba.push(wa);}while(wa&&wa!==document.body);}return ba;}if(!n.byClass(ua,"_ksg"))if(!u(va(),ua))if(!h.scry(ua,"._5hu2").length)return false;return true;}function ga(ua,event,va){if(!i.filterEventTypes(event,va))return false;if(!fa(event.getTarget()))return false;var wa;if(ua)switch(ea()){case 'CTRL':wa='ctrlKey';break;case 'ALT':wa='altKey';break;}var xa=['ctrlKey','metaKey','altKey','shiftKey'];for(var ya=0;ya<xa.length;ya++)if(xa[ya]!==wa&&event[xa[ya]])return false;return !ua||event[wa];}function ha(){p.updateDetailState(o.DETAIL.COMPOSE_MAIN,{start:true});return false;}function ia(){t.focusAndSelectSearch();return false;}function ja(ua){var va;if(aa.getNumItems()>1){var wa=aa.getIndex();aa.setIndex(wa===0?1:wa-1);va=pa();}ua();p.updateDetailState(o.DETAIL.RECENT_MESSAGES,{folder:p.getCurrentStateData().folder,thread_id:va});if(va)z._manager.scrollIntoView(x(aa.getItem()),false);}function ka(){var ua=pa();if(ua){r.getThreadMeta(ua,function(va){if(va.folder==m.SPAM)return;ja(function(){r.changeThreadArchivedStatus(va.thread_id,!va.is_archived);});},l.WEBMESSENGER);return false;}}function la(){var ua=pa();if(ua){r.getThreadMeta(ua,function(va){var wa=!va.unread_count;r.changeThreadReadStatus(ua,!wa);},l.WEBMESSENGER);return false;}}function ma(){if(aa)if(aa.getIndex()===0){switch(p.getCurrentMasterState()){case o.MASTER.SEARCH:aa.moveUp();oa();z._manager.scrollToBottom(false);break;default:z._manager.scrollToTop(false);t.focusSearch();}}else{if(aa.getItem()){aa.moveUp();}else aa.moveDown();oa();}return false;}function na(){var ua=p.getCurrentMasterState();if(aa&&(ua!==o.MASTER.RECENT_THREADS||aa.getIndex()<aa.getNumItems()-1)){aa.moveDown();oa();}return false;}function oa(){var ua=pa();if(ua){var va=p.getCurrentMasterState();if(va==o.MASTER.SEARCH){z.updateKeyboardSelection(ua);t.focusSearch();}else p.updateDetailState(o.DETAIL.RECENT_MESSAGES,{thread_id:ua});if(aa)if(aa.getIndex()===0){z._manager.scrollToTop(false);}else z._manager.scrollIntoView(x(aa.getItem()),false);}}function pa(){var ua=aa&&aa.getItem();if(typeof ua==='string'&&ua.indexOf(':')!==-1)return ua.substr(ua.indexOf(':')+1);return null;}function qa(ua){var va=p.getCurrentMasterState(),wa=va==o.MASTER.SEARCH?null:p.getCurrentStateData().thread_id;p.updateMasterState(o.MASTER.RECENT_THREADS,{thread_id:wa,folder:ua});}var ra;function sa(){if(!ra){var ua={};for(var va in ca){var wa=ca[va];if(!wa.uses_meta)continue;var xa=q[':fb:web-messenger:shortcuts-dialog:row'].build();xa.setNodeContent('meta',ea());if(wa.keyName){xa.setNodeContent('key',wa.keyName);}else xa.setNodeContent('key',va);xa.setNodeContent('description',wa.description);if(!ua[wa.section])ua[wa.section]=[];ua[wa.section].push(xa.getRoot());}var ya=q[':fb:web-messenger:shortcuts-dialog'].build();for(var za in ua)ya.setNodeContent(za,ua[za]);var ab=h.scry(ya.getRoot(),"._1yw")[0],bb=null;if(ab)bb=h.getID(ab);ra=new g({modal:true,titleID:bb,width:565},ya.getRoot());ra.enableBehavior(j);}if(ra.isShown()){ra.hide();}else ra.show();return false;}function ta(){var ua=pa();if(ua){r.getThreadMeta(ua,function(va){if(va.folder==m.SPAM)return;ja(r.markThreadSpam.bind(r,ua));},l.WEBMESSENGER);return false;}}e.exports=da;});
__d("WebMessengerDetailViewActionsMenuControl",["Event","WebMessengerAddPeopleToConversationDialog","WebMessengerDeleteThreadDialog","Arbiter","AsyncDialog","AsyncRequest","MercuryChatUtils","MercuryConfig","CSS","Dialog","DOM","fbt","Focus","Input","Keys","WebMessengerActionsMenuItem","MercuryAPIArgsSource","MercuryLogMessageType","MercurySourceType","MercuryThreadMuter","MercuryMessages","MessagingTag","MercuryParticipants","MercuryServerRequests","WebMessengerShortcuts","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","MercuryThreadInformer","MercuryThreads","Toggler","URI","WebMessengerSubscriptionsHandler","copyProperties","emptyFunction","goURI","tx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('WebMessengerAddPeopleToConversationDialog'),i=b('WebMessengerDeleteThreadDialog'),j=b('Arbiter'),k=b('AsyncDialog'),l=b('AsyncRequest'),m=b('MercuryChatUtils'),n=b('MercuryConfig'),o=b('CSS'),p=b('Dialog'),q=b('DOM'),r=b('fbt'),s=b('Focus'),t=b('Input'),u=b('Keys'),v=b('WebMessengerActionsMenuItem'),w=b('MercuryAPIArgsSource'),x=b('MercuryLogMessageType'),y=b('MercurySourceType'),z=b('MercuryThreadMuter'),aa=b('MercuryMessages').get(),ba=b('MessagingTag'),ca=b('MercuryParticipants'),da=b('MercuryServerRequests').get(),ea=b('WebMessengerShortcuts'),fa=b('WebMessengerStateConstants'),ga=b('WebMessengerStateManager'),ha=b('WebMessengerTemplates'),ia=b('MercuryThreadInformer').get(),ja=b('MercuryThreads').get(),ka=b('Toggler'),la=b('URI'),ma=b('WebMessengerSubscriptionsHandler'),na=b('copyProperties'),oa=b('emptyFunction'),pa=b('goURI'),qa=b('tx');function ra(){this.node=ha[':ui:menu-DEPRECATED:separator'].render();}ra.prototype.getNode=function(){return this.node;};function sa(ac){this._rootElement=ac;this._menuTemplate=ha[':fb:web-messenger:actions-menu'].build();this._newMessageButton=this._menuTemplate.getNode('newMessageButton').parentNode;this._actionsMenu=this._menuTemplate.getNode('menu');this._searchThreadInput=this._menuTemplate.getNode('searchThreadInput');this._searchThreadButton=this._menuTemplate.getNode('searchThreadButton').parentNode;this._searchCloseButton=this._menuTemplate.getNode('searchCloseButton').parentNode;var bc=this._menuTemplate.getNode('actionsButton'),cc=this._menuTemplate.getNode('newMessageButton');s.relocate(cc,cc.parentNode);var dc=function(event){if(!this._searchMode){ua(this,true);}else{var ec=t.getValue(this._searchThreadInput);if(ec){var fc=na({},ga.getCurrentStateData());na(fc,{message_query:ec});ga.updateDetailState(fa.DETAIL.SEARCH_THREAD_SNIPPET,fc);}else ua(this,false);}event.kill();}.bind(this);ma.addSubscriptions(ia.subscribe('threads-updated',function(ec,fc){fc[this._threadID]&&this.updateView();}.bind(this)),g.listen(this._menuTemplate.getNode('newMessageButton'),'click',function(){ga.updateDetailState(fa.DETAIL.COMPOSE_MAIN,na(ga.getCurrentStateData(),{start:true,thread_id:undefined}));}),g.listen(this._actionsMenu,'keydown',function(event){if(event.keyCode===u.ESC){bc.focus();event.preventDefault();}}),g.listen(this._searchThreadButton,'mousedown',dc),g.listen(this._searchThreadButton,'keydown',function(event){if(event.keyCode===u.RETURN||event.keyCode===u.SPACE)dc(event);}),g.listen(this._searchThreadButton,'click',oa.thatReturnsFalse),g.listen(this._searchCloseButton,'mousedown',function(){ua(this,false);var ec=ga.getCurrentDetailState();if(ec!==fa.DETAIL.RECENT_MESSAGES)ga.updateDetailState(fa.DETAIL.RECENT_MESSAGES,{thread_id:ga.getCurrentStateData().thread_id});}.bind(this)),g.listen(this._searchThreadInput,'blur',function(event){var ec=t.getValue(this._searchThreadInput);if(!ec)ua(this,false);}.bind(this)),g.listen(this._searchThreadInput,'keyup',function(event){var ec=t.getValue(this._searchThreadInput),fc=na({},ga.getCurrentStateData());na(fc,{message_query:ec});if(event.keyCode==u.RETURN&&ec)ga.updateDetailState(fa.DETAIL.SEARCH_THREAD_SNIPPET,fc);if(event.keyCode==u.ESC)t.reset(this._searchThreadInput);}.bind(this)));this.initItems();q.setContent(this._rootElement,this._menuTemplate.getRoot());}sa.prototype.initItems=function(){var ac=this._menuTemplate.getNode('actionsButton'),bc=this._menuTemplate.getNode('newMessageButton').parentNode,cc=function(){ac.focus();},dc=function(){bc.focus();};this.menuItems=[new v("Marcar como le\u00edda",ub.curry(cc),gb),new v("Marcar la conversaci\u00f3n como no le\u00edda",tb.curry(cc),db(gb)),new v("Abrir en el chat",ya,m.canOpenChatTab),new v("Crear Grupo...",sb,bb)];if(n.WebMessengerSharedPhotosGK){var ec=("Ver fotos en la cadena de mensajes");this.menuItems.push(new v(ec,kb));}this.menuItems.push(new ra());if(!n.MessagesDisableForwardingGK)this.menuItems.push(new v("Reenviar mensajes...",wb));this.menuItems=this.menuItems.concat([new v("Eliminar mensajes...",vb),new ra(),new v("Agregar personas...",mb,xa),new v("Abandonar la conversaci\u00f3n...",nb,xa),new v("Eliminar conversaci\u00f3n...",cb),new v("Bloquear conversaci\u00f3n...",z.showMuteChangeDialog,db(z.isThreadMuted)),new v("Desbloquear conversaci\u00f3n",va.curry(cc),z.isThreadMuted),new v("Enviar a \"Bandeja de entrada\"",ab.curry(dc,ba.INBOX),za.curry(ba.OTHER)),new v("Enviar a la carpeta \"Otros\"",ab.curry(dc,ba.OTHER),za.curry(ba.INBOX)),new v("Archivar",pb.curry(dc),db(fb)),new v("Desarchivar",qb.curry(dc),fb),new v("Reportar spam o abuso...",ib.curry(cc),db(eb)),new v("No es spam",lb.curry(dc),eb)]);if(wa())this.menuItems=this.menuItems.concat([new ra(),new v('Enable bug reporting',xb.curry(cc),db(hb)),new v('Disable bug reporting',yb.curry(cc),hb)]);this.menuItems=this.menuItems.concat([new ra(),new v("Accesos directos del teclado",ea.showOrHideShortcuts.bind(ea)),new v("Comentarios",pa.curry('/help/?page=134259426717336'))]);var fc=this.menuItems.map(function(hc){return hc.getNode();}),gc=q.find(this._menuTemplate.getRoot(),'.uiMenuInner');q.setContent(gc,fc);};sa.prototype.hideView=function(){o.hide(this._rootElement);};sa.prototype.updateView=function(){this.hideView();var ac=ga.getCurrentDetailState(),bc=false,cc=false,dc=false,ec=false,fc=false,gc=false;switch(ac){case fa.DETAIL.COMPOSE_MAIN:case fa.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:case fa.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:ta(this);this._threadID=null;break;case fa.DETAIL.RECENT_MESSAGES:case fa.DETAIL.SEARCH_CONTEXT:if(this._state!==ac)ta(this);var hc=ga.getCurrentStateData().thread_id;bc=true;if(this._searchMode&&this._threadID===hc){ec=true;}else{ta(this);cc=true;dc=true;}this._threadID=hc;if(n.WebMessengerThreadSearchGK&&this._threadID)fc=true;break;case fa.DETAIL.SEARCH_THREAD_SNIPPET:var ic=ga.getCurrentStateData();t.setValue(this._searchThreadInput,ic.message_query);this._threadID=ic.thread_id;bc=true;ec=true;gc=true;break;case fa.DETAIL.SHARED_PHOTOS:var jc=ga.getCurrentStateData();this._threadID=jc.thread_id;bc=true;cc=true;dc=true;fc=true;break;default:ta(this);bc=true;cc=true;this._threadID=null;break;}this._state=ac;o.conditionShow(this._searchThreadInput,ec);o.conditionShow(this._searchThreadButton,fc);o.conditionShow(this._searchCloseButton,gc);o.conditionShow(this._newMessageButton,cc);o.conditionShow(this._rootElement,bc);this._threadSubscription&&ja.unsubscribe(this._threadSubscription);if(dc&&this._threadID){this._threadSubscription=ja.getThreadMeta(this._threadID,function(kc){var lc=null,mc=false;this.menuItems.forEach(function(nc){if(nc instanceof v){mc|=nc.updateShown(kc);}else if(nc instanceof ra){o.conditionShow(nc.getNode(),mc);if(mc){lc=nc;mc=false;}}});if(!mc&&lc)o.hide(lc.getNode());o.show(this._menuTemplate.getNode('menu'));o.show(this._rootElement);}.bind(this),w.WEBMESSENGER);}else o.hide(this._menuTemplate.getNode('menu'));};sa.prototype.destroy=function(){};function ta(ac){ac._searchMode=false;t.reset(ac._searchThreadInput);}function ua(ac,bc){if(bc){ac._searchMode=true;}else ta(ac);o.conditionShow(ac._newMessageButton,!bc);o.conditionShow(ac._actionsMenu,!bc);o.conditionShow(ac._searchThreadInput,bc);if(bc)ac._searchThreadInput.focus();}function va(ac,bc){ja.updateThreadMuteSetting(bc,0);ka.hide();ac();}function wa(){var ac=ca.getNow(ca.user);return ac&&ac.employee;}function xa(ac){return !ac.is_canonical&&ac.is_subscribed;}function ya(ac){j.inform('chat/open-tab',{thread_id:ac});}function za(ac,bc){return !bc.is_archived&&bc.folder==ac;}function ab(ac,bc,cc){ja.changeFolder(cc,bc);zb();ac();}function bb(ac){var bc=rb(ac.participants);return bc.length>2;}function cb(ac){i.show(ac);}function db(ac){return function(){return !ac.apply(this,arguments);};}function eb(ac){return ac.folder===ba.SPAM;}function fb(ac){return ac.is_archived;}function gb(ac){return ac.unread_count>0;}function hb(){return ga.getCurrentStateData().bug_reporting_enabled;}function ib(ac,bc){var cc=ja.getThreadMetaNow(bc),dc;if(cc&&cc.message_count==1){dc=ha[':fb:web-messenger:report-dialog-single-message'].build();}else dc=ha[':fb:web-messenger:report-dialog'].build();var ec=dc.getRoot(),fc=[p.OK,p.CANCEL];new p().setTitle("Reportar spam o abuso").setBody(ec).setButtons(fc).setHandler(jb.curry(bc,ec)).setCancelHandler(ac).show();}function jb(ac,bc){var cc=q.find(bc,'.markSpam'),dc=q.scry(bc,'.markSpamMessages')[0];if(cc.checked){ja.markThreadSpam(ac);zb();}else if(dc&&dc.checked){var ec=na({},ga.getCurrentStateData());na(ec,{message_action:fa.MESSAGE_ACTION.REPORT_SPAM});ga.updateDetailState(ga.getCurrentDetailState(),ec);}else{var fc=q.find(bc,'.reportUsers');if(fc.checked){da.getServerThreadID(ac,function(gc){p.bootstrap('/ajax/messaging/report/',{tid:gc});});}else return false;}}function kb(ac){var bc=na({},ga.getCurrentStateData());ga.updateDetailState(fa.DETAIL.SHARED_PHOTOS,bc);}function lb(ac,bc){ja.unmarkThreadSpam(bc);zb();ac();}function mb(ac){h.show(ac);}function nb(ac){var bc=[];bc.push({name:'unsubscribe',label:"Abandonar la conversaci\u00f3n",handler:ob.bind(null,ac)});bc.push(p.CANCEL);new p().setTitle("\u00bfDeseas abandonar la conversaci\u00f3n?").setBody("No recibir\u00e1s m\u00e1s mensajes de esta conversaci\u00f3n y los participantes ver\u00e1n que la abandonaste.").setButtons(bc).show();}function ob(ac){aa.sendMessage(aa.constructLogMessageObject(y.TITAN_WEB,ac,x.UNSUBSCRIBE,{}),null,w.WEBMESSENGER);return true;}function pb(ac,bc){ja.changeThreadArchivedStatus(bc,true);zb();ac();}function qb(ac,bc){ja.changeThreadArchivedStatus(bc,false);zb();ac();}function rb(ac){var bc=[];for(var cc=0;cc<ac.length;cc++){var dc=ac[cc];if(/^fbid:\d+$/.test(dc))bc.push(dc.substr(5));}return bc;}function sb(ac){ja.getThreadMeta(ac,function(bc){var cc=rb(bc.participants),dc=la('/ajax/groups/create_get.php').addQueryData({ref:'web_messenger',members:cc,parent_id:'0'});k.send(new l(dc));},w.WEBMESSENGER);}function tb(ac,bc){ja.changeThreadReadStatus(bc,false);ka.hide();ac();}function ub(ac,bc){ja.changeThreadReadStatus(bc,true);ka.hide();ac();}function vb(){var ac=na({},ga.getCurrentStateData());na(ac,{message_action:fa.MESSAGE_ACTION.DELETE});ga.updateDetailState(ga.getCurrentDetailState(),ac);}function wb(){var ac=na({},ga.getCurrentStateData());na(ac,{message_action:fa.MESSAGE_ACTION.FORWARD});ga.updateDetailState(ga.getCurrentDetailState(),ac);}function xb(ac){var bc=na({},ga.getCurrentStateData());bc.bug_reporting_enabled=true;ka.hide();ga.updateDetailState(ga.getCurrentDetailState(),bc);ac();}function yb(ac){var bc=na({},ga.getCurrentStateData());bc.bug_reporting_enabled=false;ka.hide();ga.updateDetailState(ga.getCurrentDetailState(),bc);ac();}function zb(){ga.updateDetailState(fa.DETAIL.RECENT_MESSAGES,{folder:ga.getCurrentStateData().folder});}e.exports=sa;});
__d("ExpandableDataSource",["DataSource"],function(a,b,c,d,e,f){var g=b('DataSource');for(var h in g)if(g.hasOwnProperty(h))j[h]=g[h];var i=g===null?null:g.prototype;j.prototype=Object.create(i);j.prototype.constructor=j;j.__superConstructor__=g;function j(k,l,m){this._initialLimit=l;this._moreResultsLimit=m;this._states={};k=k||{};k.maxResults=this._initialLimit;g.call(this,k);}j.prototype.query=function(k,l,m){this.setQueryData({offset:0,limit:this._initialLimit});i.query.call(this,k,l,m);};j.prototype.fetchHandler=function(k,l){var m=k.getPayload(),n=l.value;this.getState('is_loading_more_per_query')[n]=false;this.getState('total_results_count_per_query')[n]=m.total_count;i.fetchHandler.call(this,k,l);};j.prototype.loadMore=function(){if(this.value&&!this.hasLoadedAllResults()){var k=this.getState('max_results_per_query');if(!k[this.value])k[this.value]=this._initialLimit;this.setQueryData({offset:k[this.value],limit:this._moreResultsLimit});k[this.value]+=this._moreResultsLimit;if(k[this.value]>this._maxResults)this._maxResults=k[this.value];this.getState('is_loading_more_per_query')[this.value]=true;this.fetch(this.queryEndpoint,this.getQueryData(this.value,this.buildUids(this.value)),{value:this.value});}};j.prototype.isLoadingMore=function(){return this.getState('is_loading_more_per_query')[this.value];};j.prototype.hasLoadedAllResults=function(){var k=this.getState('total_results_count_per_query')[this.value],l=(this.buildQueryResults(this.value)||[]).length;return k&&l>=k;};j.prototype.getStates=function(){return this._states;};j.prototype.getState=function(k){var l=this.getStates();if(!l[k])l[k]={};return l[k];};j.prototype.getQueryCache=function(){return this.getState('query_cache');};e.exports=j;});
__d("WebMessengerDetailViewAllPeopleResultsControl",["Event","CSS","DataStore","DOM","ExpandableDataSource","MercuryIDs","Parent","WebMessengerStateConstants","WebMessengerStateManager","Token","WebMessengerEvents","cx","WebMessengerSubscriptionsHandler","copyProperties","WebMessengerTemplates"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('DataStore'),j=b('DOM'),k=b('ExpandableDataSource'),l=b('MercuryIDs'),m=b('Parent'),n=b('WebMessengerStateConstants'),o=b('WebMessengerStateManager'),p=b('Token'),q=b('WebMessengerEvents'),r=b('cx'),s=b('WebMessengerSubscriptionsHandler'),t=b('copyProperties'),u=b('WebMessengerTemplates'),v=5,w=5;function x(ca){this._rootElement=ca;j.empty(this._rootElement);var da=u[':fb:web-messenger:all-people-results'].build();j.setContent(this._rootElement,da.getRoot());this._loadingSpinner=da.getNode('loadingSpinner');this._peopleResults=da.getNode('results');this._loadMoreButton=da.getNode('loadMoreButton');this._loadMoreLink=da.getNode('loadMoreLink');s.addSubscriptions(g.listen(this._loadMoreLink,'click',function(){h.addClass(this._loadMoreButton,'async_saving');this._peopleDataSource&&this._peopleDataSource.loadMore();}.bind(this)));}x.prototype.hideView=function(){h.hide(this._rootElement);};x.prototype.updateView=function(){var ca=o.getCurrentDetailState();if(ca==n.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS){h.show(this._rootElement);y(this);q.detailDOMChanged();}};x.prototype.destroy=function(){};function y(ca){h.show(ca._loadingSpinner);h.hide(ca._peopleResults);h.hide(ca._loadMoreButton);var da=o.getCurrentStateData(),ea=da.all_people_query||'';z(ca);var fa=(da.participants||[]).map(function(ga){return l.tokenize(ga).value;});ca._peopleDataSource.setExclusions(fa);ca._peopleDataSource.query(ea);}function z(ca){if(!ca._peopleDataSource){ca._peopleDataSource=new k({queryEndpoint:'/ajax/mercury/search_people.php'},v,w);ca._peopleDataSource.init();s.addSubscriptions(ca._peopleDataSource.subscribe('respond',aa.curry(ca)),g.listen(ca._rootElement,'click',function(event){var da=event.getTarget().parentNode;if(h.hasClass(da,"_4wt"))ba(event.getTarget(),ca._peopleDataSource);}));}}function aa(ca,da,ea){var fa=o.getCurrentDetailState(),ga=o.getCurrentStateData();if(fa==n.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS&&ga.all_people_query==ea.value){j.empty(ca._peopleResults);h.show(ca._peopleResults);ea.results.forEach(function(ha){var ia=j.create('div',{className:'personResult'},ha.detail_markup);i.set(ia,'uid',ha.uid);j.appendContent(ca._peopleResults,ia);});if(ea.results.length){h.hide(ca._loadingSpinner);h.conditionShow(ca._loadMoreButton,!ca._peopleDataSource.hasLoadedAllResults());h.conditionClass(ca._loadMoreButton,'async_saving',ca._peopleDataSource.isLoadingMore());}}}function ba(ca,da){var ea=m.byClass(ca,'personResult'),fa=da.getEntry(i.get(ea,'uid')),ga=t(o.getCurrentStateData(),{new_tokens:[new p(fa)],start:false});o.updateDetailState(n.DETAIL.COMPOSE_MAIN,ga);}e.exports=x;});
__d("WebMessengerComposerTypeaheadView",["BucketedTypeaheadView","MercuryConstants","CSS","DataStore","WebMessengerStateConstants","WebMessengerStateManager","copyProperties","cx","fbt","tx"],function(a,b,c,d,e,f){var g=b('BucketedTypeaheadView'),h=b('MercuryConstants'),i=b('CSS'),j=b('DataStore'),k=b('WebMessengerStateConstants'),l=b('WebMessengerStateManager'),m=b('copyProperties'),n=b('cx'),o=b('fbt'),p=b('tx');for(var q in g)if(g.hasOwnProperty(q))s[q]=g[q];var r=g===null?null:g.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=g;function s(w,x){g.call(this,w,x);var y=h.MercuryTypeaheadConstants;this.typeObjects={};this.typeObjects[y.FRIEND_TYPE]={disabled:true,uid:y.FRIEND_TYPE,type:y.HEADER_TYPE};this.typeObjects[y.THREAD_TYPE]={uid:y.THREAD_TYPE,text:"Conversaciones de grupo",type:y.HEADER_TYPE,linkText:"Mostrar m\u00e1s",getLinkHandler:v.curry(this)};this.typeObjects[y.FB4C_TYPE]={uid:y.THREAD_TYPE,text:"Compa\u00f1eros de trabajo",type:y.HEADER_TYPE,linkText:"Mostrar m\u00e1s",getLinkHandler:v.curry(this)};this.typeObjects[y.NON_FRIEND_TYPE]={uid:y.NON_FRIEND_TYPE,text:"Otras personas",type:y.HEADER_TYPE,linkText:"Ver todos",getLinkHandler:function(){return function(){u(this.value);}.bind(this);}.bind(this)};}s.prototype.setTypeahead=function(w){r.setTypeahead.call(this,w);var x=j.get(w,'Typeahead');x.subscribe('loading',function(y,z){var aa=x.getData();if(this._threadHeader)i.conditionClass(this._threadHeader,"_355",aa.isLoadingMore(this.value));}.bind(this));};s.prototype.setNewHeader=function(w,x){if(x.uid===h.MercuryTypeaheadConstants.THREAD_TYPE)this._threadHeader=w;};s.prototype.mouseover=function(event){if(!t(this,event))r.mouseover.call(this,event);};s.prototype.mouseup=function(event){if(!t(this,event))r.mouseup.call(this,event);};s.prototype.clearSelected=function(){this.index=-1;this.highlight(-1);};function t(w,event){var x=w.getIndex(event);return x>=0&&x<w.results.length&&w.results[x].type==h.MercuryTypeaheadConstants.HEADER_TYPE;}function u(w){var x=m(l.getCurrentStateData(),{all_people_query:w,start:false});l.updateDetailState(k.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS,x);}function v(w){var x=j.get(w.typeahead,'Typeahead'),y=x.getData();if(y.hasLoadedInitialResults(w.value)&&!y.hasLoadedAllResults(w.value))return y.loadMore.bind(y);}e.exports=s;});
__d("WebMessengerTypeaheadRenderer",["MercuryConstants","DOM","MercuryAPIArgsSource","MercuryTypeaheadRenderer","React","MercuryServerRequests","SplitImage.react","WebMessengerTemplates","MercuryThreadMetadataRawRenderer","MercuryThreadMetadataRenderer","MercuryThreads"],function(a,b,c,d,e,f){var g=b('MercuryConstants'),h=b('DOM'),i=b('MercuryAPIArgsSource'),j=b('MercuryTypeaheadRenderer'),k=b('React'),l=b('MercuryServerRequests').get(),m=b('SplitImage.react'),n=b('WebMessengerTemplates'),o=b('MercuryThreadMetadataRawRenderer'),p=b('MercuryThreadMetadataRenderer').get(),q=b('MercuryThreads').get();function r(t,u){var v;switch(t.type){case g.MercuryTypeaheadConstants.HEADER_TYPE:v=n[':fb:web-messenger:typeahead-header'].build();j.renderHeader(v,t);if(this.setNewHeader)this.setNewHeader(v.getRoot(),t);break;case g.MercuryTypeaheadConstants.USER_TYPE:v=n[':fb:web-messenger:threadlist-row'].build();j.renderPersonWithBigPhoto(v,t);break;case g.MercuryTypeaheadConstants.THREAD_TYPE:v=n[':fb:web-messenger:threadlist-row'].build();s(v,t);break;default:return h.create('div');}return v.getRoot();}function s(t,u){var v=l.getClientThreadIDNow(u.uid),w=u.participants_to_render.map(function(z){return z.big_image_src||z.image_src;}),x=m({srcs:w,border:true,size:50});k.renderComponent(x,t.getNode('image'));var y=p.renderThreadNameAndParticipantList(v,u.participants_to_render,u.mercury_thread.participants.length,{last_separator_uses_and:false,names_renderer:o.renderShortNames});h.setContent(t.getNode('name'),y);t.getRoot().setAttribute('aria-label',y);q.getThreadMeta(v,function(z){p.renderSnippet(z,t.getNode('snippet'));p.renderTimestamp(t.getNode('timestamp'),z.timestamp_absolute,z.timestamp_relative,z.timestamp);},i.WEBMESSENGER);}e.exports=r;});
__d("WebMessengerDetailViewComposeTypeaheadControl",["Event","WebMessengerComposerTypeaheadView","MercuryConstants","CSS","WebMessengerDataSources","DOM","MercuryFolders","FreeformTokenizerBehavior","Keys","MercuryDataSourceHelper","MercuryParticipantTypes","MercuryTypeahead","MercuryParticipants","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","MercuryThreads","WebMessengerEvents","WebMessengerSubscriptionsHandler","WebMessengerTypeaheadRenderer","copyProperties","tx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('WebMessengerComposerTypeaheadView'),i=b('MercuryConstants'),j=b('CSS'),k=b('WebMessengerDataSources'),l=b('DOM'),m=b('MercuryFolders'),n=b('FreeformTokenizerBehavior'),o=b('Keys'),p=b('MercuryDataSourceHelper'),q=b('MercuryParticipantTypes'),r=b('MercuryTypeahead'),s=b('MercuryParticipants'),t=b('WebMessengerStateConstants'),u=b('WebMessengerStateManager'),v=b('WebMessengerTemplates'),w=b('MercuryThreads').get(),x=b('WebMessengerEvents'),y=b('WebMessengerSubscriptionsHandler'),z=b('WebMessengerTypeaheadRenderer'),aa=b('copyProperties'),ba=b('tx');function ca(ga,ha){this._typeaheadRoot=ga;this._resultsRoot=ha;l.empty(this._typeaheadRoot);l.empty(this._resultsRoot);}ca.prototype.hideView=function(){j.hide(this._typeaheadRoot);j.hide(this._resultsRoot);};ca.prototype.updateView=function(){var ga=t;switch(u.getCurrentDetailState()){case ga.DETAIL.COMPOSE_MAIN:this.renderComposeTypeahead();j.hide(this._resultsRoot);break;case ga.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:this.renderComposeTypeahead();j.show(this._resultsRoot);break;}x.detailDOMChanged();};ca.prototype.renderComposeTypeahead=function(){var ga=u.getCurrentStateData();j.show(this._typeaheadRoot);j.show(this._resultsRoot);if(!this._initiated){var ha=v[':fb:web-messenger:read-view:compose:typeahead'].build();l.setContent(this._typeaheadRoot,ha.getRoot());var ia=v[':fb:web-messenger:read-view:compose:typeahead:results'].build();l.setContent(this._resultsRoot,ia.getRoot());this._initialResultsLoadingSpinner=ia.getNode('initialResultsLoadingSpinner');this._typeaheadFooter=ia.getNode('typeaheadFooter');this._moreResultsLink=ia.getNode('moreResultsLink');this._typeaheadCaption=ia.getNode('caption');this.buildTypeahead(ia.getNode('results'));l.appendContent(ha.getNode('typeahead'),this._typeahead.getElement());this._initiated=true;}if(ga.start){if(!ga.participants)this._typeahead.reset();this._typeahead.focus();var ja=this._typeahead.getTypeahead().getCore();ja.getElement().removeAttribute('disabled');}ea(this);};ca.prototype.buildTypeahead=function(ga){if(this._typeahead)return;var ha=k.WebMessengerComposerDataSource;p.updateMercuryOnFetchComplete(ha);var ia=new r(ha,h);ia.setPlaceholder("Nombre");ia.setViewNodeID(ga);ia.setViewOption('renderer',z);y.addSubscriptions(ia.subscribe('tokens-changed',this.onTokensChanged.bind(this)));ia.build();y.addSubscriptions(ia.getTypeahead().subscribe(['respond','focus'],function(){da(!!ia.getTypeahead().getCore().getValue());}),ia.getTypeahead().subscribe(['reset','blur'],function(){da(false);}),ia.getTypeahead().subscribe('render',function(ja,ka){fa(this,ka.length);}.bind(this)),ia.getTypeahead().subscribe('reset',function(){fa(this,false);}.bind(this)),ia.getTypeahead().subscribe('query',function(ja,ka){l.setContent(this._moreResultsLink,ba._("Ver m\u00e1s resultados de {query}",{query:ka.value}));}.bind(this)),g.listen(ia.getElement(),'keydown',function(ja){if(ja.keyCode===o.TAB&&!ja.getModifiers().any){x.focusComposer();return false;}}),g.listen(this._typeaheadFooter,'mousedown',function(){return false;}),g.listen(this._moreResultsLink,'click',function(){var ja=this._typeahead.getTypeahead().getCore().getValue(),ka=aa(u.getCurrentStateData(),{all_people_query:ja,start:false});u.updateDetailState(t.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS,ka);}.bind(this)),g.listen(this._typeaheadFooter,'mouseover',function(){this._typeahead.getTypeahead().getView().clearSelected();}.bind(this)));this._typeahead=ia;};ca.prototype.onTokensChanged=function(){var ga=u.getCurrentDetailState();if(ga==t.DETAIL.COMPOSE_MAIN||ga==t.DETAIL.COMPOSE_TYPEAHEAD_RESULTS||ga==t.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS){var ha=this._typeahead,ia=ha.getTokens(),ja=ia[ia.length-1];if(ja&&ja.getInfo().mercury_thread){var ka=ja.getInfo().mercury_thread.thread_id,la=m.getFromMeta(w.getThreadMetaNow(ka));u.updateDetailState(t.DETAIL.RECENT_MESSAGES,{thread_id:ka,folder:la,reuse_composer:true});}else{var ma=ia.map(function(oa){if(oa.getInfo().type==i.MercuryTypeaheadConstants.USER_TYPE){return 'fbid:'+oa.getValue();}else return 'email:'+oa.getValue();}),na=u.getCurrentStateData();if(!na.start||(ma||[]).length)u.updateDetailState(t.DETAIL.COMPOSE_MAIN,aa({},na,{participants:ma}));}}};ca.prototype.destroy=function(){};function da(ga){var ha=u.getCurrentDetailState(),ia=t;if(ha!=ia.DETAIL.COMPOSE_MAIN&&ha!=ia.DETAIL.COMPOSE_TYPEAHEAD_RESULTS)return;var ja;if(ga){ja=ia.DETAIL.COMPOSE_TYPEAHEAD_RESULTS;}else if(ha==ia.DETAIL.COMPOSE_TYPEAHEAD_RESULTS){ja=ia.DETAIL.COMPOSE_MAIN;}else ja=ha;if(ja!=ha){var ka=aa(u.getCurrentStateData(),{start:false,new_tokens:undefined});u.updateDetailState(ja,ka);}}function ea(ga){var ha=u.getCurrentStateData();if(ha.new_tokens){var ia=ga._typeahead.getTypeahead().getCore();ia.reset();ha.new_tokens.forEach(function(la){ga._typeahead.getTokenizer().addToken(la);});if(ha.new_tokens.length==1){var ja=ha.new_tokens[0],ka=s.getNow('fbid:'+ja.getValue());if(ka&&ka.type==q.PAGE)ia.getElement().setAttribute('disabled','disabled');}}}function fa(ga,ha){var ia=ga._typeahead.getTypeahead(),ja=ia.getCore().getValue(),ka=ia.getData().hasLoadedInitialResults(ja);j.conditionShow(ga._initialResultsLoadingSpinner,!ka);j.conditionShow(ga._moreResultsLink,ka&&ha);if(!ha&&ka){l.setContent(ga._typeaheadCaption,"No se encontraron resultados");}else l.setContent(ga._typeaheadCaption,"Mostrando los resultados m\u00e1s populares");}e.exports=ca;});
__d("WebMessengerUnseenMessageNoticeRenderer",["JSXDOM","ContextualLayer","LayerFadeOnHide","cx","tx","Event"],function(a,b,c,d,e,f){var g=b('JSXDOM'),h=b('ContextualLayer'),i=b('LayerFadeOnHide'),j=b('cx'),k=b('tx'),l=b('Event'),m={renderNoticeTooltip:function(o,p){var q=g.div({className:"_40p"},n(o),g.i({className:"_40q"})),r=new h(p||{},q).enableBehavior(i);return r;}};function n(o){var p=g.div({className:"_40r"},"Tienes mensajes nuevos");l.listen(p,'click',o);return p;}e.exports=m;});
__d("WebMessengerMessagesNotice",["LayerDestroyOnHide","WebMessengerUnseenMessageNoticeRenderer","MercuryParticipants"],function(a,b,c,d,e,f){var g=b('LayerDestroyOnHide'),h=b('WebMessengerUnseenMessageNoticeRenderer'),i=b('MercuryParticipants');function j(){this._notice=null;this._noticeContextNode=null;this._active=false;}j.prototype.getActive=function(){return this._active;};j.prototype.showMessageNotice=function(k,l){if(!this._active)return;if(!this._notice)this._notice=h.renderNoticeTooltip(k,{context:this._noticeContextNode,offsetY:2,position:l,alignment:'center'});this._notice.show();};j.prototype.hideMessageNotice=function(){this._notice&&this._notice.hide();};j.prototype.removeMessageNotice=function(){if(this._notice){this._notice.enableBehavior(g).hide();this._notice=null;}};j.prototype.setNoticeContextNode=function(k){this._noticeContextNode=k;};j.prototype.hideView=function(){this._active=false;this.hideMessageNotice();};j.prototype.updateView=function(){this._active=true;};j.prototype.destroy=function(){this._active=false;this.removeMessageNotice();};j.prototype.onlyReceivedFromSelf=function(k){for(var l in k){if(!k.hasOwnProperty(l))continue;for(var m=0,n=k[l].length;m<n;m++)if(k[l][m].author!==i.user)return false;}return true;};e.exports=j;});
__d("WebMessengerDetailViewUnreadMessagesNotice",["WebMessengerStateManager","throttle","MercuryThreadInformer","MercuryThreads","UserActivity","WebMessengerMessagesNotice","WebMessengerConstants","WebMessengerSubscriptionsHandler"],function(a,b,c,d,e,f){var g=b('WebMessengerStateManager'),h=b('throttle'),i=b('MercuryThreadInformer').get(),j=b('MercuryThreads').get(),k=b('UserActivity'),l=b('WebMessengerMessagesNotice'),m=b('WebMessengerConstants'),n=b('WebMessengerSubscriptionsHandler'),o=m.MESSAGE_NOTICE_INACTIVITY_THRESHOLD;for(var p in l)if(l.hasOwnProperty(p))r[p]=l[p];var q=l===null?null:l.prototype;r.prototype=Object.create(q);r.prototype.constructor=r;r.__superConstructor__=l;function r(s){l.call(this);this._manager=s;n.addSubscriptions(i.subscribe('thread-read-changed',this._updateReadStatus.bind(this)));this._manager.setScrollCallback(h.withBlocking(function(t){if(this._shouldMarkAsRead(t)){this.removeMessageNotice();if(k.isActive(5000)){var u=g.getCurrentStateData().thread_id;j.changeThreadReadStatus(u,true);}else k.subscribeOnce(function(){if(this._shouldMarkAsRead(t)){var v=g.getCurrentStateData().thread_id;j.changeThreadReadStatus(v,true);}}.bind(this));}}.bind(this),100,null));}r.prototype.updateOnMessagesReceived=function(s,t,u,v){var w=!k.isActive(o);if(!q.getActive.call(this))return;if(w||q.onlyReceivedFromSelf.call(this,v)){this.removeMessageNotice();this._manager.scrollToBottom(true);}else if(!this._manager.isScrolledToBottom()){var x=u-(t-s);this._manager.setScrollTop(x,false);this.showMessageNotice();}};r.prototype.showMessageNotice=function(){var s=function(){this._manager.scrollToBottom();}.bind(this);q.showMessageNotice.call(this,s,'above');};r.prototype._shouldMarkAsRead=function(s){var t=g.getCurrentStateData().thread_id;return t&&q.getActive.call(this)&&s.isScrolledToBottom();};r.prototype._updateReadStatus=function(s,t){var u=g.getCurrentStateData().thread_id;if(u&&t[u]&&t[u].mark_as_read)this.removeMessageNotice();};e.exports=r;});
__d("MercuryListUpdateRenderer",["DOM","ge"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('ge'),i={updateList:function(j,k,l,m,n){var o=[];for(var p=0;p<k.length;p++){if(n){var q=n(p);q&&o.push(q);}var r=h(k[p]);if(r&&l(p)){o.push(r);}else o.push(m(p));}g.setContent(j,o);}};e.exports=i;});
__d("WebMessengerMessageIDFinder",["DataStore","DOM","csx"],function(a,b,c,d,e,f){var g=b('DataStore'),h=b('DOM'),i=b('csx'),j={findAll:function(k){var l=h.scry(k,"._53"),m=[];if(l.length){var n=l[0];for(var o=0;o<n.childNodes.length;o++)m.push(g.get(n.childNodes[o],'MessageRenderer:messageID'));}return m;}};e.exports=j;});
__d("WebMessengerMessagesSelection",["CSS","csx","DOM","getObjectValues","WebMessengerMessageIDFinder"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('csx'),i=b('DOM'),j=b('getObjectValues'),k=b('WebMessengerMessageIDFinder'),l={};function m(p,q){var r=p,s=q;if(r==s)return 0;while(true){r=r.nextSibling;s=s.nextSibling;if(!r||s==p){return 1;}else if(!s||r==q)return -1;}}function n(p,q){var r=p.id,s=i.scry(p,"._yh input")[0];if(q){l[r]=p;g.addClass(p,'selected');s.checked=true;}else{delete l[r];g.removeClass(p,'selected');s.checked=false;}}var o={clear:function(){for(var p in l)n(l[p],false);},selectClick:function(p){n(p,!(p.id in l));},getSelectedMessageIDs:function(){var p=j(l);p.sort(m);var q=[];p.forEach(function(r){q=q.concat(k.findAll(r));});return q;}};e.exports=o;});
__d("WebMessengerThreadMessagesRenderer",["Event","AsyncRequest","MercuryAttachment","MercuryAttachmentRenderer","CSS","DOM","DataStore","HTMLEmailRenderer","HovercardLink","Image.react","LinkController","MercuryAPIArgsSource","MercuryActionTypeConstants","MercuryThreadlistConstants","MercuryTimePassed","MercuryMessageRenderer","MercuryMessages","WebMessengerMessagesSelection","Parent","MercuryParticipants","MercuryParticipantsConstants","React","WebMessengerStateManager","MercuryStatusTemplates","Style","WebMessengerTemplates","MercuryThreadMetadataRawRenderer","MercuryThreadMetadataRenderer","Vector","WebMessengerConstants","WebMessengerSubscriptionsHandler","csx","cx","formatDate","ge","isRTL","tx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('AsyncRequest'),i=b('MercuryAttachment'),j=b('MercuryAttachmentRenderer'),k=b('CSS'),l=b('DOM'),m=b('DataStore'),n=b('HTMLEmailRenderer'),o=b('HovercardLink'),p=b('Image.react'),q=b('LinkController'),r=b('MercuryAPIArgsSource'),s=b('MercuryActionTypeConstants'),t=b('MercuryThreadlistConstants'),u=b('MercuryTimePassed'),v=b('MercuryMessageRenderer'),w=b('MercuryMessages').get(),x=b('WebMessengerMessagesSelection'),y=b('Parent'),z=b('MercuryParticipants'),aa=b('MercuryParticipantsConstants'),ba=b('React'),ca=b('WebMessengerStateManager'),da=b('MercuryStatusTemplates'),ea=b('Style'),fa=b('WebMessengerTemplates'),ga=b('MercuryThreadMetadataRawRenderer'),ha=b('MercuryThreadMetadataRenderer').get(),ia=b('Vector'),ja=b('WebMessengerConstants'),ka=b('WebMessengerSubscriptionsHandler'),la=b('csx'),ma=b('cx'),na=b('formatDate'),oa=b('ge'),pa=b('isRTL'),qa=b('tx'),ra={updateSelection:function(ua){var va=ca.getCurrentStateData().message_action;k.conditionClass(ua,'selectionEnabled',va);},setupSelectionListener:function(ua){q.registerHandler(function(va){var wa=ca.getCurrentStateData().message_action;if(wa&&y.byClass(va,'webMessengerMessageGroup'))return false;});ka.addSubscriptions(g.listen(ua,'click',function(event){var va=ca.getCurrentStateData().message_action;if(va){var wa=null;for(var xa=event.getTarget();xa;xa=xa.parentNode)if(k.hasClass(xa,'webMessengerMessageGroup'))wa=xa;wa&&x.selectClick(wa);}}));},renderForwardedMessages:function(ua,va){var wa=ra.calculateMessageGroups(va),xa=null;wa.forEach(function(ya){var za=ra.renderMessageGroupArray(ya,true);l.appendContent(ua,za.getRoot());xa=ya[ya.length-1];});},calculateMessageGroups:function(ua){var va=[],wa=null,xa=null;for(var ya=0,za=ua.length;ya<za;ya++){var ab=ua[ya],bb=ra.canAppendMessageToLastGroup(xa,ab);if(!bb){wa=[];va.push(wa);}wa.push(ab);xa=ab;}return va;},canAppendMessageToLastGroup:function(ua,va){var wa=t.GROUPING_THRESHOLD;if(!ua||sa(ua)||sa(va)||ua.author!=va.author||ua.timestamp<va.timestamp-wa||ua.is_spoof_warning!==va.is_spoof_warning)return false;return true;},renderMessageGroupArray:function(ua,va,wa){var xa=ra.renderMessageGroup(ua[0],va,wa);for(var ya=1;ya<ua.length;ya++)ra.appendMessageToGroup(xa,ua[ya]);return xa;},renderMessageGroup:function(ua,va,wa){var xa=ua.action_type==s.LOG_MESSAGE,ya=xa?fa[':fb:web-messenger:read-view:log-message'].build():fa[':fb:web-messenger:read-view:message-group'].build();ya.getRoot().setAttribute('id',(wa||'wm:')+ua.message_id);if(xa){ra.renderSingleLogMessage(ya,ua);}else z.get(ua.author,function(za){ra.renderSingleMessage(ya,ua,za,va);});return ya;},appendMessageToGroup:function(ua,va){var wa=fa[':fb:web-messenger:read-view:message'].build();if(va.is_filtered_content){var xa=da[':fb:mercury:filtered-message'].build();wa.setNodeContent('message',xa.getRoot());}else wa.setNodeContent('message',v.formatMessageBody(va.body,null,true));var ya=ga.renderStatusIndicator(va.status,va.error_data,w.resendMessage.bind(w,va,r.WEBMESSENGER));if(ya)wa.setNodeContent('status',ya);var za=wa.getRoot();m.set(za,'MessageRenderer:messageID',va.message_id);k.addClass(wa.getNode('message'),pa(va.body)?'direction_rtl':'direction_ltr');l.appendContent(ua.getNode('bodyDiv'),za);z.get(z.user,function(ab){if(ab.employee)l.setContent(wa.getNode('bugReporting'),fa[':fb:web-messenger:bug-reporting'].render());});},renderSingleLogMessage:function(ua,va){var wa=ua.getNode('attachment');v.renderLogMessage(ua.getNode('icon'),ua.getNode('message'),wa,va);if(va.log_message_data.image)k.addClass(wa.firstChild,"_1_vi");ha.renderTimestamp(ua.getNode('timestamp'),va.timestamp_absolute,va.timestamp_relative,va.timestamp);},renderMessageSeparator:function(ua){var va=fa[':fb:mercury:timestamp'].render();va.removeAttribute('title');var wa=ua.timestamp_absolute;if(!wa)wa=v.renderDate(new Date(ua.timestamp));if(w.isFirstMessage(ua))if(ua.timestamp_time_passed===u.TODAY){wa="Conversaci\u00f3n iniciada hoy";}else wa=qa._("Inicio de la conversaci\u00f3n {timestamp}",{timestamp:wa});l.setContent(va,wa);k.show(va);return l.create('li',{className:"_2n3"},va);},renderMessageSeparatorForIndex:function(ua,va){var wa=ua[va][0];if(va){var xa=wa.timestamp,ya=ua[va-1],za=ya[ya.length-1].timestamp,ab=ja.READ_VIEW_SEPARATOR_TIME_LIMIT;if(xa-za<ab)return false;}return ra.renderMessageSeparator(wa);},renderRawAttachments:function(ua,va){var wa=i.convertRaw(va.raw_attachments||[]);if(va.photo_fbids)for(var xa=0;xa<va.photo_fbids.length;xa++)wa.push({preview_loading:true});ra.renderAttachments(ua,wa,va);},renderAttachments:function(ua,va,wa){va.sort(j.booleanLexicographicComparator([j.isPhotoAttachment,j.isShareAttachment,j.isFileAttachment,j.isErrorAttachment]));var xa=j.renderPhotoAttachments(va.filter(j.isPhotoAttachment),wa,468,16);if(xa)l.appendContent(ua,xa);for(var ya=0;ya<va.length;ya++){if(j.isPhotoAttachment(va[ya]))continue;var za=j.renderAttachment(false,va[ya],wa);za.error&&l.appendContent(ua,za.error);za.content&&l.appendContent(ua,za.content);}},renderSingleMessage:function(ua,va,wa,xa){ua.setNodeProperty('bodyDiv','id',va.message_id);if(va.html_body){var ya=ua.getNode('fbml');g.listen(ya,'click',function(){new h().setURI('/ajax/messaging/async.php').setReadOnly(true).setMethod('GET').setData({action:'htmlDialog',mid:va.message_id}).send();return false;});k.show(ya);var za=ua.getNode('bodyDiv'),ab=l.create('div',{className:"_5xl"}),bb=l.create('div',{className:"_5xm"},ab);l.setContent(za,bb);m.set(bb,'MessageRenderer:messageID',va.message_id);var cb=new n({resizeContent:ta}),db=function(){cb.makeRich(va.message_id,ab,va.html_body);};db.defer();if(va.status!==undefined){var eb=ua.getNode('emailStatusContainer'),fb=ga.renderStatusIndicator(va.status,va.error_data,w.resendMessage.bind(w,va));if(fb){l.appendContent(eb,fb);k.show(eb);}}}else ra.appendMessageToGroup(ua,va);var gb;if(wa.href){gb=l.create('a',{href:wa.href},wa.name);var hb=z.getUserID(wa.id);if(hb)gb.setAttribute('data-hovercard',o.constructEndpoint({id:hb}));}else gb=wa.name;ua.setNodeContent('authorName',gb);var ib=ua.getNode('image');k.removeClass(ib,'MercuryThreadImage');var jb=p({width:aa.IMAGE_SIZE,height:aa.IMAGE_SIZE,src:wa.image_src,className:"_50dv"});if(wa.href)jb=ba.DOM.a({href:wa.href},jb);ba.renderComponent(jb,ib);var kb;if(va.timestamp_time_passed===u.TODAY){kb='g:ia';}else kb='n/j, g:ia';var lb=na(new Date(va.timestamp),kb);ha.renderTimestamp(ua.getNode('timestamp'),va.timestamp_absolute,lb,va.timestamp);ua.getNode('mapHovercard').removeAttribute('href');if(va.coordinates){k.hide(ua.getNode('tooltipForSource'));ha.renderMessageLocation(ua.getNode('mapHovercard'),ua.getNode('locationIcon'),va.coordinates);}else{ua.getNode('mapHovercard').removeAttribute('data-hovercard');ha.renderMessageSourceTags(ua.getNode('tooltipForSource'),ua.getNode('sourceIcon'),va.source_tags||[],va.author_email);ha.renderSpoofWarning(ua.getNode('spoofWarning'),va.is_spoof_warning,wa);}if(va.subject)ua.setNodeContent('subject',va.subject);if(va.has_attachment){var mb=ua.getNode('attachments');if(va.attachments&&va.attachments.length===0){ra.renderRawAttachments(mb,va);}else if(va.attachments!==null&&va.attachments.length>0){ra.renderAttachments(mb,va.attachments,va);}else if(va.raw_attachments!=null&&va.raw_attachments.length>0)ra.renderRawAttachments(mb,va.raw_attachments);}var nb=ua.getNode('forwards'),ob=va.forward_count&&w.getMessagesFromIDs(va.forward_message_ids);if(ob)ra.renderForwardedMessages(nb,ob);k.conditionShow(nb,ob);}};function sa(ua){return ua.action_type==s.LOG_MESSAGE||ua.has_attachment||ua.forward_count||ua.html_body||(ua.body&&ua.body.length>t.MAX_CHARS_BEFORE_BREAK);}function ta(ua,va,wa){var xa=oa(ua),ya=l.find(xa,'iframe'),za=l.find(ya,"^._5xm"),ab=za.firstChild;ea.set(ya,'width',va+'px');ea.set(ya,'height',(wa+1)+'px');ya.setAttribute('scrolling','no');var bb=xa&&ia.getElementDimensions(xa).x/va;if(bb&&bb<1){ea.set(za,'height',Math.round(bb*(wa+1))+'px');var cb=ya.style,db=['transform','WebkitTransform','msTransform','MozTransform','OTransform'],eb;while(eb=db.shift())if(typeof cb[eb]!=='undefined'){ea.set(ya,eb,'scale('+bb+','+bb+')');return;}ea.set(ab,'zoom',bb);}}e.exports=ra;});
__d("WebMessengerInfoBoxRenderer",["Event","cx","DOM","WebMessengerSubscriptionsHandler"],function(a,b,c,d,e,f){var g=b('Event'),h=b('cx'),i=b('DOM'),j=b('WebMessengerSubscriptionsHandler'),k={render:function(l,m){var n=i.create('div',{className:"_4rk"},l),o=i.create('div',{}),p=true;m.forEach(function(q){if(!p){var r=i.create('span',{className:"_4rl"},'\u00b7');i.appendContent(o,r);}p=false;var s=i.create('a',{},q.text);if(q.handler)j.addSubscriptions(g.listen(s,'click',q.handler));i.appendContent(o,s);});return i.create('div',{className:"_4rh"},[n,o]);}};e.exports=k;});
__d("WebMessengerDetailViewRecentMessagesControl",["Event","Animation","MercuryLastMessageIndicator","CSS","WebMessengerDetailViewUnreadMessagesNotice","DOM","JoinableConversationMessageFilter","Arbiter","MercuryListUpdateRenderer","MercuryAPIArgsSource","MercuryParticipants","MercuryThreadlistConstants","MercuryMessages","WebMessengerMessagesSelection","MessagingTag","WebMessengerStateConstants","WebMessengerStateManager","Style","WebMessengerTemplates","MercuryThreadInformer","WebMessengerThreadMessagesRenderer","MercuryThreads","UserActivity","WebMessengerConstants","WebMessengerInfoBoxRenderer","WebMessengerMessageIDFinder","WebMessengerSubscriptionsHandler","copyProperties","debounce","formatDate","ge","tx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Animation'),i=b('MercuryLastMessageIndicator'),j=b('CSS'),k=b('WebMessengerDetailViewUnreadMessagesNotice'),l=b('DOM'),m=b('JoinableConversationMessageFilter'),n=b('Arbiter'),o=b('MercuryListUpdateRenderer'),p=b('MercuryAPIArgsSource'),q=b('MercuryParticipants'),r=b('MercuryThreadlistConstants'),s=b('MercuryMessages').get(),t=b('WebMessengerMessagesSelection'),u=b('MessagingTag'),v=b('WebMessengerStateConstants'),w=b('WebMessengerStateManager'),x=b('Style'),y=b('WebMessengerTemplates'),z=b('MercuryThreadInformer').get(),aa=b('WebMessengerThreadMessagesRenderer'),ba=b('MercuryThreads').get(),ca=b('UserActivity'),da=b('WebMessengerConstants'),ea=b('WebMessengerInfoBoxRenderer'),fa=b('WebMessengerMessageIDFinder'),ga=b('WebMessengerSubscriptionsHandler'),ha=b('copyProperties'),ia=b('debounce'),ja=b('formatDate'),ka=b('ge'),la=b('tx');function ma(eb,fb,gb,hb,ib,jb,kb){this._manager=eb;this._rootElement=fb;this._loadingSpinner=gb;this._noSelectedConversation=hb;this._newMessageLink=ib;this._showUnreadLink=jb;l.empty(this._rootElement);this._pagerExponent=-1;var lb=y[':fb:web-messenger:read-view:recent-messages'].build();l.setContent(this._rootElement,lb.getRoot());this._selectedConversationView=lb.getRoot();this._messageList=lb.getNode('messagelist');this._loadMoreButton=lb.getNode('loadMoreButton');this._loadMoreLink=lb.getNode('loadMoreLink');this._loadMoreCount=lb.getNode('loadMoreCount');this._loadingMoreCount=lb.getNode('loadingMoreCount');this._indicatorNode=lb.getNode('lastMessageIndicator');this._unseenMessagesNotice=new k(this._manager);this._unseenMessagesNotice.setNoticeContextNode(kb);this._active=false;this._state=null;this._threadID=null;this._bugReportingEnabled=false;this._currentCountMap={};this._olderMessageID={};this._loadMessagesInFlight={};aa.setupSelectionListener(this._messageList);this._manager.setScrollCallback(ia(db.curry(this),500));ga.addSubscriptions(g.listen(this._loadMoreLink,'click',wa.curry(this)),z.subscribe('messages-reordered',function(mb,nb){var ob=this._threadID&&nb[this._threadID];if(ob)sa(this);}.bind(this)),z.subscribe('messages-updated',function(mb,nb){var ob=this._threadID&&nb[this._threadID];if(ob)var pb=Object.keys(ob),qb=pb.length&&ob[pb[0]];if(ob&&qb)sa(this,nb[this._threadID]);}.bind(this)),z.subscribe('messages-updated',db.curry(this)),z.subscribe('messages-received',function(mb,nb){if(this._threadID&&nb[this._threadID])va(this,nb);}.bind(this)),z.subscribe('thread-read-changed',function(mb,nb){if(nb[this._threadID])ab(this,nb[this._threadID]);}.bind(this)),this._manager.subscribe('scrolledNearTop',function(){this._active&&wa(this);}.bind(this)));}ma.prototype.hideView=function(){this._active=false;j.hide(this._rootElement);j.hide(this._loadingSpinner);j.hide(this._noSelectedConversation);this._unseenMessagesNotice.hideView();this._manager._flexArea.setBottomAligned(false);};ma.prototype.updateView=function(){this._unseenMessagesNotice.updateView();this._active=true;this._manager._flexArea.setBottomAligned(true);j.show(this._rootElement);var eb=oa(this);pa(this);t.clear();if(eb){qa(this);}else ya(this);};ma.prototype.destroy=function(){na(this);this._unseenMessagesNotice.destroy();this._lastMessageIndicator&&this._lastMessageIndicator.destroy();};function na(eb){eb._messagesSubscription&&s.unsubscribe(eb._messagesSubscription.subscriber_id,eb._messagesSubscription.thread_id);eb._messagesSubscription=null;}function oa(eb){var fb=w.getCurrentStateData();if(!eb._threadID||eb._threadID!=fb.thread_id)return true;return false;}function pa(eb){var fb=w.getCurrentStateData();eb._state=w.getCurrentDetailState();eb._threadID=fb.thread_id;eb._selectionEnabled=!!fb.message_action;eb._bugReportingEnabled=fb.bug_reporting_enabled;aa.updateSelection(eb._messageList);j.conditionClass(eb._messageList,'bugReportingEnabled',eb._bugReportingEnabled);}function qa(eb){l.empty(eb._messageList);j.show(eb._loadingSpinner);j.hide(eb._loadMoreButton);na(eb);eb._pagerExponent=-1;eb._lastMessageIndicator&&eb._lastMessageIndicator.destroy();delete eb._lastMessageIndicator;if(eb._threadID){j.show(eb._selectedConversationView);j.hide(eb._noSelectedConversation);if(!eb._olderMessageID[eb._threadID]){ra(eb);}else sa(eb);eb._manager.scrollToBottom(false);}else{cb(eb);j.hide(eb._selectedConversationView);j.show(eb._noSelectedConversation);j.hide(eb._loadingSpinner);}}function ra(eb){eb._loadMessagesInFlight[eb._threadID]=true;eb._currentCountMap[eb._threadID]=da.INITIAL_MESSAGES_LIMIT+1;j.hide(eb._loadMoreButton);var fb=s.getThreadMessagesRange(eb._threadID,0,eb._currentCountMap[eb._threadID],ta.curry(eb),null,p.WEBMESSENGER);if(fb){eb._messagesSubscription={subscriber_id:fb,thread_id:eb._threadID};}else sa(eb);}function sa(eb,fb){if(!eb._threadID||!eb._olderMessageID[eb._threadID])return;var gb=s.getThreadMessagesSinceTimestamp(eb._threadID,bb(eb._olderMessageID[eb._threadID]));if(gb.length>eb._currentCountMap[eb._threadID])eb._currentCountMap[eb._threadID]=gb.length;ua(eb,gb,fb);}function ta(eb,fb){eb._loadMessagesInFlight[eb._threadID]=false;if(fb&&fb.length){var gb=fb[0].timestamp,hb=eb._olderMessageID[eb._threadID]?bb(eb._olderMessageID[eb._threadID]):null;if(!hb||gb<hb)eb._olderMessageID[eb._threadID]=fb[0].message_id;}}function ua(eb,fb,gb){fb=m.filterMessages(function(rb){eb._manager.openUserJoinStatusSheet(rb);},fb,false);j.hide(eb._loadingSpinner);j.conditionShow(eb._loadMoreButton,!s.hasLoadedAllMessages(eb._threadID));var hb=ba.getThreadMetaNow(eb._threadID);if(hb){var ib=hb.message_count-fb.length;ib=(ib<0)?0:ib;l.setContent(eb._loadMoreCount,ib);l.setContent(eb._loadingMoreCount,ib);}var jb=function(rb){var sb,tb=ka('wm:'+rb);if(tb)sb=fa.findAll(tb);return sb||[];},kb=[],lb=aa.calculateMessageGroups(fb),mb={},nb=[];lb.forEach(function(rb){var sb=rb[0].message_id,tb=false;if(gb){tb=rb.some(function(vb){return vb.message_id in gb;});if(!tb){kb=jb(sb);tb=kb.some(function(vb){return vb in gb;});}}if(!tb){kb=jb(sb);if(rb.length==kb.length){for(var ub=0;ub<rb.length;ub++)if(rb[ub].message_id!=kb[ub]){tb=true;break;}}else tb=true;}if(tb)mb[sb]=1;nb.push('wm:'+sb);});var ob=function(rb){return !mb[lb[rb][0].message_id];},pb=function(rb){var sb=lb[rb],tb=aa.renderMessageGroupArray(sb);if(rb==nb.length-1)eb._messageGroup=tb;return tb.getRoot();},qb=function(rb){return aa.renderMessageSeparatorForIndex(lb,rb);};o.updateList(eb._messageList,nb,ob,pb,qb);eb._lastMessage=fb[fb.length-1];xa(eb).setLastMessage(eb._lastMessage);ya(eb);eb._manager.poke();}function va(eb,fb){var gb=fb[eb._threadID];gb=m.filterMessages(function(lb){eb._manager.openUserJoinStatusSheet(lb);},gb,true);var hb=eb._manager._flexArea.getScrollableArea(),ib=hb.getScrollHeight();gb.forEach(function(lb){lb.timestamp_relative=ja(new Date(lb.timestamp),'g:ia');var mb=aa.canAppendMessageToLastGroup(eb._lastMessage,lb);if(!mb){eb._messageGroup=aa.renderMessageGroup(lb);var nb=lb.timestamp,ob=eb._lastMessage?eb._lastMessage.timestamp:0,pb=da.READ_VIEW_SEPARATOR_TIME_LIMIT;if(!ob||nb-ob>=pb){var qb=aa.renderMessageSeparator(lb);l.appendContent(eb._messageList,qb);}l.appendContent(eb._messageList,eb._messageGroup.getRoot());}else aa.appendMessageToGroup(eb._messageGroup,lb);if(lb.author!=q.user)j.addClass(eb._messageGroup.getRoot(),'unreadHighlight');eb._lastMessage=lb;});eb._manager._flexArea.poke();var jb=hb.getScrollHeight(),kb=hb.getScrollTop();eb._unseenMessagesNotice.updateOnMessagesReceived(ib,jb,kb,fb);xa(eb).setLastMessage(eb._lastMessage);if(eb._manager.isScrolledToBottom())ya(eb);}function wa(eb){j.addClass(eb._loadMoreButton,'async_saving');if(eb._loadMessagesInFlight[eb._threadID])return;eb._loadMessagesInFlight[eb._threadID]=true;eb._pagerExponent=Math.min(eb._pagerExponent+1,da.EXPONENTIAL_PAGER_MAX_CYCLES);var fb=Math.pow(2,eb._pagerExponent),gb=eb._currentCountMap[eb._threadID]+(fb*r.WEBMESSENGER_MORE_MESSAGES_COUNT);na(eb);var hb=s.getThreadMessagesRange(eb._threadID,0,gb,function(ib){j.removeClass(eb._loadMoreButton,'async_saving');eb._currentCountMap[eb._threadID]=gb;ta(eb,ib);eb._loadMessagesInFlight[eb._threadID]=false;},null,p.WEBMESSENGER);if(hb){eb._messagesSubscription={subscriber_id:hb,thread_id:eb._threadID};}else sa(eb);}function xa(eb){if(!eb._lastMessageIndicator)eb._lastMessageIndicator=new i(eb._threadID,eb._indicatorNode,null,eb._manager._flexArea);return eb._lastMessageIndicator;}function ya(eb){if(ca.isActive(5000)){za(eb);}else ca.subscribeOnce(za.curry(eb));}function za(eb){if(!eb._threadID||!eb._active)return;ba.changeThreadReadStatus(eb._threadID,true);var fb=l.scry(eb._messageList,'.unreadHighlight');fb.forEach(function(gb){j.removeClass(gb,'unreadHighlight');j.addClass(gb,'unreadFading');new h(gb).from('background','#eceff5').to('background','#fff').from('borderColor','#d6d6d6').to('borderColor','#fff').ease(h.ease.both).duration(1500).ondone(function(){j.removeClass(gb,'unreadFading');x.set(gb,'background','');x.set(gb,'borderColor','');}).go();});}function ab(eb,fb){if(!fb.mark_as_read)return;var gb=l.scry(eb._messageList,'.unreadHighlight');for(var hb=0;hb<gb.length;hb++){var ib=gb[hb],jb=fa.findAll(ib),kb=s.getMessagesFromIDs(jb);if(kb[kb.length-1].timestamp<fb.timestamp)j.removeClass(ib,'unreadHighlight');}}function bb(eb){var fb=s.getMessagesFromIDs([eb])[0];return fb?fb.timestamp:0;}function cb(eb){if(eb._builtNoSelectionBox)return;var fb=function(){var hb=w.getCurrentStateData(),ib=ha({},hb);w.updateDetailState(v.DETAIL.COMPOSE_MAIN,ha(ib,{start:true,thread_id:undefined}));},gb=function(){var hb=w.getCurrentStateData(),ib=ha({},hb);w.updateMasterState(v.MASTER.RECENT_THREADS,ha(ib,{folder:u.INBOX,filter:u.UNREAD}));};l.setContent(eb._noSelectedConversation,ea.render("No hay conversaciones seleccionadas",[{text:"Nuevo mensaje",handler:fb},{text:"Mostrar no le\u00eddos",handler:gb}]));eb._builtNoSelectionBox=true;}function db(eb){var fb=eb._manager._flexArea.getScrollableArea(),gb=eb._manager.getFlexAreaBoundingClientRect();n.inform('messengerScrolled/'+eb._threadID,{scrollTop:fb.getScrollTop(),top:gb.y,viewHeight:gb.height});}e.exports=ma;});
__d("MercurySearchContextResults",["KeyedCallbackManager","MercuryAPIArgsSource","MercuryThreadlistConstants","RangedCallbackManager","MercuryServerDispatcher","MercuryServerRequests","WebMessengerConstants"],function(a,b,c,d,e,f){var g=b('KeyedCallbackManager'),h=b('MercuryAPIArgsSource'),i=b('MercuryThreadlistConstants'),j=b('RangedCallbackManager'),k=b('MercuryServerDispatcher'),l=b('MercuryServerRequests').get(),m=b('WebMessengerConstants'),n=new g(),o=i.WEBMESSENGER_SEARCH_SNIPPET_COUNT,p=m.MORE_SEARCH_CONTEXT_COUNT,q={getSearchContext:function(u,v,w){if(u){var x=n.executeOrEnqueue(u,function(aa){var ba=s(aa,u);w(ba);}),y=n.getUnavailableResources(x);if(y.length){var z=l.getServerThreadIDNow(v);t({message_id:u,thread_id:z,limit:o+1});}return x;}},getMoreSearchContext:function(u,v,w,x){if(u){var y=n.getResource(u);if(y){var z=w==m.MORE_SEARCH_CONTEXT_UP?y.up_message_ids:y.down_message_ids,aa=z.getCurrentArraySize()+p,ba=z.executeOrEnqueue(0,aa,function(){var ea=s(y,u);x(ea);}),ca=z.getUnavailableResources(ba);if(ca.length){var da=l.getServerThreadIDNow(v);t({message_id:u,thread_id:da,limit:aa,direction:w});}return ba;}}},handleUpdate:function(u){if(u.mercury_payload)l.handleUpdate(u.mercury_payload);var v=u.search_context||{};for(var w in v){var x=v[w],y=x.thread_id,z=l.getClientThreadIDNow(y),aa=!n.getResource(w),ba=aa?{thread_id:z,up_message_ids:new j(),down_message_ids:new j()}:n.getResource(w),ca=aa?o+1:p;if(x.up_message_ids&&(ba.up_message_ids.getCurrentArraySize()===0||x.up_message_ids.length>=ba.up_message_ids.getCurrentArraySize()))r(ba.up_message_ids,x.up_message_ids,ca);if(x.down_message_ids&&(ba.down_message_ids.getCurrentArraySize()===0||x.down_message_ids.length>=ba.down_message_ids.getCurrentArraySize()))r(ba.down_message_ids,x.down_message_ids,ca);if(aa)n.setResource(w,ba);}},unsubscribe:function(u,v,w){if(v){var x=n.getResource(v);if(x){if(w==m.MORE_SEARCH_CONTEXT_UP){x.up_message_ids.unsubscribe(u);}else x.down_message_ids.unsubscribe(u);}else n.unsubscribe(u);}}};function r(u,v,w){var x=u.getCurrentArraySize(),y=v.length<x+w;if(v.length){u.removeAllResources();u.addResourcesWithoutSorting(v,0);}if(y)u.setReachedEndOfArray();}function s(u,v){var w=u.up_message_ids.hasReachedEndOfArray(),x=u.up_message_ids.getAllResources();if(!w)x.shift();var y=u.down_message_ids.hasReachedEndOfArray(),z=u.down_message_ids.getAllResources();if(!y)z.pop();return {thread_id:u.thread_id,message_id:v,up_message_ids:x,up_exhausted:w,down_message_ids:z,down_exhausted:y};}function t(u){u.client=h.WEBMESSENGER;k.trySend('/ajax/mercury/search_context.php',u);}k.registerEndpoints({'/ajax/mercury/search_context.php':{mode:k.IMMEDIATE,handler:q.handleUpdate}});e.exports=q;});
__d("MercurySearchSnippetResults",["MercuryAPIArgsSource","MercuryThreadlistConstants","RangedCallbackManager","MercuryServerDispatcher","MercuryServerRequests"],function(a,b,c,d,e,f){var g=b('MercuryAPIArgsSource'),h=b('MercuryThreadlistConstants'),i=b('RangedCallbackManager'),j=b('MercuryServerDispatcher'),k=b('MercuryServerRequests').get(),l={},m={},n=null,o=h.WEBMESSENGER_SEARCH_SNIPPET_COUNT,p=h.WEBMESSENGER_SEARCH_SNIPPET_LIMIT,q=h.WEBMESSENGER_SEARCH_SNIPPET_MORE,r={getAllThreadSearchResults:function(ba,ca){if(ba)s(ba,p,0,ca);},getAllThreadSearchMoreResults:function(ba,ca){if(ba){var da=l[ba];if(da){var ea=da.getCurrentArraySize();s(ba,q,ea,ca);}}},getSingleThreadSearchResults:function(ba,ca,da){if(!ba||!ca)return;t(ba,ca,o,0,da);},getSingleThreadSearchMoreResults:function(ba,ca,da){if(!ba||!ca)return;if(!m[ca])return;var ea=m[ca][ba];if(ea){var fa=ea.num_total_snippets,ga=ea.snippets_cbm.getCurrentArraySize(),ha=fa-ga;if(ha>0){var ia=ha>q?q:ha;t(ba,ca,ia,ga,da);}}},countSnippetsMatchingQueryInThread:function(ba,ca){var da=m[ca][ba];if(da)return da.num_total_snippets;},findIndexOfSnippet:function(ba,ca,da,ea){var fa=z(ba,ca),ga=fa.getAllResources();for(var ha=0;ha<ga.length;ha++)if(da===ga[ha].message_id)return ha;},findSnippetAtIndex:function(ba,ca,da,ea){w(ba,ca,da);x(ba,ca,da,ea);},handleUpdate:function(ba){if(ba.mercury_payload)k.handleUpdate(ba.mercury_payload);var ca=ba.search_snippets||{};Object.keys(ca).filter(function(qa){return !!ca[qa];}).forEach(function(qa){Object.keys(ca[qa]).forEach(function(ra){ca[qa][ra].snippets.forEach(function(sa){sa.matched_keywords=u(sa.matched_keywords);});});});var da=ba.offset,ea=[];for(var fa in ca){var ga=ca[fa];for(var ha in ga){var ia=ga[ha],ja=k.getClientThreadIDNow(ha),ka=ia.snippets,la=z(fa,ja),ma=la.getCurrentArraySize();if(!ba.thread_id){ea.push(ja);if(ma)continue;}else if(da!=ma)continue;var na=m[ja][fa];na.num_total_snippets=ia.num_total_snippets;la.addResourcesWithoutSorting(ka,ma);if(!ba.thread_id||ba.limit>ka.length)if(la.getCurrentArraySize()==na.num_total_snippets)la.setReachedEndOfArray();}if(!ba.thread_id){var oa=y(fa),pa=oa.getCurrentArraySize();if(da==pa){oa.addResourcesWithoutSorting(ea,pa);if(ba.limit>ea.length)oa.setReachedEndOfArray();}}}}};function s(ba,ca,da,ea){v();var fa=y(ba),ga=da+ca,ha=fa.executeOrEnqueue(0,ga,function(ja){var ka={};for(var la=0;la<ja.length;la++){var ma=ja[la],na=m[ma][ba];ka[ma]={num_total_snippets:na.num_total_snippets,snippets:na.snippets_cbm.getAllResources()};}var oa=fa.hasReachedEndOfArray();ea(ka,oa);}),ia=fa.getUnavailableResources(ha);if(ia.length){n={query:ba,thread_id:null,subscriber_id:ha};aa({query:ba,offset:da,limit:ca+1,snippetLimit:o});}}function t(ba,ca,da,ea,fa){v();var ga=z(ba,ca),ha=ea+da,ia=ga.executeOrEnqueue(0,ha,function(){var la=ga.getAllResources(),ma=m[ca][ba].num_total_snippets;fa(la,ma);}),ja=ga.getUnavailableResources(ia);if(ja.length){n={query:ba,thread_id:ca,subscriber_id:ia};var ka=k.getServerThreadIDNow(ca);aa({query:ba,thread_id:ka,snippetOffset:ea,snippetLimit:da});}}function u(ba){if(ba instanceof Array){var ca={};for(var da=0;da<ba.length;da++)ca[da.toString()]=ba[da];return ca;}else return ba;}function v(){if(n){if(n.thread_id){var ba=z(n.query,n.thread_id);ba.unsubscribe(n.subscriber_id);}else{var ca=y(n.query);ca.unsubscribe(n.subscriber_id);}n=null;}}function w(ba,ca,da){}function x(ba,ca,da,ea){var fa=m[ca][ba],ga=fa.snippets_cbm.getAllResources(),ha=fa.num_total_snippets,ia=ga.length;if(da<ia){ea(ga[da].message_id);return;}var ja=ha-ia,ka=ja>q?q:ja;t(ba,ca,ka,ia,function(la,ma){x(ba,ca,da,ea);});}function y(ba){if(!l[ba])l[ba]=new i();return l[ba];}function z(ba,ca){if(!m[ca])m[ca]={};var da=m[ca][ba];if(!da){da={num_total_snippets:-1,snippets_cbm:new i()};m[ca][ba]=da;}return da.snippets_cbm;}function aa(ba){ba.client=g.WEBMESSENGER;j.trySend('/ajax/mercury/search_snippets.php',ba);}j.registerEndpoints({'/ajax/mercury/search_snippets.php':{mode:j.IMMEDIATE,handler:r.handleUpdate}});e.exports=r;});
__d("WebMessengerDetailViewSearchContextControl",["Event","CSS","DOM","MercuryMessages","WebMessengerMessagesSelection","MercurySearchContextResults","MercurySearchSnippetResults","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerThreadMessagesRenderer","WebMessengerConstants","WebMessengerSubscriptionsHandler"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('DOM'),j=b('MercuryMessages').get(),k=b('WebMessengerMessagesSelection'),l=b('MercurySearchContextResults'),m=b('MercurySearchSnippetResults'),n=b('WebMessengerStateConstants'),o=b('WebMessengerStateManager'),p=b('WebMessengerTemplates'),q=b('WebMessengerThreadMessagesRenderer'),r=b('WebMessengerConstants'),s=b('WebMessengerSubscriptionsHandler');function t(da,ea,fa){this._manager=da;this._rootElement=ea;this._paginationBox=fa;i.empty(this._rootElement);var ga=p[':fb:web-messenger:read-view:search-context'].build(),ha=p[':fb:web-messenger:read-view:search-pagination-box'].build();i.setContent(this._rootElement,ga.getRoot());i.setContent(this._paginationBox,ha.getRoot());this._messagelistRoot=ga.getRoot();this._loadingSpinner=ga.getNode('loadingSpinner');this._messageList=ga.getNode('messagelist');this._loadMoreButton=ga.getNode('loadMoreButton');this._loadMoreLink=ga.getNode('loadMoreLink');this._downMoreButton=ga.getNode('downMoreButton');this._downMoreLink=ga.getNode('downMoreLink');this._nextSnippet=ha.getNode('nextSnippet');this._previousSnippet=ha.getNode('previousSnippet');this._backToSnippetsButton=ha.getNode('backToSnippetsButton');this._snippetCountDescription=ha.getNode('snippetCountDescription');this._paginationBoxCloseButton=ha.getNode('paginationBoxCloseButton');this._state=null;this._threadID=null;this._messageID=null;q.setupSelectionListener(this._messageList);s.addSubscriptions(g.listen(this._loadMoreLink,'click',function(){h.addClass(this._loadMoreButton,'async_saving');ba(this,r.MORE_SEARCH_CONTEXT_UP);}.bind(this)),g.listen(this._downMoreLink,'click',function(){h.addClass(this._downMoreButton,'async_saving');ba(this,r.MORE_SEARCH_CONTEXT_DOWN);}.bind(this)),g.listen(this._nextSnippet,'click',u.curry(this,1)),g.listen(this._previousSnippet,'click',u.curry(this,-1)),g.listen(this._backToSnippetsButton,'click',function(){var ia=o.getCurrentStateData(),ja=ia.single_thread_search?n.DETAIL.SEARCH_THREAD_SNIPPET:n.DETAIL.SEARCH_SNIPPET,ka={folder:ia.folder,message_query:ia.message_query,query:ia.query};if(ia.single_thread_search)ka.thread_id=ia.thread_id;o.updateDetailState(ja,ka);}),g.listen(this._paginationBoxCloseButton,'click',function(){o.updateDetailState(n.DETAIL.RECENT_MESSAGES,{thread_id:o.getCurrentStateData().thread_id});}.bind(this)));}t.prototype.hideView=function(){h.hide(this._rootElement);h.hide(this._paginationBox);};t.prototype.updateView=function(){h.show(this._rootElement);h.show(this._paginationBox);var da=x(this);y(this);k.clear();if(da)aa(this);};t.prototype.destroy=function(){w(this);};function u(da,ea){var fa=o.getCurrentStateData(),ga=m.findIndexOfSnippet(da._messageQuery,fa.thread_id,fa.message_id),ha=ga+ea;h.hide(da._messageList);h.hide(da._loadMoreButton);h.hide(da._downMoreButton);h.show(da._loadingSpinner);m.findSnippetAtIndex(da._messageQuery,fa.thread_id,ha,function(ia){h.show(da._messageList);v(fa,ia);});}function v(da,ea){var fa={folder:da.folder,message_id:ea,message_query:da.message_query,query:da.query,single_thread_search:da.single_thread_search,thread_id:da.thread_id};o.updateDetailState(o.getCurrentDetailState(),fa);}function w(da){da._searchContextSubscription&&l.unsubscribe(da._searchContextSubscription.subscriber_id,da._searchContextSubscription.message_id,da._searchContextSubscription.direction);da._searchThreadsSubscription=null;}function x(da){var ea=o.getCurrentStateData();if(da._threadID!=ea.thread_id)return true;if(da._messageQuery!=ea.message_query)return true;if(da._messageID!=ea.message_id)return true;return false;}function y(da){var ea=o.getCurrentStateData();da._state=o.getCurrentDetailState();da._threadID=ea.thread_id;da._messageQuery=ea.message_query;da._messageID=ea.message_id;da._selectionEnabled=!!ea.message_action;q.updateSelection(da._messageList);h.conditionClass(da._messageList,'bugReportingEnabled',ea.bug_reporting_enabled);}function z(da,ea){i.setAttributes(da,{disabled:ea});var fa=i.find(da,'^label');h.conditionClass(fa,'uiButtonDisabled',ea);}function aa(da){var ea=i.create('strong',{},da._messageQuery),fa=m.countSnippetsMatchingQueryInThread(da._messageQuery,da._threadID),ga=m.findIndexOfSnippet(da._messageQuery,da._threadID,da._messageID),ha=ga+1,ia=i.tx._("{index} de {count} resultados para {query}",{index:ha,count:fa,query:ea});i.setContent(da._snippetCountDescription,ia);z(da._previousSnippet,ga===0);z(da._nextSnippet,ga===fa-1);i.empty(da._messageList);h.show(da._loadingSpinner);h.hide(da._loadMoreButton);h.hide(da._downMoreButton);w(da);if(da._threadID&&da._messageID){var ja=l.getSearchContext(da._messageID,da._threadID,function(ka){h.hide(da._loadingSpinner);ca(da,ka);});if(ja)da._searchContextSubscription={subscriber_id:ja,message_id:da._messageID};}}function ba(da,ea){w(da);if(da._threadID&&da._messageID){var fa=l.getMoreSearchContext(da._messageID,da._threadID,ea,function(ga){if(ea==r.MORE_SEARCH_CONTEXT_UP){h.removeClass(da._loadMoreButton,'async_saving');}else h.removeClass(da._downMoreButton,'async_saving');ca(da,ga);});if(fa)da._searchContextSubscription={subscriber_id:fa,message_id:da._messageID,direction:ea};}}function ca(da,ea){h.conditionShow(da._loadMoreButton,!ea.up_exhausted);h.conditionShow(da._downMoreButton,!ea.down_exhausted);var fa=ea.up_message_ids.concat([ea.message_id],ea.down_message_ids),ga=j.getMessagesFromIDs(fa);i.empty(da._messageList);var ha=q.calculateMessageGroups(ga);ha.forEach(function(ia,ja){var ka=q.renderMessageSeparatorForIndex(ha,ja);if(ka)i.appendContent(da._messageList,ka);var la=q.renderMessageGroupArray(ia,false,'context:').getRoot(),ma=ia.some(function(na){return na.message_id==ea.message_id;});if(ma)h.addClass(la,'selectedHighlight');i.appendContent(da._messageList,la);});}e.exports=t;});
__d("WebMessengerSearchSnippetsRenderer",["Event","CSS","DOM","Image.react","MercuryMessageRenderer","MercuryParticipants","MercuryParticipantsConstants","React","MercurySearchSnippetResults","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","MercuryThreadMetadataRenderer","cx","tx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('DOM'),j=b('Image.react'),k=b('MercuryMessageRenderer'),l=b('MercuryParticipants'),m=b('MercuryParticipantsConstants'),n=b('React'),o=b('MercurySearchSnippetResults'),p=b('WebMessengerStateConstants'),q=b('WebMessengerStateManager'),r=b('WebMessengerTemplates'),s=b('MercuryThreadMetadataRenderer').get(),t=b('cx'),u=b('tx'),v={renderMultipleSnippetBlocks:function(ba,ca,da){da=da||{};var ea=true;for(var fa in da){ea=false;var ga=r[':fb:web-messenger:read-view:search-snippets-block'].build();i.appendContent(ba,ga.getRoot());v.renderSingleSnippetBlock(ga,ca,fa,da[fa]);}if(ea)aa(ba);},renderThreadSnippetBlock:function(ba,ca,da,ea,fa){if(!ea||!ea.length){aa(ba);return;}var ga=r[':fb:web-messenger:read-view:search-snippets-block'].build();i.appendContent(ba,ga.getRoot());h.hide(ga.getNode('searchThreadName'));w(ga,ca,da,ea,fa);},renderSingleSnippetBlock:function(ba,ca,da,ea){var fa=ba.getNode('searchThreadName'),ga=i.create('h3');i.setContent(fa,ga);s.renderAndSeparatedParticipantList(da,ga);w(ba,ca,da,ea.snippets,ea.num_total_snippets);},renderMultipleSnippets:function(ba,ca,da,ea){(ea||[]).forEach(function(fa){var ga=r[':fb:web-messenger:read-view:search-snippet'].build();i.appendContent(ba,ga.getRoot());l.get(fa.author,function(ha){v.renderSingleSnippet(ga,ca,da,fa,ha);});});},renderSingleSnippet:function(ba,ca,da,ea,fa){ba.setNodeProperty('bodyDiv','id','snippet:'+ea.message_id);var ga=ea.matched_keywords||undefined,ha=k.formatMessageBody(ea.body,ga);ba.setNodeContent('body',ha);var ia=ba.getNode('image');h.removeClass(ia,'MercuryThreadImage');h.addClass(ia,'MercuryMediumThreadImage');var ja=j({width:m.IMAGE_SIZE,height:m.IMAGE_SIZE,src:fa.image_src});if(fa.href)ja=n.DOM.a({href:fa.href},ja);n.renderComponent(ja,ia);var ka=fa.short_name;ba.setNodeContent('shortName',i.tx._("{name}:",{name:ka}));s.renderTimestamp(ba.getNode('timestamp'),ea.timestamp_absolute,ea.timestamp_relative,ea.timestamp);var la=ba.getNode('seeContext');g.listen(la,'click',function(){var ma=q.getCurrentStateData(),na={message_query:ca,query:ma.query,thread_id:da,message_id:ea.message_id},oa=q.getCurrentDetailState();if(oa===p.DETAIL.SEARCH_THREAD_SNIPPET)na.single_thread_search=true;q.updateDetailState(p.DETAIL.SEARCH_CONTEXT,na);return false;});}};function w(ba,ca,da,ea,fa){var ga=ba.getNode('snippetList');v.renderMultipleSnippets(ga,ca,da,ea);var ha=fa-ea.length;x(ba,ca,da,fa,ha);}function x(ba,ca,da,ea,fa){var ga=ba.getNode('totalSnippetsCount'),ha=ba.getNode('moreSnippetsLink');h.conditionShow(ha,fa>0);if(fa>0){var ia=z(fa);i.setContent(ha,ia);}i.setContent(ga,y(ea));if(fa>0)g.listen(ha,'click',function(){o.getSingleThreadSearchMoreResults(ca,da,function(ja){i.empty(ba.getNode('snippetList'));w(ba,ca,da,ja,ea);});});}function y(ba){if(ba==1){return "1 resultado en total";}else return u._("{count} resultados en total",{count:ba});}function z(ba){if(ba==1){return "Mostrar 1 resultado m\u00e1s";}else return u._("Mostrar {count} resultados m\u00e1s",{count:ba});}function aa(ba){var ca="No hay resultados",da=i.create('div',{className:"_2n4"},ca);i.setContent(ba,da);}e.exports=v;});
__d("WebMessengerDetailViewSearchSnippetsControl",["JSXDOM","Event","CSS","DOM","MercurySearchSnippetResults","WebMessengerSearchSnippetsRenderer","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerPermalinks","WebMessengerSubscriptionsHandler","cx","tx"],function(a,b,c,d,e,f){var g=b('JSXDOM'),h=b('Event'),i=b('CSS'),j=b('DOM'),k=b('MercurySearchSnippetResults'),l=b('WebMessengerSearchSnippetsRenderer'),m=b('WebMessengerStateConstants'),n=b('WebMessengerStateManager'),o=b('WebMessengerTemplates'),p=b('WebMessengerPermalinks'),q=b('WebMessengerSubscriptionsHandler'),r=b('cx'),s=b('tx');function t(y,z){this._manager=y;this._rootElement=z;j.empty(this._rootElement);var aa=o[':fb:web-messenger:read-view:search-snippets'].build();j.setContent(this._rootElement,aa.getRoot());this._loadingSpinner=aa.getNode('loadingSpinner');this._messageList=aa.getNode('messagelist');this._downMoreButton=aa.getNode('downMoreButton');this._downMoreLink=aa.getNode('downMoreLink');this._state=null;this._messageQuery=null;this._threadID=null;i.hide(this._downMoreButton);q.addSubscriptions(h.listen(this._downMoreLink,'click',function(){i.addClass(this._downMoreButton,'async_saving');x(this);}.bind(this)));}t.prototype.hideView=function(){i.hide(this._rootElement);};t.prototype.updateView=function(){i.show(this._rootElement);var y=u(this);v(this);if(y)w(this);};t.prototype.destroy=function(){};function u(y){var z=n.getCurrentDetailState();if(y._state!=z)return true;var aa=n.getCurrentStateData();if(y._messageQuery!=aa.message_query)return true;if(z==m.DETAIL.SEARCH_THREAD_SNIPPET)if(y._threadID!=aa.thread_id)return true;return false;}function v(y){y._state=n.getCurrentDetailState();var z=n.getCurrentStateData();y._threadID=z.thread_id;y._messageQuery=z.message_query;}function w(y){i.hide(y._downMoreButton);j.empty(y._messageList);if(y._messageQuery){i.show(y._loadingSpinner);if(y._state===m.DETAIL.SEARCH_THREAD_SNIPPET&&y._threadID){k.getSingleThreadSearchResults(y._messageQuery,y._threadID,function(z,aa){i.hide(y._loadingSpinner);l.renderThreadSnippetBlock(y._messageList,y._messageQuery,y._threadID,z,aa);var ba=g.a({className:"_4-ii"},s._("Buscar todas las conversaciones de \"{query}\"",{query:y._messageQuery})),ca=p.getURI(m.MASTER.SEARCH,m.DETAIL.SEARCH_SNIPPET,{query:y._messageQuery,message_query:y._messageQuery});ba.setAttribute('href',ca);j.prependContent(y._messageList,g.div({className:"_4-ij"},ba));});}else k.getAllThreadSearchResults(y._messageQuery,function(z,aa){i.hide(y._loadingSpinner);l.renderMultipleSnippetBlocks(y._messageList,y._messageQuery,z);i.conditionShow(y._downMoreButton,!aa);});}}function x(y){if(y._messageQuery)k.getAllThreadSearchMoreResults(y._messageQuery,function(z,aa){i.removeClass(y._downMoreButton,'async_saving');j.empty(y._messageList);l.renderMultipleSnippetBlocks(y._messageList,y._messageQuery,z);i.conditionShow(y._downMoreButton,!aa);});}e.exports=t;});
__d("Ellipsizer",["CSS","DOM","Style","UserAgent","cx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('Style'),j=b('UserAgent'),k=b('cx'),l=1.3;function m(n){this.elements=[];n.forEach(function(o){g.addClass(o,"_6qy");this.elements.push({node:o});}.bind(this));return this;}m.prototype._analyzeElements=function(){var n;this.elements.forEach(function(o){n=o.node;while(n.children.length===1)n=n.children[0];if(n===o.node)i.set(n,'width','');j.ie()&&i.set(n,'position','absolute');o.width=n.offsetWidth;j.ie()&&i.set(n,'position','');});this.elements.sort(function(o,p){return o.width-p.width;});};m.prototype.confineWithin=function(n){this._analyzeElements();var o=n;this.elements.forEach(function(p,q){var r=Math.floor(o/(this.elements.length-q));if(p.width<=r||p.width<=0||r<=0||(p.width<=r*l&&o>=r*l)){g.removeClass(p.node,"_6s5");i.set(p.node,'width','');o-=p.width;if(p.titleSet){p.node.setAttribute('title','');p.titleSet=false;}}else{g.addClass(p.node,"_6s5");i.set(p.node,'width',r+'px');o-=r;if(!p.titleSet&&!p.node.getAttribute('title')){p.node.setAttribute('title',h.getText(p.node));p.titleSet=true;}}}.bind(this));};e.exports=m;});
__d("TabIndexDelegator",["CSS","DOM","Event","Focus","JSXDOM"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('Event'),j=b('Focus'),k=b('JSXDOM');function l(m,n){this._placeholder=n||k.button(null);this._placeholder.setAttribute('aria-describedby',h.getID(m));g.addClass(this._placeholder,'accessible_elem');this._listener=i.listen(this._placeholder,'click',function(){m.click();});j.relocate(this._placeholder,m);this.enable();}l.prototype.enable=function(){g.show(this._placeholder);};l.prototype.disable=function(){g.hide(this._placeholder);};l.prototype.getPlaceholder=function(){return this._placeholder;};l.prototype.destroy=function(){this._listener.remove();h.remove(this._placeholder);};e.exports=l;});
__d("WebMessengerForwardedMessages",["Event","CSS","DOM","MercuryMessages","WebMessengerThreadMessagesRenderer","WebMessengerEvents","WebMessengerSubscriptionsHandler","tx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('DOM'),j=b('MercuryMessages').get(),k=b('WebMessengerThreadMessagesRenderer'),l=b('WebMessengerEvents'),m=b('WebMessengerSubscriptionsHandler'),n=b('tx');function o(p,q,r,s){this._parent=p;this._title=q;this._shelf=r;this._closeButton=s;this._forwardedMessages=[];m.addSubscriptions(g.listen(this._closeButton,'click',this.clear.bind(this)));}o.prototype.setForwardedMessages=function(p){this._forwardedMessages=p;this._render();};o.prototype.clear=function(){this._forwardedMessages=[];this._render();};o.prototype.getForwardedMessages=function(){return this._forwardedMessages||[];};o.prototype._render=function(){i.empty(this._shelf);var p=this._forwardedMessages.length;if(p){var q=(p===1)?"Un mensaje reenviado":n._("{num} mensajes reenviados",{num:p});i.setContent(this._title,q);k.renderForwardedMessages(this._shelf,j.getMessagesFromIDs(this._forwardedMessages));}h.conditionShow(this._parent,p);l.detailDOMChanged();};e.exports=o;});
__d("WebMessengerDetailViewBottomShelfControl",["Event","Arbiter","ARIA","AsyncDialog","AsyncRequest","Button","MercuryConstants","CSS","DOM","MercuryDraftsController","Ellipsizer","Focus","fbt","MercuryFolders","Input","Keys","Locale","UserAgent","MercuryAPIArgsSource","MercuryConfig","MercuryFileUploader","MercuryPhotoUploader","MercuryShareLinkUploader","MercurySourceType","MercuryStickers.react","MercuryMessages","MessagesEmoticonView","PageTransitions","PhotosUploadWaterfall","WebMessengerPreferences","React","Run","WebMessengerStateConstants","WebMessengerStateManager","Style","TabIndexDelegator","WebMessengerTemplates","TextAreaControl","MercuryThreadInformer","MercuryThreads","VaultBoxURI","Vector","WebMessengerEvents","WebMessengerForwardedMessages","WebMessengerSubscriptionsHandler","copyProperties","csx","isWebMessengerURI","tx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('ARIA'),j=b('AsyncDialog'),k=b('AsyncRequest'),l=b('Button'),m=b('MercuryConstants'),n=b('CSS'),o=b('DOM'),p=b('MercuryDraftsController').get(),q=b('Ellipsizer'),r=b('Focus'),s=b('fbt'),t=b('MercuryFolders'),u=b('Input'),v=b('Keys'),w=b('Locale'),x=b('UserAgent'),y=b('MercuryAPIArgsSource'),z=b('MercuryConfig'),aa=b('MercuryFileUploader'),ba=b('MercuryPhotoUploader'),ca=b('MercuryShareLinkUploader'),da=b('MercurySourceType'),ea=b('MercuryStickers.react'),fa=b('MercuryMessages').get(),ga=b('MessagesEmoticonView'),ha=b('PageTransitions'),ia=b('PhotosUploadWaterfall'),ja=b('WebMessengerPreferences'),ka=b('React'),la=b('Run'),ma=b('WebMessengerStateConstants'),na=b('WebMessengerStateManager'),oa=b('Style'),pa=b('TabIndexDelegator'),qa=b('WebMessengerTemplates'),ra=b('TextAreaControl'),sa=b('MercuryThreadInformer').get(),ta=b('MercuryThreads').get(),ua=b('VaultBoxURI'),va=b('Vector'),wa=b('WebMessengerEvents'),xa=b('WebMessengerForwardedMessages'),ya=b('WebMessengerSubscriptionsHandler'),za=b('copyProperties'),ab=b('csx'),bb=b('csx'),cb=b('isWebMessengerURI'),db=b('tx'),eb="_1rh";function fb(ic,jc){this._manager=ic;this._rootElement=jc;this._sendOnEnterDefault=ja.sendOnEnter;o.empty(this._rootElement);var kc=qa[':fb:web-messenger:read-view:bottom-shelf'].build();o.setContent(this._rootElement,kc.getRoot());this._bottomShelfToolbar=kc.getNode('toolbar');this._bottomShelfComposer=kc.getNode('composer');this._bottomShelfButtons=kc.getNode('buttons');this._autogrowContainer=kc.getNode('autogrowContainer');this._composerBox=kc.getNode('composerTextarea');this._composerGrid=kc.getNode('composerGrid');this._sendContainer=kc.getNode('sendContainer');this._replyButton=kc.getNode('replyButton');this._uploadingWarning=kc.getNode('uploadingWarning');this._replyButtonLabel=o.find(this._sendContainer,"._1ri");this._sendOnEnterButton=kc.getNode('sendOnEnterButton');this._loadingIndicator=kc.getNode('loadingIndicator');this._cannotReplyAlert=kc.getNode('noReplyMessage');this._ariaOwns=this._composerBox.getAttribute('aria-owns');ya.addSubscriptions(g.listen(this._autogrowContainer,'click',this.focusComposer.bind(this)),wa.subscribe(wa.UPDATE_SELECTION,hc.curry(this)),wa.subscribe(wa.FOCUS_COMPOSER,this.focusComposer.bind(this)));this._emoteWrapper=kc.getNode('emoteWrapper');this._emoticonsPanel=new ga(kc.getNode('emoticons'),this._composerBox);var lc=kc.getNode('stickers');if(lc)ka.renderComponent(ea({onStickerSelect:function(oc){sb(this,oc);}.bind(this)}),lc);this._messageSent=false;this._fileUploader=new aa(kc.getNode('attachmentShelf'),kc.getNode('attachButtonForm'),kc.getNode('fileInput'),kc.getNode('attachID'));this._forwardedMessages=new xa(kc.getNode('forwardedMessages'),kc.getNode('forwardedMessagesTitle'),kc.getNode('forwardedMessagesShelf'),kc.getNode('forwardedMessagesCloseButton'));this._shareLinkUploader=new ca(kc.getNode('shareStage'),kc.getNode('shareStageContent'),kc.getNode('shareStageLoadingIndicator'),kc.getNode('shareStageCloseButton'),this._composerBox);r.relocate(this._replyButton,this._replyButtonLabel);this._delegator=new pa(this._replyButtonLabel);o.prependContent(this._bottomShelfToolbar,this._delegator.getPlaceholder());d(['TypingDetectorController'],function(oc){this._typingDetector=new oc(null,this._composerBox,'web-messenger',null,null);gc(this);}.bind(this));this._photoUploader=new ba(this._composerGrid,kc.getNode('photoButton'),ya,kc.getNode('composer'));var mc=false;ya.addSubscriptions(this._photoUploader.subscribe('dom-updated',wa.detailDOMChanged.bind(wa)),this._photoUploader.subscribe('menu-show',function(oc,pc){if(!mc){this.waterfallStep(ia.BEGIN,pc);mc=true;}}.bind(this)),this._photoUploader.subscribe('selection-start',function(oc,pc){this.waterfallStep(ia.SELECT_START,pc);}.bind(this)),this._photoUploader.subscribe('upload-started',function(oc,pc){this.waterfallStep(ia.IMAGES_SELECTED,{method:pc.method||this._photoUploader.getCurrentMethod()});this.waterfallStep(ia.UPLOAD_START,{count:pc.imageCount});}.bind(this)),this._photoUploader.subscribe('upload-completed',function(oc,pc){var qc=this._photoUploader.getCurrentMethod();if(qc!==ia.METHOD_FILE_SELECTOR)this.waterfallStep(ia.IMAGES_SELECTED,{method:qc});for(var rc=0;rc<pc.fbids.length;++rc)this.waterfallStep(ia.ONE_UPLOAD_DONE);this._composerBox.focus();var sc="Se adjunt\u00f3 una foto a tu mensaje.";i.notify(sc);}.bind(this)),this._photoUploader.subscribe('all-uploads-completed',function(oc,pc){if(this._blockedOnUpload){vb(this,false);tb(this);}this.waterfallStep(ia.ALL_UPLOADS_DONE,pc);}.bind(this)));var nc=o.scry(this._bottomShelfToolbar,"._6q-");nc.push(kc.getNode('sendOnEnterButtonLabel'));this._ellipsizer=new q(nc);ya.addSubscriptions(this._fileUploader.subscribe('all-uploads-completed',function(){if(this._blockedOnUpload){vb(this,false);tb(this);}}.bind(this)),this._fileUploader.subscribe('upload-canceled',vb.curry(this,false)),this._fileUploader.subscribe('dom-updated',wa.detailDOMChanged.bind(wa)));this._confirmationSubscription=na.registerConfirmationBeforeStateUpdate(function(oc,pc,qc){if(!p.canSaveDrafts(this._threadID)&&cc(this)&&gb(this,pc,qc))return "No has enviado tu mensaje.";return false;}.bind(this));dc(this);ya.addSubscriptions(h.subscribe('page_transition',function(oc,pc){if(cb(pc.uri))dc(this);}.bind(this)),this._shareLinkUploader.subscribe('link-detected',wa.detailDOMChanged.bind(wa)),this._shareLinkUploader.subscribe('closed',this.focusComposer.bind(this)));ra.getInstance(this._composerBox).subscribe('resize',function(){wa.detailDOMChanged();}.bind(this));fc(this);ya.addSubscriptions(g.listen(this._replyButtonLabel,'click',tb.curry(this)),g.listen(this._replyButton,'keydown',ib.curry(this)),g.listen(this._composerBox,'keydown',ib.curry(this)),g.listen(this._sendOnEnterButton,'click',kb.curry(this)),g.listen(kc.getNode('cancelButton'),'click',wb),g.listen(kc.getNode('deleteButton'),'click',xb.curry(this)),g.listen(kc.getNode('forwardButton'),'click',bc.curry(this)),g.listen(kc.getNode('reportSpamButton'),'click',zb.curry(this)),wa.subscribe(wa.DETAIL_DOM_CHANGED,jb.curry(this)));ya.addSubscriptions(sa.subscribe('threads-updated',function(oc,pc){pc[this._threadID]&&this.updateView();}.bind(this)));}fb.prototype.waterfallStep=function(ic,jc){var kc=this._photoUploader.getWaterfallID();if(!kc)return;ia.sendSignal(za({qn:kc,step:ic,uploader:ia.APP_MESSENGER},jc||{}));};fb.prototype.hideView=function(){n.hide(this._rootElement);};fb.prototype.updateView=function(){var ic=na.getCurrentDetailState();n.show(this._rootElement);var jc=na.getCurrentStateData();gb(this,ic,jc)&&ub(this);n.hide(this._bottomShelfComposer);n.removeClass(this._bottomShelfComposer,'invisible_elem');n.hide(this._bottomShelfButtons);n.show(this._sendOnEnterButton);n.hide(this._cannotReplyAlert);mb(this,this._sendOnEnterDefault);switch(ic){case ma.DETAIL.RECENT_MESSAGES:case ma.DETAIL.SEARCH_CONTEXT:this._threadID=jc.thread_id;if(jc.message_action==ma.MESSAGE_ACTION.DELETE||jc.message_action==ma.MESSAGE_ACTION.FORWARD||jc.message_action==ma.MESSAGE_ACTION.REPORT_SPAM){ec(this,jc.message_action);}else if(this._threadID)ta.getThreadMeta(this._threadID,function(kc){if(ta.canReply(this._threadID)){n.show(this._bottomShelfComposer);fc(this);p.loadDraft(this._threadID,this._composerBox,this._fileUploader,this._shareLinkUploader,this._photoUploader);this._shareLinkUploader.check();}else{var lc=kc.recipients_loadable||kc.recipients_loadable===undefined,mc=lc?"No puedes responder a esta conversaci\u00f3n":"No puedes responder a esta conversaci\u00f3n porque es posible que la cuenta del destinatario est\u00e9 inhabilitada o su configuraci\u00f3n de privacidad no permita respuestas.";n.show(this._cannotReplyAlert);o.setContent(this._cannotReplyAlert,mc);}hb(this,kc);}.bind(this));break;case ma.DETAIL.COMPOSE_MAIN:this._threadID=null;n.show(this._bottomShelfComposer);fc(this);hb(this,null);break;default:this._threadID=null;break;}gc(this);wa.detailDOMChanged();this._state=ic;};fb.prototype.focusComposer=function(){this._composerBox.focus();};fb.prototype.submitReply=function(){tb(this);};fb.prototype.destroy=function(){this._emoticonsPanel&&this._emoticonsPanel.destroy();this._fileUploader.destroy();na.unregisterConfirmationBeforeStateUpdate(this._confirmationSubscription);};function gb(ic,jc,kc){switch(jc){case ma.DETAIL.RECENT_MESSAGES:case ma.DETAIL.SEARCH_CONTEXT:return !kc.reuse_composer&&(ic._threadID!=kc.thread_id||ic._state!=jc);case ma.DETAIL.COMPOSE_MAIN:return kc.start;case ma.DETAIL.SEARCH_SNIPPET:case ma.DETAIL.SEARCH_THREAD_SNIPPET:case ma.DETAIL.SHARED_PHOTOS:return true;}return false;}function hb(ic,jc){var kc,lc;if(!jc){kc="Enviar";lc="Escribe un mensaje...";}else if(jc.participants&&jc.participants.length<=2){kc="Responder";lc="Escribe una respuesta...";}else{kc="Responder a todos";lc="Escribe una respuesta...";}if(ic._composerBox.getAttribute('placeholder')!=lc)u.setPlaceholder(ic._composerBox,lc);l.setLabel(ic._replyButton,kc);pb(ic);}function ib(ic,event){var jc=event.getModifiers();if(jc.any&&event.keyCode!==v.RETURN)return;var kc=false;switch(event.keyCode){case v.SPACE:kc=event.getTarget()===ic._replyButton;break;case v.RETURN:var lc=!n.hasClass(ic._bottomShelfComposer,eb),mc=event.getTarget()===ic._replyButton,nc=false;if(!lc){if(x.windows()){nc=jc.control;}else if(x.osx()){nc=jc.meta;}else nc=jc.control||jc.meta;}else if(event.getModifiers().any)return;kc=mc||lc||nc;break;case v.UP:case v.DOWN:var oc=na.getCurrentDetailState();if(ic._composerBox.value||oc!=ma.DETAIL.RECENT_MESSAGES)event.stop();break;}if(kc){tb(ic);ic.focusComposer();return false;}}function jb(ic){fc(ic);nb(ic);}function kb(ic){lb(ic);var jc=!ic._sendOnEnterDefault;ic.focusComposer();ic._sendOnEnterDefault=jc;ja.sendOnEnter=jc;var kc={action:'setPreferences',send_on_enter:jc};new k('/ajax/messaging/async.php').setData(kc).send();}function lb(ic){n.toggleClass(ic._bottomShelfComposer,eb);if(n.hasClass(ic._bottomShelfComposer,eb)){ic._sendOnEnterButton.setAttribute('aria-checked','false');}else ic._sendOnEnterButton.setAttribute('aria-checked','true');pb(ic,true);wa.detailDOMChanged();}function mb(ic,jc){if(jc==n.hasClass(ic._bottomShelfComposer,eb))lb(ic);}function nb(ic){var jc;if(n.hasClass(ic._bottomShelfComposer,eb)){jc=ob(ic);}else jc=0;var kc=va.getElementDimensions(ic._bottomShelfToolbar).x;ic._ellipsizer.confineWithin(kc-jc-120);}function ob(ic){return va.getElementDimensions(ic._replyButtonLabel).x+20;}function pb(ic,jc){var kc='',lc='';if(!n.hasClass(ic._bottomShelfComposer,eb)){lc=ob(ic)+'px';kc='-1';ic._delegator.disable();}else ic._delegator.enable();n.conditionClass(ic._sendContainer,'transition',jc);ic._replyButton.setAttribute('tabindex',kc);oa.set(ic._sendContainer,w.isRTL()?'right':'left',lc);}function qb(ic){var jc=na.getCurrentStateData(),kc=fa.constructUserGeneratedMessageObject(u.getValue(ic._composerBox),da.TITAN_WEB,jc.thread_id,jc.participants),lc=ic._fileUploader.getAttachments();if(lc&&lc.length){kc.has_attachment=true;kc.raw_attachments=lc;}var mc=ic._photoUploader.getSelectedFBIDs();if(mc.length>0){kc.has_attachment=true;kc.photo_fbids=mc;}var nc=ic._fileUploader.getImageFiles();if(nc.length>0){kc.has_attachment=true;kc.image_ids=nc;}if(ic._shareLinkUploader.getAttachData()){kc.has_attachment=true;kc.content_attachment=ic._shareLinkUploader.getAttachData();}kc.forward_message_ids=ic._forwardedMessages.getForwardedMessages();kc.forward_count=kc.forward_message_ids.length;kc.force_sms=true;kc.ui_push_phase=m.UIPushPhase;return kc;}function rb(ic,jc,kc){ic.waterfallStep(ia.SESSION_POSTED);ic._sendSubscription=fa.sendMessage(jc,function(lc){ic.waterfallStep(ia.POST_PUBLISHED);if(!kc){p.clearDraft(lc);ub(ic);}ic._messageSent=true;var mc=t.getFromMeta(ta.getThreadMetaNow(lc));na.updateDetailState(ma.DETAIL.RECENT_MESSAGES,{thread_id:lc,folder:mc});ic._messageSent=false;},y.WEBMESSENGER);ic.focusComposer();}function sb(ic,jc){var kc=na.getCurrentStateData(),lc=fa.constructUserGeneratedMessageObject('',da.TITAN_WEB,kc.thread_id,kc.participants);if(!lc.thread_id&&!lc.specific_to_list.length)return;lc.has_attachment=true;lc.sticker_id=jc;rb(ic,lc,true);}function tb(ic){if(ic._fileUploader.isUploading()||ic._photoUploader.isUploading()){vb(ic,true);return;}var jc=qb(ic),kc=u.isEmpty(ic._composerBox);if((kc&&!jc.has_attachment&&!jc.forward_count)||(!jc.thread_id&&!jc.specific_to_list.length))return;n.show(ic._loadingIndicator);n.hide(ic._replyButtonLabel);ic._composerBox.setAttribute('disabled','disabled');rb(ic,jc);}function ub(ic){u.reset(ic._composerBox);fc(ic);ic._typingDetector&&ic._typingDetector.resetState();ic._fileUploader.removeAttachments();ic._forwardedMessages.clear();ic._shareLinkUploader.clear();if(ic._photoUploader.getSelectedFBIDs().length>0)ic._photoUploader.clear();n.hide(ic._loadingIndicator);n.show(ic._replyButtonLabel);ic._composerBox.removeAttribute('disabled');if(ic._sendSubscription){fa.unsubscribeSend(ic._sendSubscription);ic._sendSubscription=null;}vb(ic,false);}function vb(ic,jc){n.conditionShow(ic._uploadingWarning,jc);ic._blockedOnUpload=jc;}function wb(){var ic=na.getCurrentDetailState(),jc=na.getCurrentStateData();delete jc.message_action;na.updateDetailState(ic,jc);}function xb(ic){var jc=ic._manager.getSelectedMessageIDs().length;j.send(new k('/ajax/mercury/delete_messages_dialog.php').setData({count:jc}),function(kc){kc.subscribe('confirm',yb.curry(ic,kc));});}function yb(ic,jc){var kc=ic._manager.getSelectedMessageIDs();fa.deleteMessages(ic._threadID,kc);jc.hide();var lc=na.getCurrentStateData();if(lc.message_action){var mc=za({},lc);delete mc.message_action;na.updateDetailState(na.getCurrentDetailState(),mc);}}function zb(ic){var jc=ic._manager.getSelectedMessageIDs().length;j.send(new k('/ajax/mercury/mark_spam_messages_dialog.php').setData({count:jc}),function(kc){kc.subscribe('confirm',ac.curry(ic,kc));});}function ac(ic,jc){var kc=ic._manager.getSelectedMessageIDs();fa.markMessagesSpam(ic._threadID,kc);jc.hide();var lc=na.getCurrentStateData();if(lc.message_action){var mc=za({},lc);delete mc.message_action;na.updateDetailState(na.getCurrentDetailState(),mc);}}function bc(ic){var jc=ic._manager.getSelectedMessageIDs();if(jc.length){na.updateDetailState(ma.DETAIL.COMPOSE_MAIN,{start:true});ic._forwardedMessages.setForwardedMessages(jc);}}function cc(ic){if(ic._messageSent)return false;if(!u.isEmpty(ic._composerBox))return true;var jc=ic._fileUploader.getAttachments();if((jc&&jc.length)||ic._fileUploader.getImageFiles().length>0||ic._shareLinkUploader.getAttachData()||ic._photoUploader.getSelectedFBIDs().length>0)return true;var kc=na.getCurrentStateData(),lc=na.getCurrentDetailState(),mc=lc==ma.DETAIL.COMPOSE_MAIN||lc==ma.DETAIL.COMPOSE_TYPEAHEAD_RESULTS||lc==ma.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS;if(mc&&!kc.start&&(kc.participants||[]).length)return true;if(ic._forwardedMessages.getForwardedMessages().length)return true;return false;}function dc(ic){la.onBeforeUnload(function(){var jc=ha.getNextURI();if(!jc.getQueryData().hasOwnProperty('theater')&&!ua.isVaultBoxURI(jc))p.saveDraft(ic._threadID,ic._composerBox,ic._fileUploader,ic._shareLinkUploader,ic._photoUploader);if(!cb(jc)&&!jc.getQueryData().hasOwnProperty('theater')&&!ua.isVaultBoxURI(jc)&&cc(ic))return "No has enviado tu mensaje.";},true);la.onBeforeUnload(function(){if(cc(ic))return "No has enviado tu mensaje.";},false);la.onUnload(function(){p.saveDraft(ic._threadID,ic._composerBox,ic._fileUploader,ic._shareLinkUploader,ic._photoUploader);});}function ec(ic,jc){n.show(ic._bottomShelfComposer);n.addClass(ic._bottomShelfComposer,'invisible_elem');n.conditionClass(ic._bottomShelfButtons,'delete',jc==ma.MESSAGE_ACTION.DELETE);n.conditionClass(ic._bottomShelfButtons,'forward',jc==ma.MESSAGE_ACTION.FORWARD);n.conditionClass(ic._bottomShelfButtons,'report_spam',jc==ma.MESSAGE_ACTION.REPORT_SPAM);n.show(ic._bottomShelfButtons);}function fc(ic){oa.set(ic._emoteWrapper,w.isRTL()?'right':'left',(ic._composerBox.clientWidth+22)+'px');}function gc(ic){if(ic._typingDetector){var jc=ic._threadID,kc=null;if(jc){kc=ta.getCanonicalUserInThread(jc);var lc=z.chat_multi_typ_send,mc=ta.getThreadMetaNow(jc);if((!lc||!mc||mc.is_canonical)&&!kc)jc=null;}ic._typingDetector.setUserAndThread(kc,jc);}}function hc(ic,jc,kc){if(o.contains(ic._ariaOwns,kc))ic._composerBox.setAttribute('aria-activedescendant',kc);}e.exports=fb;});
__d("glyph",["ix"],function(a,b,c,d,e,f){e.exports=b('ix');});
__d("WebMessengerSharedPhotos.react",["AsyncRequest","Button.react","cx","copyProperties","fbt","glyph","Grid.react","LoadingIndicator.react","MessagesViewer","Pixelz.react","React","Image.react","ReactPropTypes","WebMessengerStateConstants","WebMessengerStateManager"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('Button.react'),i=b('cx'),j=b('copyProperties'),k=b('fbt'),l=b('glyph'),m=b('Grid.react'),n=b('LoadingIndicator.react'),o=b('MessagesViewer'),p=b('Pixelz.react'),q=b('React'),r=b('Image.react'),s=b('ReactPropTypes'),t=b('WebMessengerStateConstants'),u=b('WebMessengerStateManager'),v=m.GridItem,w="Volver a la conversaci\u00f3n",x=42,y=q.createClass({displayName:'WebMessengerSharedPhotos',propTypes:{threadID:s.string.isRequired,totalWidth:s.number.isRequired},getInitialState:function(){return {isLoadingMore:true,moreImages:true,imagesData:{}};},componentDidMount:function(){this.requestImages();},componentDidUpdate:function(){if(!this.isVisible())this.requestImages();},componentWillReceiveProps:function(z){if(z.threadID&&z.threadID!==this.props.threadID)this.setState({isLoadingMore:true,moreImages:true,imagesData:{}});},isVisible:function(){return !(this.state.isLoadingMore&&this.state.moreImages&&Object.keys(this.state.imagesData).length===0);},loadMoreImages:function(){if(this.state.moreImages&&!this.state.isLoadingMore){this.setState({isLoadingMore:true});this.requestImages();}},renderImages:function(){var z=Math.floor((this.props.totalWidth-x)/3),aa=Object.keys(this.state.imagesData).map(function(ba){return (v(null,q.DOM.div({className:"_5dq3",onClick:this.viewFullImage.curry(ba)},p({upscale:true,width:z,height:z,resizeMode:'cover',src:this.state.imagesData[ba].URI,borderRadius:1,insetBorderColor:"rgba(0, 0, 0, 0.1)"}))));}.bind(this));return aa;},viewFullImage:function(z){o.bootstrap(z,this.state.imagesData[z].dim,this.state.imagesData[z].URI,Object.keys(this.state.imagesData).length===1,false);new g().setURI('/ajax/messaging/attachments/sharedphotos.php').setMethod("POST").setData({thread_id:this.props.threadID,image_id:z}).send();},requestImages:function(){new g().setURI('/ajax/messaging/attachments/sharedphotos.php').setMethod("POST").setData({thread_id:this.props.threadID,offset:Object.keys(this.state.imagesData).length,limit:30}).setHandler(function(z){this.setState({isLoadingMore:false,moreImages:z.payload.moreImagesToLoad,imagesData:j({},this.state.imagesData,z.payload.imagesData)});}.bind(this)).send();},returnToThread:function(){var z=j({},u.getCurrentStateData());u.updateDetailState(t.DETAIL.RECENT_MESSAGES,z);},render:function(){var z=(q.DOM.div({className:((this.isVisible()?"_5dq2":'')+(!this.isVisible()?' '+"_5dq1":'')+(!this.isVisible()?' '+"_5dpz":''))},n({color:"white",size:"large"})));if(!this.isVisible()){return z;}else if(!this.state.isLoadingMore)z=null;return (q.DOM.div({className:"_5dpz"},q.DOM.div({className:"_5dp-"},h({image:r({src:l('back')}),label:w,size:"medium",onClick:this.returnToThread})),q.DOM.div({className:"_5dq0"},m({cols:3,fixed:false},this.renderImages()),z)));}});e.exports=y;});
__d("WebMessengerDetailViewSharedPhotosControl",["CSS","DOM","React","MercuryServerRequests","WebMessengerSharedPhotos.react","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerEvents","WebMessengerSubscriptionsHandler"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('React'),j=b('MercuryServerRequests').get(),k=b('WebMessengerSharedPhotos.react'),l=b('WebMessengerStateConstants'),m=b('WebMessengerStateManager'),n=b('WebMessengerEvents'),o=b('WebMessengerSubscriptionsHandler');function p(q,r){this.manager=q;this.rootElement=r;this.component=null;this.serverID=null;this.state=null;this.threadID=null;h.empty(this.rootElement);o.addSubscriptions(this.manager.subscribe('scrolledNearBottom',this.notifyImageRequest.bind(this)),n.subscribe(n.DETAIL_DOM_CHANGED,this.render.bind(this)));}p.prototype.hideView=function(){g.hide(this.rootElement);};p.prototype.updateView=function(){g.show(this.rootElement);this.updateStateAndData();this.render();};p.prototype.destroy=function(){o.release();};p.prototype.updateStateAndData=function(){this.state=m.getCurrentDetailState();var q=m.getCurrentStateData();this.threadID=q.thread_id;};p.prototype.render=function(){this.serverID=j.getServerThreadIDNow(this.threadID);if(!this.serverID)return;if(!this.component){this.component=k({threadID:this.serverID,totalWidth:this.rootElement.clientWidth});i.renderComponent(this.component,this.rootElement);}else this.component.setProps({threadID:this.serverID,totalWidth:this.rootElement.clientWidth});};p.prototype.notifyImageRequest=function(){var q=m.getCurrentDetailState();if(q===l.DETAIL.SHARED_PHOTOS&&this.manager.isScrolledToBottom()&&this.component)this.component.loadMoreImages();};e.exports=p;});
__d("WebMessengerJoinStatusTabSheet",["JoinStatusTabSheet","WebMessengerTemplates"],function(a,b,c,d,e,f){var g=b('JoinStatusTabSheet'),h=b('WebMessengerTemplates');for(var i in g)if(g.hasOwnProperty(i))k[i]=g[i];var j=g===null?null:g.prototype;k.prototype=Object.create(j);k.prototype.constructor=k;k.__superConstructor__=g;function k(){if(g!==null)g.apply(this,arguments);}k.prototype._getTemplate=function(){return h[':fb:web-messenger:read-view:generic-message-sheet'];};e.exports=k;});
__d("WebMessengerThreadIsMutedTabSheet",["Event","ArbiterMixin","DOM","WebMessengerTemplates","mixin"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ArbiterMixin'),i=b('DOM'),j=b('WebMessengerTemplates'),k=b("mixin"),l=k(h);for(var m in l)if(l.hasOwnProperty(m))o[m]=l[m];var n=l===null?null:l.prototype;o.prototype=Object.create(n);o.prototype.constructor=o;o.__superConstructor__=l;function o(p,q){this._rootElement=p;this._sheetView=q;}o.prototype.render=function(){var p=j[':fb:web-messenger:read-view:message-mute-sheet'].build();i.setContent(p.getNode('text'),i.tx._("Esta conversaci\u00f3n est\u00e1 desactivada. Las pesta\u00f1as de chat no se mostrar\u00e1n y las notificaciones est\u00e1n desactivadas."));i.setContent(this._rootElement,p.getRoot());g.listen(p.getNode('unmuteButton'),'click',function(){this.inform('clicked',null);}.bind(this));};o.prototype.isPermanent=function(){return false;};o.prototype.getType=function(){return 'wb-thread-is-muted';};o.prototype.open=function(){this._sheetView.open(this);};o.prototype.close=function(){this._sheetView.close(this);};e.exports=o;});
__d("WebMessengerDetailViewSheetControl",["DOM","ArbiterMixin","WebMessengerStateManager","MercurySheetView","WebMessengerTemplates","MercuryThreadInformer","MercuryThreadMuter","MercuryThreads","WebMessengerJoinStatusTabSheet","WebMessengerThreadIsMutedTabSheet","WebMessengerSubscriptionsHandler","mixin"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('ArbiterMixin'),i=b('WebMessengerStateManager'),j=b('MercurySheetView'),k=b('WebMessengerTemplates'),l=b('MercuryThreadInformer').get(),m=b('MercuryThreadMuter'),n=b('MercuryThreads').get(),o=b('WebMessengerJoinStatusTabSheet'),p=b('WebMessengerThreadIsMutedTabSheet'),q=b('WebMessengerSubscriptionsHandler'),r=b("mixin"),s=r(h);for(var t in s)if(s.hasOwnProperty(t))v[t]=s[t];var u=s===null?null:s.prototype;v.prototype=Object.create(u);v.prototype.constructor=v;v.__superConstructor__=s;function v(w){this._template=k[':fb:web-messenger:tab-sheet-container'].build();this._rootElement=this._template.getNode('sheet');this._threadID=i.getCurrentStateData().thread_id;this._sheetView=new j(this._threadID,this._rootElement,w);this._threadIsMutedTabSheet=new p(this._rootElement,this._sheetView);this._userJoinStatusSheet=new o(this._rootElement,this._sheetView);this._muteSetting=undefined;g.setContent(w,this._template.getRoot());this._threadIsMutedClickSub=this._threadIsMutedTabSheet.subscribe('clicked',function(){n.updateThreadMuteSetting(this._threadID,0);}.bind(this));q.addSubscriptions(this._sheetView.subscribe('resize',this.inform.bind(this,'resize')),l.subscribe('threads-updated',function(x,y){if(this._threadID&&y[this._threadID])this.updateTabSheet(false);}.bind(this)));this.updateTabSheet(true);}v.prototype.updateView=function(){var w=i.getCurrentStateData().thread_id;if(this._threadID!=w){this._threadID=w;this.updateTabSheet(true);}};v.prototype.updateTabSheet=function(w){if(!this._threadID)return;n.getThreadMeta(this._threadID,function(x){var y=m.getThreadMuteSettingForUser(x);if(y!=this._muteSetting||w){if(y){this._threadIsMutedTabSheet.open();}else this._threadIsMutedTabSheet.close();this._muteSetting=y;}}.bind(this));};v.prototype.openUserJoinStatusSheet=function(w){this._userJoinStatusSheet.addToQueue(w);};v.prototype.destroy=function(){this._threadIsMutedClickSub&&this._threadIsMutedClickSub.unsubscribe();};e.exports=v;});
__d("WebMessengerDetailViewControlManager",["Event","ArbiterMixin","CSS","WebMessengerDetailViewHeaderControl","DOM","DOMPosition","WebMessengerFlexibleScrollArea","WebMessengerDetailViewActionsMenuControl","WebMessengerDetailViewAllPeopleResultsControl","WebMessengerDetailViewComposeTypeaheadControl","WebMessengerDetailViewRecentMessagesControl","WebMessengerDetailViewSearchContextControl","WebMessengerDetailViewSearchSnippetsControl","WebMessengerDetailViewBottomShelfControl","WebMessengerDetailViewSharedPhotosControl","WebMessengerMessagesSelection","Parent","WebMessengerDetailViewSheetControl","WebMessengerStateManager","WebMessengerStateConstants","Style","UserAgent","WebMessengerEvents","WebMessengerSubscriptionsHandler","WebMessengerTemplates","mixin"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ArbiterMixin'),i=b('CSS'),j=b('WebMessengerDetailViewHeaderControl'),k=b('DOM'),l=b('DOMPosition'),m=b('WebMessengerFlexibleScrollArea'),n=b('WebMessengerDetailViewActionsMenuControl'),o=b('WebMessengerDetailViewAllPeopleResultsControl'),p=b('WebMessengerDetailViewComposeTypeaheadControl'),q=b('WebMessengerDetailViewRecentMessagesControl'),r=b('WebMessengerDetailViewSearchContextControl'),s=b('WebMessengerDetailViewSearchSnippetsControl'),t=b('WebMessengerDetailViewBottomShelfControl'),u=b('WebMessengerDetailViewSharedPhotosControl'),v=b('WebMessengerMessagesSelection'),w=b('Parent'),x=b('WebMessengerDetailViewSheetControl'),y=b('WebMessengerStateManager'),z=b('WebMessengerStateConstants'),aa=b('Style'),ba=b('UserAgent'),ca=b('WebMessengerEvents'),da=b('WebMessengerSubscriptionsHandler'),ea=b('WebMessengerTemplates'),fa=b("mixin"),ga=fa(h);for(var ha in ga)if(ga.hasOwnProperty(ha))ja[ha]=ga[ha];var ia=ga===null?null:ga.prototype;ja.prototype=Object.create(ia);ja.prototype.constructor=ja;ja.__superConstructor__=ga;function ja(ka){this._rootElement=ka;k.empty(this._rootElement);var la=ea[':fb:web-messenger:read-view'].build();k.setContent(this._rootElement,la.getRoot());this._readContainer=la.getNode('readContainer');this._headerControl=new j(la.getNode('detailViewHeader'));this._actionsMenuControl=new n(la.getNode('detailViewActionsMenu'));this._allPeopleResultsControl=new o(la.getNode('detailViewAllPeopleResults'));this._composeTypeaheadControl=new p(la.getNode('detailViewComposeTypeahead'),la.getNode('detailViewComposeTypeaheadResults'));this._searchContextControl=new r(this,la.getNode('detailViewSearchContext'),la.getNode('snippetPaginationControlBox'));this._searchSnippetsControl=new s(this,la.getNode('detailViewSearchSnippets'));this._sharedPhotosControl=new u(this,la.getNode('detailViewSharedPhotos'));this._sheetControl=new x(la.getNode('detailViewSheetTab'));var ma=la.getNode('detailViewBottomShelf');this._bottomShelfControl=new t(this,ma);this._detailViewScroller=la.getNode('readMessagesScroller');da.addSubscriptions(g.listen(this._detailViewScroller,'click',function(oa){if(w.byTag(oa.getTarget(),'a')||k.getSelection())return;this._bottomShelfControl.focusComposer();}.bind(this)));var na={fade:!!ba.osx(),persistent:true};this._flexArea=new m(this._detailViewScroller,na).setBottomAligned(false).setInfiniteScrollHandler(this.inform.bind(this,'scrolledNearTop'),true).setInfiniteScrollHandler(this.inform.bind(this,'scrolledNearBottom')).setContainer(this._rootElement).setMinFlexAreaHeight(200).draw();da.addSubscriptions(ca.subscribe(ca.DETAIL_DOM_CHANGED,this._flexArea.draw.bind(this._flexArea)),ca.subscribe(ca.SUBMIT_REPLY,this._bottomShelfControl.submitReply.bind(this._bottomShelfControl)),y.subscribe(z.STATE_CHANGE_EVENT,this.updateOnStateChange.bind(this)));da.addSubscriptions(this._sheetControl.subscribe('resize',this._flexArea.draw.bind(this._flexArea)));this._recentMessagesControl=new q(this,la.getNode('detailViewRecentMessages'),la.getNode('loadingSpinner'),la.getNode('noSelectedConversation'),la.getNode('newMessageLink'),la.getNode('showUnreadLink'),ma);this._stateData={};this._resizeNodes=[this._rootElement,this._detailViewScroller,k.find(this._detailViewScroller,'div.uiScrollableAreaBody')];}ja.prototype.updateOnStateChange=function(){var ka=y.getCurrentDetailState(),la=this._stateData;this._stateData=y.getCurrentStateData();this._flexArea.setTabbable(ka!==z.DETAIL.COMPOSE_MAIN);this._allPeopleResultsControl.hideView();this._composeTypeaheadControl.hideView();this._recentMessagesControl.hideView();this._searchContextControl.hideView();this._searchSnippetsControl.hideView();this._sharedPhotosControl.hideView();i.removeClass(this._readContainer,'blankComposeState');i.conditionClass(this._readContainer,'blankComposeState',ka===z.DETAIL.COMPOSE_MAIN);this._bottomShelfControl.updateView();this._actionsMenuControl.updateView();this._headerControl.updateView();switch(ka){case z.DETAIL.RECENT_MESSAGES:this._recentMessagesControl.updateView();this._sheetControl.updateView();break;case z.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:this._allPeopleResultsControl.updateView();case z.DETAIL.COMPOSE_MAIN:case z.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:this._composeTypeaheadControl.updateView();break;case z.DETAIL.SHARED_PHOTOS:this._sharedPhotosControl.updateView();break;case z.DETAIL.SEARCH_SNIPPET:case z.DETAIL.SEARCH_THREAD_SNIPPET:this._searchSnippetsControl.updateView();break;case z.DETAIL.SEARCH_CONTEXT:this._searchContextControl.updateView();break;}switch(ka){case z.DETAIL.RECENT_MESSAGES:case z.DETAIL.SEARCH_CONTEXT:if(la.thread_id!=this._stateData.thread_id)this._bottomShelfControl.focusComposer();break;}};ja.prototype.openUserJoinStatusSheet=function(ka){this._sheetControl.openUserJoinStatusSheet(ka);};ja.prototype.hideAll=function(){this._headerControl.hideView();this._actionsMenuControl.hideView();this._allPeopleResultsControl.hideView();this._composeTypeaheadControl.hideView();this._recentMessagesControl.hideView();this._searchContextControl.hideView();this._searchSnippetsControl.hideView();this._sharedPhotosControl.hideView();this._bottomShelfControl.hideView();};ja.prototype.getSelectedMessageIDs=function(){var ka=y.getCurrentDetailState();switch(ka){case z.DETAIL.RECENT_MESSAGES:case z.DETAIL.SEARCH_CONTEXT:return v.getSelectedMessageIDs();}return [];};ja.prototype.scrollIntoView=function(ka){this._flexArea&&this._flexArea.scrollIntoView(ka);};ja.prototype.setScrollTop=function(ka,la){this._flexArea&&this._flexArea.setScrollTop(ka,la);};ja.prototype.isScrolledToBottom=function(){return this._flexArea&&this._flexArea.isScrolledToBottom();};ja.prototype.scrollToBottom=function(ka){this._flexArea&&this._flexArea.scrollToBottom(ka);};ja.prototype.draw=function(){this._flexArea&&this._flexArea.draw();};ja.prototype.poke=function(){this._flexArea&&this._flexArea.poke();};ja.prototype.setScrollCallback=function(ka){this._flexArea&&this._flexArea.setScrollCallback(ka);};ja.prototype.getFlexAreaBoundingClientRect=function(){return l.getElementPosition(this._flexArea.flexArea);};ja.prototype.resizeTo=function(ka){this._resizeNodes.forEach(function(la){aa.set(la,'width',ka+'px');});ca.detailDOMChanged();};ja.prototype.destroy=function(){this._headerControl.destroy();this._actionsMenuControl.destroy();this._allPeopleResultsControl.destroy();this._composeTypeaheadControl.destroy();this._recentMessagesControl.destroy();this._searchContextControl.destroy();this._searchSnippetsControl.destroy();this._bottomShelfControl.destroy();this._sharedPhotosControl.destroy();this._flexArea.destroy();this._sheetControl.destroy();};e.exports=ja;});
__d("WebMessengerAuxMenu",["SelectableMenu","MenuSelectableItem","MenuTheme","PopoverMenuOverlappingBorder","Popover","PopoverMenu"],function(a,b,c,d,e,f){var g=b('SelectableMenu'),h=b('MenuSelectableItem'),i=b('MenuTheme'),j=b('PopoverMenuOverlappingBorder'),k=b('Popover'),l=b('PopoverMenu');function m(n,o){this._menu=new g([],{className:o,theme:i});var p=new k(n.parentNode,n,null,{alignh:'right'});new l(p,n,this._menu,[j]);}m.prototype.addOption=function(n,o){var p=new h({markup:n,title:''});p.setOnClickHandler(o);this._menu.addItem(p);return p;};m.prototype.destroy=function(){};e.exports=m;});
__d("WebMessengerMenuFolderControl",["WebMessengerAuxMenu","CSS","Parent","WebMessengerTemplates","Toggler","cx","WebMessengerSubscriptionsHandler"],function(a,b,c,d,e,f){var g=b('WebMessengerAuxMenu'),h=b('CSS'),i=b('Parent'),j=b('WebMessengerTemplates'),k=b('Toggler'),l=b('cx'),m=b('WebMessengerSubscriptionsHandler'),n,o;function p(r){return i.byClass(r,"_282");}function q(r,s,t){var u=!n||n!=s;n=s;this._template=j[':fb:web-messenger:master-view:tab-bar:menu-option'].build();this._template.setNodeContent('folderLabel',r);if(!o||u){o=new g(n,"_1j");h.show(p(n));m.addSubscriptions(k.subscribe(['show','hide'],function(v,w){var x=w.getActive(),y=x&&i.byClass(x,"_282");if(y)h.conditionClass(y,"_50p_",v==='show');}));}this._menuItem=o.addOption(this._template.getRoot(),t);this._menuItem.getRoot();}q.prototype.getCountBadge=function(){return this._template.getNode('count');};q.prototype.setSelected=function(r){h.conditionClass(p(n),'selectedFolder',r);if(r){this._menuItem.select();}else this._menuItem.deselect();};q.prototype.destroy=function(){o&&o.destroy();};e.exports=q;});
__d("MessagingFilteringNux",["Arbiter","AsyncRequest","LayerDestroyOnHide","LayerHideOnTransition","MercuryConfig","isWebMessengerURI"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('LayerDestroyOnHide'),j=b('LayerHideOnTransition'),k=b('MercuryConfig'),l=b('isWebMessengerURI'),m=null,n,o={ACCEPTED_EVENT:'filtering/accepted',DIALOG_REGISTERED_EVENT:'filtering/dialog-registered',tryShow:function(p){g.subscribe(o.DIALOG_REGISTERED_EVENT,function(){if(!m)return;m.setContext(p);m.show();m=null;},g.SUBSCRIBE_ALL);},registerDialog:function(p){m=p.disableBehavior(i).disableBehavior(j);n=g.subscribe('page_transition',function(q,r){if(!l(r.uri)){p&&p.destroy();n.unsubscribe();}},g.SUBSCRIBE_NEW);if(p)p.subscribe('confirm',function(){k.filtering_active=true;new h('/ajax/web_messenger/dismiss_filtering_nux.php').send();p.hide();g.inform(o.ACCEPTED_EVENT,{});});g.inform(o.DIALOG_REGISTERED_EVENT,{},g.BEHAVIOR_PERSISTENT);}};e.exports=o;});
__d("WebMessengerTabbedFolderControl",["Event","CSS","WebMessengerTemplates"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('WebMessengerTemplates');function j(k,l,m){this._template=i[':fb:web-messenger:master-view:tab-bar:folder'].build();this._template.setNodeContent('folderLabel',k);this._listener=g.listen(this._template.getNode('link'),'click',m);l.push(this._template.getRoot());}j.prototype.getCountBadge=function(){return this._template.getNode('count');};j.prototype.setSelected=function(k){h.conditionClass(this._template.getRoot(),'selectedFolder',k);};j.prototype.getElement=function(){this._template.getRoot();};j.prototype.destroy=function(){this._listener.remove();};e.exports=j;});
__d("WebMessengerEditFilteringSettingDialog",["AsyncDialog","AsyncRequest","MercuryConstants","DOM","csx"],function(a,b,c,d,e,f){var g=b('AsyncDialog'),h=b('AsyncRequest'),i=b('MercuryConstants'),j=b('DOM'),k=b('csx'),l='/ajax/mercury/edit_filtering_type.php',m='/ajax/mercury/change_filtering_type.php',n={show:function(){var o=function(q){var r=q.getRoot(),s=j.find(r,"._cq6").checked,t=j.find(r,"._cq7").checked,u='';if(s){u=i.MessagingFilteringType.MODERATE;}else if(t)u=i.MessagingFilteringType.STRICT;new h(m).setData({filtering_type:u}).send();q.hide();},p=function(q){q.subscribe('confirm',o.curry(q));q.show();};g.send(new h(l),p);}};e.exports=n;});
__d("WebMessengerMercury",["MercuryMessages","MercuryOrderedThreadlist","MercuryServerRequests","WebMessengerStateManager","MercuryThreadInformer","MercuryThreads","MercuryUnreadState","MercuryUnseenState"],function(a,b,c,d,e,f){var g=b('MercuryMessages'),h=b('MercuryOrderedThreadlist'),i=b('MercuryServerRequests'),j=b('WebMessengerStateManager'),k=b('MercuryThreadInformer'),l=b('MercuryThreads'),m=b('MercuryUnreadState'),n=b('MercuryUnseenState'),o={getMessages:function(){return g.getForFBID(p());},getOrderedThreadlist:function(){return h.getForFBID(p());},getServerRequests:function(){return i.getForFBID(p());},getThreadInformer:function(){return k.getForFBID(p());},getThreads:function(){return l.getForFBID(p());},getUnreadState:function(){return m.getForFBID(p());},getUnseenState:function(){return n.getForFBID(p());}};function p(){return j.getCurrentUserID();}e.exports=o;});
__d("WebMessengerMasterViewTabBarControl",["JSXDOM","Arbiter","CSS","DOM","Event","Ellipsizer","WebMessengerMenuFolderControl","MercuryConfig","MercuryFilters","MercuryFolders","MercuryThreadlistConstants","MessagingFilteringNux","MessagingTag","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTabbedFolderControl","WebMessengerTemplates","WebMessengerEditFilteringSettingDialog","WebMessengerEvents","WebMessengerSubscriptionsHandler","WebMessengerMercury","copyProperties","csx","tx"],function(a,b,c,d,e,f){var g=b('JSXDOM'),h=b('Arbiter'),i=b('CSS'),j=b('DOM'),k=b('Event'),l=b('Ellipsizer'),m=b('WebMessengerMenuFolderControl'),n=b('MercuryConfig'),o=b('MercuryFilters'),p=b('MercuryFolders'),q=b('MercuryThreadlistConstants'),r=b('MessagingFilteringNux'),s=b('MessagingTag'),t=b('WebMessengerStateConstants'),u=b('WebMessengerStateManager'),v=b('WebMessengerTabbedFolderControl'),w=b('WebMessengerTemplates'),x=b('WebMessengerEditFilteringSettingDialog'),y=b('WebMessengerEvents'),z=b('WebMessengerSubscriptionsHandler'),aa=b('WebMessengerMercury'),ba=b('copyProperties'),ca=b('csx'),da=b('tx');function ea(la,ma,na){this._manager=la;this._rootElement=ma;this._rootTopContentElement=na;this._threadInformer=aa.getThreadInformer();this._unreadState=aa.getUnreadState();j.empty(this._rootElement);var oa=w[':fb:web-messenger:master-view:tab-bar'].build(),pa=w[':fb:web-messenger:master-view:top-content'].build();j.setContent(this._rootElement,oa.getRoot());j.setContent(this._rootTopContentElement,pa.getRoot());this._tabList=oa.getRoot();this._moreMenu=oa.getNode('moreMenu');this._topContentCont=pa.getRoot();this._topContent=pa.getNode('masterViewTopContentHolder');this._closeButton=pa.getNode('masterViewTopContentCloseButton');this._closeButtonCont=pa.getNode('masterViewTopContentCloseCont');this._state=null;this._folder=null;this._filter=null;this._query=null;this._threadID=null;this._folders=p.getSupportedFolders();this._foldersToHeader={};this._filters=o.getSupportedFilters();this._filtersToHeader={};this._otherMarkAllRead=g.a({href:"#"},"Marcar todos los mensajes como le\u00eddos");this._unreadMarkAllRead=g.a({href:"#"},"Marcar todos los mensajes como le\u00eddos");this._otherEditSettings=g.a({href:"#"},"Editar preferencias");var qa=[];this._filters.forEach(function(ta){var ua=ja.curry(this,s.INBOX,ta);switch(ta){case s.UNREAD:this._filtersToHeader[ta]=this._filtersToHeader[ta]||new m("No le\u00eddos",this._moreMenu,ua);break;}}.bind(this));this._folders.forEach(function(ta){var ua=ja.curry(this,ta,o.ALL);switch(ta){case s.INBOX:this._foldersToHeader[ta]=this._foldersToHeader[ta]||new v("Bandeja de entrada",qa,ua);break;case s.OTHER:this._foldersToHeader[ta]=this._foldersToHeader[ta]||new v("Otro",qa,ua);break;case s.ACTION_ARCHIVED:this._foldersToHeader[ta]=this._foldersToHeader[ta]||new m("Archivados",this._moreMenu,ua);break;case s.SPAM:this._foldersToHeader[ta]=this._foldersToHeader[ta]||new m("Spam",this._moreMenu,ua);break;}}.bind(this));j.prependContent(this._tabList,qa);var ra=j.scry(this._tabList,"._6xt");ra.push(oa.getNode('moreMenuLabel'));this._ellipsizer=new l(ra);fa(this);var sa=ja.curry(this,s.INBOX,o.ALL);h.subscribe(r.ACCEPTED_EVENT,ia.curry(this));z.addSubscriptions(this._threadInformer.subscribe('unread-updated',ka.curry(this)),k.listen(this._otherMarkAllRead,'click',function(){this._unreadState.markFolderAsRead(s.OTHER);}.bind(this)),k.listen(this._unreadMarkAllRead,'click',function(){this._unreadState.markFolderAsRead(s.INBOX);}.bind(this)),k.listen(this._otherEditSettings,'click',function(){x.show();}),k.listen(this._closeButton,'click',sa));}ea.prototype.updateView=function(){var la=ha(this);ga(this);if(la)ia(this);fa(this);};ea.prototype.getOtherFolderLabel=function(){var la=s.OTHER,ma=this._foldersToHeader[la];if(!ma||!ma._template)return null;return ma._template.getNode('folderLabel');};ea.prototype.destroy=function(){for(var la in this._foldersToHeader)this._foldersToHeader[la]&&this._foldersToHeader[la].destroy();for(var ma in this._filtersToHeader)this._filtersToHeader[ma]&&this._filtersToHeader[ma].destroy();};function fa(la){var ma=85;j.scry(la._tabList,"._1r").forEach(function(na){ma+=na.offsetWidth;});la._ellipsizer.confineWithin(la._rootElement.offsetWidth-ma);}function ga(la){var ma=u.getCurrentStateData();la._state=u.getCurrentMasterState();la._folder=ma.folder;la._filter=ma.filter;la._query=ma.query;}function ha(la){if(!la._state||!la._folder)return true;var ma=u.getCurrentStateData();if(la._folder!=ma.folder)return true;if(la._filter!=ma.filter)return true;return false;}function ia(la){var ma=false,na;la._folders.forEach(function(oa){var pa=la._filter==s.UNREAD,qa=oa==la._folder&&(la._filter==o.ALL||pa),ra,sa;switch(oa){case s.INBOX:if(pa){var ta=g.strong(null,"No le\u00eddos"),ua=g.strong(null,"Bandeja de entrada"),va=da._("Tienes mensajes {unread} en la {inbox}",{unread:ta,inbox:ua});ra=g.div(null,va,' \u00b7 ',la._unreadMarkAllRead);sa=true;}break;case s.OTHER:var wa='';if(n.filtering_active)wa=g.span(null,la._otherEditSettings,' \u00b7 ');ra=g.div(null,g.p(null,g.strong(null,"Consejo:"+' '),"\u00bfViste un mensaje de alguien que conoces? S\u00f3lo tienes que responder o hacer clic en \"Mover a la bandeja de entrada\"."),wa,la._otherMarkAllRead);r.tryShow(la.getOtherFolderLabel());break;}if(qa){na=oa;i.conditionShow(la._closeButtonCont,sa);}else la._foldersToHeader[oa].setSelected(false);if(qa&&ra){ma=true;j.setContent(la._topContent,ra);}});la._filters.forEach(function(oa){var pa=la._folder==s.INBOX&&oa==la._filter;la._filtersToHeader[oa].setSelected(pa);});na&&la._foldersToHeader[na].setSelected(true);i.conditionShow(la._topContentCont,ma);ka(la);la._manager.draw();}function ja(la,ma,na){var oa=la._state==t.MASTER.SEARCH;if(oa||la._folder!=ma||la._filter!=na){var pa=ba({},u.getCurrentStateData()),qa=u.getCurrentDetailState();if(qa!==t.DETAIL.SEARCH_SNIPPET&&qa!==t.DETAIL.SEARCH_CONTEXT)delete pa.query;u.updateMasterState(t.MASTER.RECENT_THREADS,ba(pa,{folder:ma,filter:na}));}y.focusComposer();return false;}function ka(la){for(var ma in la._foldersToHeader){if(ma==s.ACTION_ARCHIVED)continue;var na=la._unreadState.exceedsMaxCount(ma)?q.MAX_UNREAD_COUNT+'+':la._unreadState.getUnreadCount(ma),oa=[la._foldersToHeader[ma].getCountBadge()];if(ma==s.INBOX)la._filters.forEach(function(pa){oa.push(la._filtersToHeader[pa].getCountBadge());});oa.forEach(function(pa){if(na)j.setContent(pa,j.tx._("({unread_count})",{unread_count:na}));i.conditionShow(pa,na);});}fa(la);}e.exports=ea;});
__d("MercuryLocalThreadResults",["Env","MercuryFolders","MercuryOrderedThreadlist","MercuryIDs","MercuryParticipants","MercuryThreadSearchUtils","MercuryThreads"],function(a,b,c,d,e,f){var g=b('Env'),h=b('MercuryFolders'),i=b('MercuryOrderedThreadlist').get(),j=b('MercuryIDs'),k=b('MercuryParticipants'),l=b('MercuryThreadSearchUtils'),m=b('MercuryThreads').get(),n={findMatchingThreadsFromIds:function(q,r){return r.filter(function(s){var t=m.getThreadMetaNow(s);return o(t,q);});},findMatchingThreads:function(q){var r=[];h.getSupportedFolders().forEach(function(s){r=r.concat(i.getThreadlistUntilTimestamp(0,s));}.bind(this));return this.findMatchingThreadsFromIds(q,r);}};function o(q,r){var s=p(q.participants),t=l.wordsInString(r),u=null;k.getMulti(s,function(v){u=s.map(function(w){return v[w];});});if(!u)return false;return l.allMatchPredicate(t,function(v){var w=l.anyMatchPredicate(u,function(y){return y&&y.name&&l.queryWordMatchesAnyNameWord(v,l.wordsInString(y.name));}),x=q.name&&l.queryWordMatchesAnyNameWord(v,l.wordsInString(q.name));return w||x;});}function p(q){if(q.length===1&&j.tokenize(q[0]).value===g.user)return q;return q.filter(function(r){var s=j.tokenize(r).value;return s!==g.user;});}e.exports=n;});
__d("MercurySearchThreadResults",["KeyedCallbackManager","MercuryAPIArgsSource","MercuryThreadlistConstants","RangedCallbackManager","MercuryServerDispatcher","MercuryServerRequests"],function(a,b,c,d,e,f){var g=b('KeyedCallbackManager'),h=b('MercuryAPIArgsSource'),i=b('MercuryThreadlistConstants'),j=b('RangedCallbackManager'),k=b('MercuryServerDispatcher'),l=b('MercuryServerRequests').get(),m=new g(),n=i.WEBMESSENGER_THREAD_COUNT,o=i.WEBMESSENGER_MORE_COUNT,p={getThreadlist:function(s,t){if(s){var u=m.executeOrEnqueue(s,function(x){var y=x.getAllResources(),z=x.hasReachedEndOfArray();t(y,z);}),v=m.getUnavailableResources(u),w=h.WEBMESSENGER;if(v.length)r({client:w,query:s,offset:0,limit:n+1});return u;}},isExhausted:function(s){var t=m.getResource(s);return t?t.hasReachedEndOfArray():false;},getCachedThreadlist:function(s){var t=m.getResource(s);return t?t.getAllResources():null;},cacheThreadlist:function(s,t){m.getResource(s);var u=new j();u.addResourcesWithoutSorting(t,0);u.setReachedEndOfArray();m.setResource(s,u);},getMoreThreadlist:function(s,t){if(s){var u=m.getResource(s);if(u){var v=u.getCurrentArraySize(),w=o,x=u.executeOrEnqueue(0,v+w,function(){var z=u.getAllResources(),aa=u.hasReachedEndOfArray();t(z,aa);}),y=u.getUnavailableResources(x);if(y.length)r({query:s,offset:v,limit:w+1});return x;}}},handleUpdate:function(s){if(s.mercury_payload)l.handleUpdate(s.mercury_payload);var t=s.search_threads||{};for(var u in t){var v=t[u]||[],w=v.map(l.getClientThreadIDNow.bind(l)),x=m.getResource(u);if(x){q(x,w,o+1);}else{x=new j();q(x,w,n+1);m.setResource(u,x);}}},unsubscribe:function(s,t){if(t){var u=m.getResource(t);if(u){u.unsubscribe(s);}else m.unsubscribe(s);}},setInitialCount:function(s){n=s;}};function q(s,t,u){var v=s.getCurrentArraySize(),w=t.length<u;if(!w)t.pop();s.addResourcesWithoutSorting(t,v);if(w)s.setReachedEndOfArray();}function r(s){s.client=h.WEBMESSENGER;k.trySend('/ajax/mercury/search_threads.php',s);}k.registerEndpoints({'/ajax/mercury/search_threads.php':{mode:k.IMMEDIATE,handler:p.handleUpdate}});e.exports=p;});
__d("MercurySearchThreadsStrategy",["WebMessengerConstants","MercuryLocalThreadResults","MercurySearchThreadResults","copyProperties","createObjectFrom"],function(a,b,c,d,e,f){var g=b('WebMessengerConstants'),h=b('MercuryLocalThreadResults'),i=b('MercurySearchThreadResults'),j=b('copyProperties'),k=b('createObjectFrom'),l=null,m=null,n=g.SEARCH_THREAD_DELAY,o={clearTimer:function(){l=null;clearTimeout(m);m=null;},search:function(r,s,t,u){if(r!=l){l=r;clearTimeout(m);m=null;}var v=h.findMatchingThreads(r),w=i.getCachedThreadlist(r);if(w){var x=q(v,w);s(x);t([],i.isExhausted(r));u(null,r);return;}var y=p(r),z=q(v,y.thread_ids);if(y.from_exhausted_remote_results){i.cacheThreadlist(r,z);s(z);t([],true);u(null,r);return;}s(z);m=setTimeout(function(){var aa=i.getThreadlist(r,t);u(aa,r);},n);}};function p(r){var s='',t=[];for(var u=r.length-1;u>0;u--){var v=r.slice(0,u),w=i.getCachedThreadlist(v);if(!w)continue;if(i.isExhausted(v)){return {from_exhausted_remote_results:true,thread_ids:h.findMatchingThreadsFromIds(r,w)};}else if(s.length===0){s=v;t=h.findMatchingThreadsFromIds(r,w);}}return {from_exhausted_remote_results:false,thread_ids:t};}function q(r,s){return Object.keys(j(k(r),k(s)));}e.exports=o;});
__d("WebMessengerMasterViewSearchInputControl",["Event","CSS","DOM","Input","Keys","MercurySearchThreadsStrategy","WebMessengerShortcuts","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerSubscriptionsHandler","WebMessengerEvents","cx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('DOM'),j=b('Input'),k=b('Keys'),l=b('MercurySearchThreadsStrategy'),m=b('WebMessengerShortcuts'),n=b('WebMessengerStateConstants'),o=b('WebMessengerStateManager'),p=b('WebMessengerTemplates'),q=b('WebMessengerSubscriptionsHandler'),r=b('WebMessengerEvents'),s=b('cx');function t(ba,ca){this._manager=ba;this._rootElement=ca;i.empty(this._rootElement);var da=p[':fb:web-messenger:master-view:search-input'].build();i.replace(this._rootElement,da.getRoot());this._searchBox=da.getRoot();this._searchInput=da.getNode('searchInput');this._searchClear=da.getNode('searchClear');this._searchButton=i.find(this._searchBox,'button');this._state=null;this._query=null;this._folder=null;this._threadID=null;this._ariaOwns=this._searchInput.getAttribute('aria-owns');q.addSubscriptions(r.subscribe(r.UPDATE_SELECTION,aa.curry(this)),g.listen(this._searchButton,'click',function(){var ea=j.getValue(this._searchInput);if(ea)y(this,ea);}.bind(this)),g.listen(this._searchClear,'click',x.curry(this)),g.listen(this._searchInput,'keyup',function(event){var ea=j.getValue(this._searchInput);if(event.keyCode==k.ESC){x(this);}else if(event.keyCode==k.RETURN&&ea){m.openSearchThread();}else if(ea){z(this,ea);}else if(ea!==o.getCurrentStateData().query){x(this);this.focus();}return false;}.bind(this)),g.listen(this._searchInput,'focus',function(ea){this._focused=true;}.bind(this)),g.listen(this._searchInput,'blur',function(ea){this._focused=false;}.bind(this)));}t.prototype.updateView=function(){var ba=v(this);u(this);if(ba)w(this);};t.prototype.focusAndSelectSearch=function(){y(this,j.getValue(this._searchInput));this._manager.scrollToTop(false);this.focus();this._searchInput.select();};t.prototype.focus=function(){(function(){if(!this._focused){this._searchInput.focus();this._searchInput.value=this._searchInput.value;}}).bind(this).defer();};t.prototype.destroy=function(){};function u(ba){var ca=o.getCurrentStateData();ba._state=o.getCurrentMasterState();ba._folder=ca.folder;if(ba._state!=n.MASTER.SEARCH){ba._query=null;}else ba._query=ca.query;}function v(ba){if(!ba._state||!ba._folder)return true;var ca=o.getCurrentMasterState(),da=o.getCurrentStateData();if(ba._folder!=da.folder)return true;if(ca!=ba._state)return true;if(ca==n.MASTER.SEARCH&&ba._query!=da.query)return true;return false;}function w(ba){if(ba._state==n.MASTER.SEARCH){var ca=ba._query||'';if(j.getValue(ba._searchInput)!=ca)j.setValue(ba._searchInput,ca);ba.focus();}else{j.reset(ba._searchInput);ba._searchInput.blur();}h.conditionClass(ba._searchBox,"_47",!j.isEmpty(ba._searchInput));}function x(ba){l.clearTimer();var ca=o.getCurrentStateData();ca.no_uri=true;delete ca.query;o.updateMasterState(n.MASTER.RECENT_THREADS,ca);}function y(ba,ca){var da=o.getCurrentMasterState();if(da!=n.MASTER.SEARCH)ba._threadID=o.getCurrentStateData().thread_id;if(ca)o.updateDetailState(n.DETAIL.SEARCH_SNIPPET,{query:ca,message_query:ca});}function z(ba,ca){var da=o.getCurrentStateData();if(ca!==da.query){var ea=o.getCurrentMasterState();if(ea!=n.MASTER.SEARCH)ba._threadID=da.thread_id;if(ca)o.updateMasterState(n.MASTER.SEARCH,{all_people_query:da.all_people_query,message_query:da.message_query,message_id:da.message_id,query:ca,thread_id:da.thread_id});}}function aa(ba,ca,da){if(i.contains(ba._ariaOwns,da))ba._searchInput.setAttribute('aria-activedescendant',da);}e.exports=t;});
__d("MercuryLogger",["JSLogger","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f){var g=b('JSLogger'),h=b('MercuryServerRequests').get(),i=b('MercuryThreads').get(),j=g.create('messaging_impressions');function k(event,o){j.log(event,o);}function l(o,p){var q=i.getThreadMetaNow(o);if(q){var r=h.getServerThreadIDNow(o);if(r){var event=p?'thread_search':'thread',s={is_single_thread:q.is_canonical_user,is_subscribed:q.is_subscribed,query:p||null,thread_id:r};k(event,s);}j.bump('opened_thread_'+q.folder);}}function m(o,p){var q={};p.forEach(function(r){var s=h.getServerThreadIDNow(r),t=i.getThreadMetaNow(r);if(t&&s){var u={is_single_thread:t.is_canonical_user,thread_id:s,folder:t.folder,participants:t.participants,canonical_fbid:t.canonical_fbid};q[s]=u;}});k('threadlist',{folder:o,threads:q});j.bump('opened_threadlist_'+o);}var n={logThread:function(o){l(o);},logThreadlist:function(o,p){m(o,p);},logThreadFromSearch:function(o,p){l(p,o);},logThreadlistFromSearch:function(o,p){k('threadlist_search',{folder:p,query:o});}};e.exports=n;});
__d("WebMessengerThreadlistRenderer",["CSS","DOM","Event","Focus","MercuryListUpdateRenderer","MercuryAPIArgsSource","MessagingTag","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","MercuryThreadMetadataRawRenderer","MercuryThreadMetadataRenderer","Tooltip","WebMessengerMercury","WebMessengerPermalinks","WebMessengerDeleteThreadDialog","cx","tx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('Event'),j=b('Focus'),k=b('MercuryListUpdateRenderer'),l=b('MercuryAPIArgsSource'),m=b('MessagingTag'),n=b('WebMessengerStateConstants'),o=b('WebMessengerStateManager'),p=b('WebMessengerTemplates'),q=b('MercuryThreadMetadataRawRenderer'),r=b('MercuryThreadMetadataRenderer'),s=b('Tooltip'),t=b('WebMessengerMercury'),u=b('WebMessengerPermalinks'),v=b('WebMessengerDeleteThreadDialog'),w=b('cx'),x=b('tx'),y={renderThreadsFromIDs:function(aa,ba,ca,da,ea,fa){da=da||function(ga){return ga;};ea=ea||{};k.updateList(aa,ba.map(da),function(ga){return !ea[ba[ga]]&&ba[ga]!=ca;},function(ga){var ha=ba[ga],ia=p[':fb:web-messenger:threadlist-row'].build();ia.getRoot().setAttribute('id',da(ha));var ja=ia.getNode('threadLink');j.listen(ja,function(ka){g.conditionClass(ia.getRoot(),"_5fes",ka);});i.listen(ja,'click',function(ka){if(ka.getModifiers().any)return true;var la=o.getCurrentMasterState(),ma={thread_id:ha};if(la===n.MASTER.SEARCH)ma.query=o.getCurrentStateData().query;o.updateDetailState(n.DETAIL.RECENT_MESSAGES,ma);return false;});if(ha==ca)g.addClass(ia.getRoot(),"_kv");t.getThreads().getThreadMeta(ha,function(ka){var la=r.getForFBID(o.getCurrentUserID());la.renderCoreThreadlist(ka,ia,z.curry(fa),{names_renderer:q.renderShortNames,show_unread_count:false},true);},l.WEBMESSENGER);return ia.getRoot();});}};function z(aa,ba,ca){var da=ba.getNode('readToggler'),ea=ba.getNode('archiveButton'),fa=ba.getNode('deleteButton');ba.getNode('threadLink').setAttribute('href',u.getURI(aa,n.DETAIL.RECENT_MESSAGES,{thread_id:ca.thread_id}).toString());if(ca.unread_count>0){g.addClass(ba.getRoot(),"_kx");h.setContent(ba.getNode('newCount'),h.tx._("{num} nuevo(s)",{num:ca.unread_count}));g.addClass(da,"_ky");s.set(da,"Marcar como le\u00edda",'above','right');}else{g.addClass(da,"_kz");s.set(da,"Marcar la conversaci\u00f3n como no le\u00edda",'above','right');}i.listen(da,'click',function(event){t.getThreads().changeThreadReadStatus(ca.thread_id,g.hasClass(da,"_ky"));return false;});var ga=o.getCurrentStateData().folder;if(ga==m.SPAM){s.set(fa,"Eliminar conversaci\u00f3n",'above','right');g.addClass(fa,"_4_3q");i.listen(fa,'click',function(event){v.show(ca.thread_id);});g.hide(ea);}else{g.hide(fa);var ha=true;if(ga==m.ACTION_ARCHIVED){ha=false;s.set(ea,"Desarchivar",'above','right');g.addClass(ea,"_2s2");}else{s.set(ea,"Archivar",'above','right');g.addClass(ea,"_l9");}i.listen(ea,'click',function(event){t.getThreads().changeThreadArchivedStatus(ca.thread_id,ha);var ia=o.getCurrentStateData();if(ia.thread_id==ca.thread_id)o.updateDetailState(n.DETAIL.RECENT_MESSAGES,{folder:ia.folder});return false;});}}e.exports=y;});
__d("WebMessengerMasterViewUnseenMessagesNotice",["MessagingTag","WebMessengerStateManager","UserActivity","WebMessengerSubscriptionsHandler","WebMessengerMessagesNotice","WebMessengerConstants","WebMessengerMercury","throttle"],function(a,b,c,d,e,f){var g=b('MessagingTag'),h=b('WebMessengerStateManager'),i=b('UserActivity'),j=b('WebMessengerSubscriptionsHandler'),k=b('WebMessengerMessagesNotice'),l=b('WebMessengerConstants'),m=b('WebMessengerMercury'),n=b('throttle'),o=l.THREADLIST_SCROLLTOP_OFFSET,p=l.MESSAGE_NOTICE_INACTIVITY_THRESHOLD;for(var q in k)if(k.hasOwnProperty(q))s[q]=k[q];var r=k===null?null:k.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=k;function s(x){k.call(this);this._manager=x;this._threadInformer=m.getThreadInformer();this._unseenState=m.getUnseenState();j.addSubscriptions(this._threadInformer.subscribe('messages-received',function(y,z){var aa=!i.isActive(p),ba=!this.isScrolledWithinTopThreshold();if(!r.getActive.call(this)||v(z)||!u(z))return;if(r.onlyReceivedFromSelf.call(this,z))return;if(aa){this.removeMessageNotice();this._manager.scrollToTop();}else if(ba)this.showMessageNotice();}.bind(this)),this._threadInformer.subscribe('unseen-updated',t.curry(this)));this._manager.setScrollCallback(n.withBlocking(function(y){if(r.getActive.call(this)&&y.getScrollTop()<=l.THREADLIST_TOP_OFFSET&&i.isActive(p)&&w()){this.removeMessageNotice();this._unseenState.markAsSeen();}}.bind(this),100,null));}s.prototype.isScrolledWithinTopThreshold=function(){return this._manager.getScrollTop()<=o;};s.prototype.showMessageNotice=function(){if(!w())return;var x=function(){this._manager.scrollToTop();}.bind(this);r.showMessageNotice.call(this,x,'below');};function t(x){if(x._unseenState.getUnseenCount()===0)x.removeMessageNotice();}function u(x){for(var y in x)for(var z=0;z<x[y].length;z++)if(x[y][z].folder==g.INBOX)return true;return false;}function v(x){var y=h.getCurrentStateData().thread_id,z=true;for(var aa in x)if(x.hasOwnProperty(aa))if(aa!==y){z=false;break;}return w()&&z;}function w(){var x=h.getCurrentStateData().folder;return x===g.INBOX;}e.exports=s;});
__d("WebMessengerMasterViewRecentThreadsControl",["Event","function-extensions","CSS","DOM","MercuryLogger","MercuryAPIArgsSource","MercuryFilters","MercuryFolders","MercuryThreadlistConstants","MessagingTag","WebMessengerShortcuts","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerThreadlistRenderer","UserActivity","WebMessengerConstants","WebMessengerEvents","WebMessengerInfoBoxRenderer","WebMessengerSubscriptionsHandler","WebMessengerMasterViewUnseenMessagesNotice","WebMessengerMercury","createObjectFrom","cx","ge","tx"],function(a,b,c,d,e,f){var g=b('Event');b('function-extensions');var h=b('CSS'),i=b('DOM'),j=b('MercuryLogger'),k=b('MercuryAPIArgsSource'),l=b('MercuryFilters'),m=b('MercuryFolders'),n=b('MercuryThreadlistConstants'),o=b('MessagingTag'),p=b('WebMessengerShortcuts'),q=b('WebMessengerStateConstants'),r=b('WebMessengerStateManager'),s=b('WebMessengerTemplates'),t=b('WebMessengerThreadlistRenderer'),u=b('UserActivity'),v=b('WebMessengerConstants'),w=b('WebMessengerEvents'),x=b('WebMessengerInfoBoxRenderer'),y=b('WebMessengerSubscriptionsHandler'),z=b('WebMessengerMasterViewUnseenMessagesNotice'),aa=b('WebMessengerMercury'),ba=b('createObjectFrom'),ca=b('cx'),da=b('ge'),ea=b('tx'),fa='recent:';function ga(bb,cb,db,eb){this._manager=bb;this._rootElement=cb;this._infoBox=db;this._orderedThreadlist=aa.getOrderedThreadlist();this._serverRequests=aa.getServerRequests();this._threadInformer=aa.getThreadInformer();this._threads=aa.getThreads();this._unseenState=aa.getUnseenState();i.empty(this._rootElement);this._pagerExponent=-1;var fb=s[':fb:web-messenger:threadlist'].build();i.setContent(this._rootElement,fb.getRoot());this._loadingSpinner=fb.getNode('loadingSpinner');this._threadlistRows=fb.getNode('threadlistRows');this._loadMoreButton=fb.getNode('loadMoreButton');this._loadMoreLink=fb.getNode('loadMoreLink');this._active=false;this._state=null;this._folder=null;this._filter=null;this._selection=null;this._threadIDs=[];this._unreadThreadIDs=[];this._folders=m.getSupportedFolders();this._filters=l.getSupportedFilters();this._olderTimestamp={};this._currentCountMap={};this._folders.forEach(function(gb){this._currentCountMap[gb]={};this._filters.concat([l.ALL]).forEach(function(hb){this._currentCountMap[gb][hb]=n.WEBMESSENGER_THREAD_COUNT+1;}.bind(this));}.bind(this));this._unseenMessagesNotice=new z(this._manager);this._unseenMessagesNotice.setNoticeContextNode(eb);y.addSubscriptions(this._threadInformer.subscribe('threadlist-updated',function(gb,hb){ta(this,ba(hb));}.bind(this)),this._serverRequests.subscribe('model-update-completed',function(){ya(this);}.bind(this)),g.listen(this._loadMoreLink,'click',function(){sa(this);}.bind(this)),this._manager.subscribe('scrolledNearBottom',function(){this._active&&sa(this);}.bind(this)));}ga.prototype.updateView=function(){this._active=true;this._unseenMessagesNotice.updateView();h.show(this._rootElement);var bb=ia(this),cb=ja(this),db=this._folder,eb=this._selection;ka(this);if(cb)la(this,eb);if(bb){ra(this);}else ma(this);ya(this);if(db!=this._folder)j.logThreadlist(this._folder,this._threadIDs);if(this._selection&&eb!=this._selection)j.logThread(this._selection);};ga.prototype.hideView=function(){this._active=false;this._unseenMessagesNotice.hideView();h.hide(this._rootElement);};ga.prototype.destroy=function(){ha(this);this._unseenMessagesNotice.destroy();};function ha(bb){bb._threadlistSubscription&&bb._orderedThreadlist.unsubscribe(bb._threadlistSubscription.subscriber_id,bb._threadlistSubscription.folder,bb._threadlistSubscription.filter);bb._threadlistSubscription=null;}function ia(bb){var cb=r.getCurrentStateData();if((bb._folder!=cb.folder)||(bb._filter!=cb.filter))return true;return false;}function ja(bb){var cb=r.getCurrentStateData();if(bb._selection!=cb.thread_id)return true;return false;}function ka(bb){var cb=r.getCurrentStateData();bb._state=r.getCurrentMasterState();if((bb._folder!=cb.folder)||(bb._filter!=cb.filter))bb._pageExponent=-1;bb._folder=cb.folder;bb._filter=cb.filter;bb._selection=cb.thread_id;}function la(bb,cb){var db=da(xa(cb));if(db){h.removeClass(db,"_kv");db.removeAttribute('aria-selected');}var eb=da(xa(bb._selection));if(eb){h.addClass(eb,"_kv");eb.setAttribute('aria-selected','true');}w.updateSelection(eb&&eb.id);}function ma(bb){if(bb._active)p.updateThreadlistIndex(bb,bb._threadIDs.map(xa),xa(bb._selection));}function na(bb){h.addClass(bb._manager.getFlexAreaElement(),"_3j6");h.addClass(bb._manager.getFlexAreaElement(),"_3j7");}function oa(bb){h.removeClass(bb._manager.getFlexAreaElement(),"_3j6");h.removeClass(bb._manager.getFlexAreaElement(),"_3j7");}function pa(bb){h.hide(bb._threadlistRows);oa(bb);}function qa(bb){if(bb._threadIDs.length){h.show(bb._threadlistRows);oa(bb);}else{h.hide(bb._threadlistRows);na(bb);}}function ra(bb){h.show(bb._loadingSpinner);h.hide(bb._infoBox);pa(bb);h.hide(bb._loadMoreButton);ha(bb);var cb=bb._orderedThreadlist.getFilteredThreadlist(n.RECENT_THREAD_OFFSET,bb._currentCountMap[bb._folder][bb._filter],bb._folder,bb._filter,function(db,eb){h.hide(bb._loadingSpinner);ua(bb,db,eb);qa(bb);ma(bb);bb._manager.poke();bb._manager.forceFireScrollCallbacks();},null,k.WEBMESSENGER);if(cb)bb._threadlistSubscription={subscriber_id:cb,folder:bb._folder,filter:bb._filter};}function sa(bb){if(bb._requestInFlight||h.hasClass(bb._loadMoreButton,'hidden_elem'))return;bb._requestInFlight=true;h.addClass(bb._loadMoreButton,'async_saving');bb._pagerExponent=Math.min(bb._pagerExponent+1,v.EXPONENTIAL_PAGER_MAX_CYCLES);var cb=Math.pow(2,bb._pagerExponent),db=bb._currentCountMap[bb._folder][bb._filter]+cb*(n.WEBMESSENGER_MORE_COUNT);ha(bb);var eb=bb._orderedThreadlist.getFilteredThreadlist(n.RECENT_THREAD_OFFSET,db,bb._folder,bb._filter,function(fb,gb){h.removeClass(bb._loadMoreButton,'async_saving');bb._currentCountMap[bb._folder][bb._filter]=db;ua(bb,fb,gb);ma(bb);bb._manager.poke();bb._requestInFlight=false;},null,k.WEBMESSENGER);if(eb)bb._threadlistSubscription={subscriber_id:eb,folder:bb._folder,filter:bb._filter};}function ta(bb,cb){if(!bb._folder||!bb._olderTimestamp[bb._folder])return;var db=bb._orderedThreadlist.getThreadlistUntilTimestamp(bb._olderTimestamp[bb._folder],bb._folder,bb._filter);if(bb._filter==o.UNREAD){db=wa(bb,db);}else bb._unreadThreadIDs=[];if(db.length>bb._currentCountMap[bb._folder][bb._filter])bb._currentCountMap[bb._folder][bb._filter]=db.length;bb._threadIDs=db;qa(bb);t.renderThreadsFromIDs(bb._threadlistRows,db,bb._selection,xa,cb,q.MASTER.RECENT_THREADS);ma(bb);bb._manager.poke();}function ua(bb,cb,db){var eb=(cb.length==bb._currentCountMap[bb._folder][bb._filter]);if(eb)cb.pop();if(cb.length){var fb=cb[cb.length-1];bb._threads.getThreadMeta(fb,function(gb){bb._olderTimestamp[bb._folder]=gb.timestamp;},k.WEBMESSENGER);}if(bb._filter==o.UNREAD){bb._unreadThreadIDs=cb;}else bb.unreadThreadIDs=[];h.conditionShow(bb._loadMoreButton,eb);bb._threadIDs=cb;t.renderThreadsFromIDs(bb._threadlistRows,cb,bb._selection,xa,null,q.MASTER.RECENT_THREADS);db=db&&cb.length===0;db&&va(bb);h.conditionShow(bb._infoBox,db);}function va(bb){if(bb._builtErrorMessage)return;i.setContent(bb._infoBox,x.render("No se pudo cargar la conversaci\u00f3n",[{text:"Vuelve a intentarlo",handler:ra.bind(null,bb)}]));bb._builtErrorMessage=true;}function wa(bb,cb){cb.forEach(function(db){if(bb._unreadThreadIDs.indexOf(db)<0)bb._unreadThreadIDs.push(db);});bb._unreadThreadIDs.sort(function(db,eb){var fb=bb._threads.getThreadMetaNow(db).timestamp,gb=bb._threads.getThreadMetaNow(eb).timestamp;return gb-fb;});bb._unreadThreadIDs=bb._unreadThreadIDs.filter(function(db){var eb=bb._threads.getThreadMetaNow(db);return m.getFromMeta(eb)==bb._folder;});return bb._unreadThreadIDs;}function xa(bb){if(bb)return fa+bb;return null;}function ya(bb){if(!ab(bb))return;if(u.isActive(5000)){za(bb);}else u.subscribeOnce(za.curry(bb));}function za(bb){if(ab(bb))bb._unseenState.markAsSeen();}function ab(bb){return bb._active&&bb._folder==o.INBOX&&bb._unseenMessagesNotice.isScrolledWithinTopThreshold();}e.exports=ga;});
__d("MercurySearchThreadResultOrderer",["MessagingTag","MercuryThreads","createObjectFrom"],function(a,b,c,d,e,f){var g=b('MessagingTag'),h=b('MercuryThreads').get(),i=b('createObjectFrom'),j={separateCanonicalThreadsInFolder:function(p,q){var r=[],s=[];p.forEach(function(t){var u=h.getThreadMetaNow(t);if(u.folder===q&&u.is_canonical){r.push(t);}else s.push(t);});return {canonical_in_folder:r.sort(l),remaining:s};},orderResults:function(p,q,r,s){var t=o(q,r),u=t.sort(k.curry(s));return o(p,u);}};function k(p,q,r){var s=h.getThreadMetaNow(q),t=h.getThreadMetaNow(r),u=m(s),v=m(t);if(u!==v)return n(u,p)>n(v,p)?-1:1;if(s.is_canonical!==t.is_canonical)return s.is_canonical?-1:1;return l(q,r);}function l(p,q){var r=h.getThreadMetaNow(p),s=h.getThreadMetaNow(q);return r.timestamp>s.timestamp?-1:1;}function m(p){return p.is_archived?g.ACTION_ARCHIVED:p.folder;}function n(p,q){if(p===q)return 5;var r={};r[g.INBOX]=4;r[g.ACTION_ARCHIVED]=3;r[g.OTHER]=2;r[g.SPAM]=1;return r[p];}function o(p,q){var r=i(p),s=q.filter(function(t){return !(t in r);});return p.concat(s);}e.exports=j;});
__d("WebMessengerMasterViewSearchThreadsControl",["Event","CSS","DOM","MercuryFolders","MercuryLogger","MercurySearchThreadResultOrderer","MercurySearchThreadResults","MercurySearchThreadsStrategy","WebMessengerShortcuts","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerThreadlistRenderer","WebMessengerEvents","WebMessengerMercury","WebMessengerSubscriptionsHandler","createObjectFrom","csx","cx","ge"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('DOM'),j=b('MercuryFolders'),k=b('MercuryLogger'),l=b('MercurySearchThreadResultOrderer'),m=b('MercurySearchThreadResults'),n=b('MercurySearchThreadsStrategy'),o=b('WebMessengerShortcuts'),p=b('WebMessengerStateConstants'),q=b('WebMessengerStateManager'),r=b('WebMessengerTemplates'),s=b('WebMessengerThreadlistRenderer'),t=b('WebMessengerEvents'),u=b('WebMessengerMercury'),v=b('WebMessengerSubscriptionsHandler'),w=b('createObjectFrom'),x=b('csx'),y=b('cx'),z=b('ge'),aa='search:',ba='search-indicator';function ca(ya,za,ab,bb){this._manager=ya;this._rootElement=za;this._noMessagesIndicator=bb;this._orderedThreadlist=u.getOrderedThreadlist();this._threadInformer=u.getThreadInformer();this._threads=u.getThreads();i.empty(this._rootElement);var cb=r[':fb:web-messenger:thread-search'].build();i.setContent(this._rootElement,cb.getRoot());this._loadingSpinner=cb.getNode('loadingSpinner');this._threadlistRows=cb.getNode('threadlistRows');this._loadMoreButton=cb.getNode('loadMoreButton');this._loadMoreLink=cb.getNode('loadMoreLink');var db=r[':fb:web-messenger:master-view-snippets-link'].build();this._threadSearchResultDescription=db.getNode('threadSearchResultDescription');this._searchMessagesIndicator=db.getRoot();this._searchMessagesIndicator.setAttribute('id',aa+ba);i.replace(ab,this._searchMessagesIndicator);this._snippetSearchLink=db.getNode('snippetSearchLink');this._snippetSearchLinkText=db.getNode('snippetSearchLinkText');this._active=false;this._detailState=null;this._query=null;this._folder=null;this._selection=null;this._keyboardSelection=null;this._threadIDs=[];this._oldestTimestamps=ea(this);this._namesChangedSinceLastRedraw=false;this._remoteResultsCompleted=true;v.addSubscriptions(this._threadInformer.subscribe('threadlist-updated',function(eb,fb){qa(this,w(fb));}.bind(this)),this._threadInformer.subscribe('messages-received',function(){this._namesChangedSinceLastRedraw=true;}.bind(this)),g.listen(this._loadMoreLink,'click',function(){pa(this);}.bind(this)),g.listen(this._snippetSearchLink,'click',function(){this.updateKeyboardSelection(ba);xa(this);}.bind(this)));}ca.prototype.updateView=function(){this._active=true;h.show(this._rootElement);h.hide(this._loadingSpinner);var ya=fa(this),za=ga(this),ab=this._folder,bb=this._query,cb=this._selection;ha(this);if(za||ya){var db=this._keyboardSelection;switch(this._detailState){case p.DETAIL.RECENT_MESSAGES:this._keyboardSelection=this._selection;break;case p.DETAIL.SEARCH_SNIPPET:case p.DETAIL.SEARCH_CONTEXT:this._keyboardSelection=ba;}ia(this,db);}if(ya){na(this);}else{ja(this,false);oa(this);}if(bb!=this._query||ab!=this._folder)k.logThreadlistFromSearch(this._query,this._folder);if(this._selection&&cb!=this._selection)k.logThreadFromSearch(this._query,this._selection);};ca.prototype.hideView=function(){this._active=false;h.hide(this._rootElement);ra(this,false);oa(this);};ca.prototype.openSearchThread=function(ya){if(ya==ba){xa(this);}else q.updateDetailState(p.DETAIL.RECENT_MESSAGES,{query:this._query,thread_id:ya});};ca.prototype.updateKeyboardSelection=function(ya){var za=this._keyboardSelection;this._keyboardSelection=ya;ia(this,za);};ca.prototype.destroy=function(){da(this);};function da(ya){ya._searchThreadsSubscription&&m.unsubscribe(ya._searchThreadsSubscription.subscriber_id,ya._searchThreadsSubscription.query);ya._searchThreadsSubscription=null;}function ea(ya){var za={};j.getSupportedFolders().forEach(function(ab){var bb=ya._orderedThreadlist.getThreadlistUntilTimestamp(0,ab);za[ab]=bb.length>0?ya._threads.getThreadMetaNow(bb[bb.length-1]).timestamp:Infinity;}.bind(this));return za;}function fa(ya){var za=ya._namesChangedSinceLastRedraw;ya._namesChangedSinceLastRedraw=false;if(za)return true;if(!ya._remoteResultsCompleted)return true;var ab=ea(ya),bb=ya._oldestTimestamps;ya._oldestTimestamps=ab;var cb=q.getCurrentStateData();if(ya._query!==cb.query||ya._folder!==cb.folder)return true;for(var db in bb)if(bb[db]>ab[db])return true;return false;}function ga(ya){var za=q.getCurrentStateData();if(ya._selection!=za.thread_id)return true;return false;}function ha(ya){var za=q.getCurrentStateData();ya._detailState=q.getCurrentDetailState();ya._query=za.query;ya._folder=za.folder;ya._selection=za.thread_id;}function ia(ya,za){var ab=z(va(za));if(ab){h.removeClass(ab,"_kv");ab.removeAttribute('aria-selected');}var bb=z(va(ya._keyboardSelection));if(bb){h.addClass(bb,"_kv");bb.setAttribute('aria-selected',true);}t.updateSelection(bb&&bb.id);}function ja(ya,za){if(ya._keyboardSelection&&ya._keyboardSelection!=ba&&ya._threadIDs.indexOf(ya._keyboardSelection)<0)ya._keyboardSelection=null;if(!ya._keyboardSelection)if(ya._threadIDs.length){ya._keyboardSelection=ya._threadIDs[0];}else if(!za){ya._keyboardSelection=ba;ia(ya);}var ab=ya._threadIDs.slice(0);ab.push(ba);if(ya._active)o.updateThreadlistIndex(ya,ab.map(va),va(ya._keyboardSelection));}function ka(ya){var za=i.scry(ya._threadlistRows,"._l5");za.filter(function(ab){return i.getText(ab)!==q.getCurrentStateData().folder;}).forEach(h.show.bind(h));}function la(ya){var za=i.scry(ya._threadlistRows,"._l5");za.forEach(h.hide.bind(h));}function ma(ya){ka(ya);ya._manager.draw();}function na(ya){h.show(ya._loadingSpinner);ra(ya,false);h.hide(ya._threadlistRows);h.hide(ya._loadMoreButton);la(ya);da(ya);if(ya._query){var za=[],ab=[];ya._remoteResultsCompleted=false;n.search(ya._query,function(bb){var cb=l.separateCanonicalThreadsInFolder(bb,q.getCurrentStateData().folder);za=cb.canonical_in_folder;ab=cb.remaining;wa(ya);h.show(ya._threadlistRows);ta(ya,za);ma(ya);},function(bb,cb){ya._remoteResultsCompleted=true;var db=l.orderResults(za,ab,bb,q.getCurrentStateData().folder);if(db.length>0){h.conditionShow(ya._loadMoreButton,!cb);ua(ya,db);}else sa(ya);h.hide(ya._loadingSpinner);ma(ya);},function(bb,cb){if(bb)ya._searchThreadsSubscription={subscriber_id:bb,query:cb};});}else{n.clearTimer();h.hide(ya._loadingSpinner);i.empty(ya._threadlistRows);h.show(ya._threadlistRows);ya._threadIDs=[];}oa(ya);}function oa(ya){var za=!!ya._query&&ya._active,ab=za^h.shown(ya._searchMessagesIndicator);h.conditionShow(ya._searchMessagesIndicator,za);ya._manager.sizeToFit(za);ab&&ya._manager.draw();}function pa(ya){da(ya);h.addClass(ya._loadMoreButton,'async_saving');var za=m.getMoreThreadlist(ya._query,function(ab,bb){h.removeClass(ya._loadMoreButton,'async_saving');h.conditionShow(ya._loadMoreButton,!bb);ua(ya,ab);ya._manager.poke();});if(za)ya._searchThreadsSubscription={subscriber_id:za,query:ya._query};}function qa(ya,za){if(ya._threadIDs.length){s.renderThreadsFromIDs(ya._threadlistRows,ya._threadIDs,ya._keyboardSelection,va,za,p.MASTER.SEARCH);ya._manager.poke();}}function ra(ya,za){za=za&&ya._active;h.conditionClass(ya._searchMessagesIndicator,"_33x",za!==false);h.conditionShow(ya._noMessagesIndicator,za!==false);}function sa(ya){ya._threadIDs=[];ja(ya,false);var za=i.tx._("No hay ninguna persona o conversaci\u00f3n con el nombre {query}",{query:ya._query}),ab=i.create('div',{},za);i.setContent(ya._noMessagesIndicator,ab);ra(ya,true);}function ta(ya,za){ua(ya,za,true);}function ua(ya,za,ab){ya._threadIDs=za;ja(ya,ab);s.renderThreadsFromIDs(ya._threadlistRows,za,ya._keyboardSelection,va,null,p.MASTER.SEARCH);t.updateSelection(ya._keyboardSelection);if(ya._keyboardSelection==ba)ia(ya);}function va(ya){if(ya)return aa+ya;return null;}function wa(ya){var za=i.tx._("Mostrando los resultados del nombre: {query}",{query:ya._query});i.setContent(ya._threadSearchResultDescription,za);}function xa(ya){if(ya._query){q.updateDetailState(p.DETAIL.SEARCH_SNIPPET,{query:ya._query,message_query:ya._query});t.focusSearch();}}e.exports=ca;});
__d("WebMessengerPageTitleRenderer",["DocumentTitle","MercuryAPIArgsSource","MercuryParticipants","WebMessengerStateConstants","WebMessengerStateManager","MercuryThreadMetadataRenderer","MercuryThreads","tx"],function(a,b,c,d,e,f){var g=b('DocumentTitle'),h=b('MercuryAPIArgsSource'),i=b('MercuryParticipants'),j=b('WebMessengerStateConstants'),k=b('WebMessengerStateManager'),l=b('MercuryThreadMetadataRenderer').get(),m=b('MercuryThreads').get(),n=b('tx'),o={updateTitleForState:function(r,s,t){this.withTitleForState(r,s,t||function(u){var v=k.getCurrentDetailState(),w=k.getCurrentStateData();if(r===v&&s===w)g.set(u);});},withTitleForState:function(r,s,t){switch(r){case j.DETAIL.RECENT_MESSAGES:p(s.thread_id,t);break;default:q(t);break;}}};function p(r,s){if(!r){q(s);return;}m.getThreadMeta(r,function(t){if(t.name){s(n._("{conversation_name} - Mensajes",{conversation_name:t.name}));return;}i.getMulti(t.participants,function(u){var v=l.renderParticipantList(r,u,u[i.user]?t.participants.length-1:t.participants.length,{abbr_mode:true,last_separator_uses_and:true,names_renderer:function(w){var x=[],y=Object.keys(w);if(y.length===1&&y[0]===i.user){x.push(w[y[0]].name);}else for(var z=0,aa=y.length;z<aa;z++)if(y[z]!==i.user)x.push(w[y[z]].name);return x;}});s(n._("{conversation_name} - Mensajes",{conversation_name:v}));});},h.WEBMESSENGER);}function q(r){r("Mensajes");}e.exports=o;});
__d("WebMessengerPageTitleControl",["WebMessengerPageTitleRenderer","WebMessengerStateManager","WebMessengerStateConstants","WebMessengerSubscriptionsHandler","WebMessengerEvents"],function(a,b,c,d,e,f){var g=b('WebMessengerPageTitleRenderer'),h=b('WebMessengerStateManager'),i=b('WebMessengerStateConstants'),j=b('WebMessengerSubscriptionsHandler'),k=b('WebMessengerEvents'),l=function(){var m=function(){g.updateTitleForState(h.getCurrentDetailState(),h.getCurrentStateData());};j.addSubscriptions(h.subscribe(i.STATE_CHANGE_EVENT,m),k.subscribe(k.DETAIL_DOM_CHANGED,m));};e.exports=l;});
__d("WebMessengerThreadMessagesAgent",["MercuryAPIArgsSource","MercuryMessages","MessagingTag","MercuryOrderedThreadlist","MercuryThreadInformer","MercuryThreads","WebMessengerConstants"],function(a,b,c,d,e,f){var g=b('MercuryAPIArgsSource'),h=b('MercuryMessages').get(),i=b('MessagingTag'),j=b('MercuryOrderedThreadlist').get(),k=b('MercuryThreadInformer').get(),l=b('MercuryThreads').get(),m=b('WebMessengerConstants'),n=21,o=false,p='n_inbox_n_unreads',q=m.THREADLIST_MAX_READ_PRELOAD_NUM,r=m.THREADLIST_MAX_UNREAD_PRELOAD_NUM;function s(){this._active=true;this._iterative=o;this._strategy=p;this._requestInFlight=false;this._requestIsQueued=false;this._pendingThreadIds={};this._processedThreadIds={};this._threadInformerSubscriptions=[];this._threadInformerSubscriptions.push(k.subscribe('threadlist-updated',t.curry(this)));}s.prototype.turnOn=function(){this._active=true;};s.prototype.turnOff=function(){this._active=false;};s.prototype.destroy=function(){this._threadInformerSubscriptions.forEach(k.unsubscribe);this._threadInformerSubscriptions=[];};function t(w){if(w._active&&!w._requestIsQueued){if(w._requestInFlight){w._requestIsQueued=true;return;}var x=u(w);if(x.length){w._requestInFlight=true;if(x.length>n){x=x.slice(0,n);w._requestIsQueued=true;}}x.forEach(function(y){w._processedThreadIds[y]=true;w._pendingThreadIds[y]=true;h.getThreadMessagesRange(y,0,m.INITIAL_MESSAGES_LIMIT+1,function(){v(w,y);},null,g.WEBMESSENGER);});}}function u(w){var x=j.getThreadlistUntilTimestamp(0,i.INBOX),y=x.filter(function(da){return !w._processedThreadIds[da]&&!h.hasLoadedNMessages(da,m.INITIAL_MESSAGES_LIMIT+1);});if(w._strategy===p){var z=[],aa=[];for(var ba=0;ba<y.length;ba++){var ca=l.getThreadMetaNow(y[ba]);if(ca){if(ca.unread_count&&aa.length<r)aa.push(y[ba]);if(!ca.unread_count&&z.length<q)z.push(y[ba]);if(aa.length>=r&&z.length>=q)break;}}y=z.concat(aa);}return y;}function v(w,x){if(w._pendingThreadIds[x])delete w._pendingThreadIds[x];if(Object.keys(w._pendingThreadIds).length===0){if(!w._iterative)w._active=false;w._requestInFlight=false;if(w._requestIsQueued){w._requestIsQueued=false;t(w);}}}e.exports=s;});
__d("WebMessengerAdsControl",["Arbiter","CSS","DOM","EgoAdsObjectSet","Env","Event","KeyedCallbackManager","MercuryParticipants","UIPagelet","URI","UserActivity","Vector","WebMessengerStateManager","cx","shield","MercuryThreads","WebMessengerSubscriptionsHandler","copyProperties","csx","throttle","WebMessengerConstants"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('EgoAdsObjectSet'),k=b('Env'),l=b('Event'),m=b('KeyedCallbackManager'),n=b('MercuryParticipants'),o=b('UIPagelet'),p=b('URI'),q=b('UserActivity'),r=b('Vector'),s=b('WebMessengerStateManager'),t=b('cx'),u=b('shield'),v=b('MercuryThreads').get(),w=b('WebMessengerSubscriptionsHandler'),x=b('copyProperties'),t=b('cx'),y=b('csx'),z=b('throttle'),aa=b('WebMessengerConstants'),ba=aa.ADS_ROTATION_INTERVAL_PASSIVE,ca=aa.ADS_ROTATION_THRESHOLD_ACTIVE,da=aa.MAX_ADS,ea=2,fa=165,ga='data-height',ha=new m(),ia='webMessengerAdsStage',ja=0;function ka(){}x(ka,{init:function(){this._ads=new j();this._initializedAds=false;this._loadingCount=null;this._stage=null;this._drawCount=0;this._lastRefresh=0;this._pageletInProgress=null;this._lastMousedOnAds=false;this._waitOn(['codes','container','sidebar','footer'],this.start.bind(this));w.addSubscriptions(q.subscribe(u(this._refreshIfReady,this)),g.subscribe('footerLoaded',function(){ha.setResource('footer',1);}),g.subscribe(['sidebar/initialized','sidebar/show','sidebar/hide'],this._sideBarChanged.bind(this)),ha);return this;},setContainer:function(ra){ha.setResource('container',ra);this._container=ra;},setTrackingCodes:function(ra){ha.setResource('codes',ra);},getTrackingCodes:function(){return ha.getResource('codes');},start:function(){this._stage=i.create('div',{id:ia,className:"_2rn"});this._ego=i.find(this._container,"._81");i.insertAfter(this._ego,this._stage);this._updateFooterHeight();this.waitForAdsLoad(this._container,this._processOnPageUnits.bind(this));w.addSubscriptions(l.listen(window,'resize',z(this.draw,100,this)),l.listen(this._ego,'mouseenter',u(this._mouseEvent,this,true)),l.listen(this._ego,'mouseleave',u(this._mouseEvent,this,false)));},stateChanged:function(ra,sa){ra=ra||{};sa=sa||{};if(ra.thread_id&&sa.thread_id&&sa.thread_id!==ra.thread_id)this._refreshIfReady(true);},draw:function(){var ra=this._loadingCount<=0;if(!this._initializedAds||!this._drawCount&&!ra)return;this._adjustAdsToFit();},_processOnPageUnits:function(){this._ads.init(pa(this._ego));this._initializedAds=true;this._adjustAdsToFit();},_processStagedUnits:function(){this._pageletInProgress=false;var ra=pa(this._stage);if(!this._lastMousedOnAds&&ra.length&&!this._focusedOnAds()){i.empty(this._ego);while(this._stage.childNodes.length)i.appendContent(this._ego,this._stage.firstChild);this._ads.init(ra);this._lastRefresh=Date.now();this._adjustAdsToFit();}},waitForAdsLoad:function(ra,sa){var ta=pa(ra);this._loadingCount=ta.length;if(!this._loadingCount){this._lastRefresh=Date.now()-ba/2;this._pageletInProgress=false;return;}var ua=function(va){oa(va);if(--this._loadingCount<=0)sa();}.bind(this);ta.forEach(function(va){function wa(){ua.curry(va).defer();}var xa=i.scry(va,'img.img')[0];if(!xa||xa.complete){wa();}else l.listen(xa,{load:wa,error:wa,abort:wa});}.bind(this));},_adjustAdsToFit:function(){this._drawCount++;var ra=r.getViewportDimensions().y,sa=ra-this._footerHeight-fa,ta=sa,ua=0;while(ta>0&&ua<this._ads.getCount()){ta-=na(this._ads.getUnit(ua));if(ta>=0)ua++;}ua=Math.max(ua,ea);for(var va=0;va<this._ads.getCount();va++)ma(this._ads.getUnit(va),va>=ua);h.conditionShow(this._ego,ua);h.addClass(this._ads.getUnit(0),'ego_unit_no_top_border');var wa=i.scry(this._container,'.ego_section');wa.forEach(function(xa){la(xa,i.scry(xa,'[data-onscreen]').length);});la(this._container,true);this._registerImpressions(ua);this._registerHoldoutImpressions(sa);},_waitOn:function(ra,sa){ha.executeOrEnqueue(ra,sa);},_mouseEvent:function(ra){this._lastMousedOnAds=ra;},_focusedOnAds:function(){return i.contains(this._container,document.activeElement);},_refreshIfReady:function(ra){var sa=ra?ca:ba;if(this._lastRefresh===0){this._lastRefresh=Date.now();return;}else if(this._pageletInProgress||!this._drawCount||this._lastMousedOnAds||this._focusedOnAds()||this._lastRefresh+sa>Date.now())return;ha.reset();this._waitOn(['codes'],this.waitForAdsLoad.bind(this,this._stage,this._processStagedUnits.bind(this)));this._pageletInProgress=o.loadFromEndpoint('WebEgoPane',ia,{pid:43,data:[k.user,da,++ja,qa()]},{crossPage:true,bundle:false});},_updateFooterHeight:function(){h.hide(this._ego);this._footerHeight=r.getElementDimensions(this._container).y;h.show(this._ego);},_registerImpression:function(ra){var sa=this.getTrackingCodes();if(!sa||!sa[ra])return;var ta=i.create('iframe',{src:p('/ai.php').addQueryData({aed:sa[ra]}),width:0,height:0,frameborder:0,scrolling:'no',className:'fbEmuTracking'});ta.setAttribute('aria-hidden','true');i.appendContent(this._container,ta);delete sa[ra];},_registerImpressions:function(ra){for(var sa=ra-1;sa>=0;--sa){if(!this._ads.getUnit(sa))continue;var ta=i.scry(this._ads.getUnit(sa),"div._4u8");if(!ta.length)continue;var ua=ta[0].getAttribute('data-ad'),va=JSON.parse(ua).adid,wa=this.getTrackingCodes();if(!wa||!wa[va])return;this._registerImpression(va);}},_registerHoldoutImpressions:function(ra){var sa=this._ads.getHoldoutAdIDsForSpace(ra,na);if(sa)sa.forEach(this._registerImpression.bind(this));},_sideBarChanged:function(ra,sa){if(ra=='sidebar/initialized')ha.setResource('sidebar',1);this._initializedAds&&this.draw();}});function la(ra,sa){h.conditionClass(ra,"_2rn",!sa);}function ma(ra,sa){h.conditionClass(ra,"_22r",sa);ra.setAttribute('aria-hidden',sa?'true':'false');if(sa){ra.removeAttribute('data-onscreen');}else ra.setAttribute('data-onscreen','1');}function na(ra){if(!ra)return 0;var sa=ra.getAttribute(ga)||oa(ra);return parseInt(sa,10);}function oa(ra){var sa=r.getElementDimensions(ra).y;ra.setAttribute(ga,sa);return sa;}function pa(ra){return i.scry(ra,'div.ego_unit');}function qa(){var ra=s.getCurrentStateData();if(ra.thread_id){var sa=v.getThreadMetaNow(ra.thread_id);if(sa)return sa.participants.map(n.getUserID).filter(function(ta){return ta&&ta!=k.user;});}return [];}e.exports=ka;});
__d("WebMessengerApp",["Arbiter","WebMessengerDetailViewControlManager","DOM","WebMessengerMasterViewControlManager","WebMessengerPageTitleControl","PageTransitions","WebMessengerPermalinks","MercuryServerRequests","WebMessengerShortcuts","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerStateStore","MercuryThreadInformer","WebMessengerThreadMessagesAgent","URI","VaultBoxURI","WebMessengerAdsControl","emptyFunction","WebMessengerSubscriptionsHandler","WebMessengerWidthControl","clickRefAction","userAction","MercuryStateCheck","WebMessengerTemplates"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('WebMessengerDetailViewControlManager'),i=b('DOM'),j=b('WebMessengerMasterViewControlManager'),k=b('WebMessengerPageTitleControl'),l=b('PageTransitions'),m=b('WebMessengerPermalinks'),n=b('MercuryServerRequests').get(),o=b('WebMessengerShortcuts'),p=b('WebMessengerStateConstants'),q=b('WebMessengerStateManager'),r=b('WebMessengerStateStore'),s=b('MercuryThreadInformer').get(),t=b('WebMessengerThreadMessagesAgent'),u=b('URI'),v=b('VaultBoxURI'),w=b('WebMessengerAdsControl'),x=b('emptyFunction'),y=b('WebMessengerSubscriptionsHandler'),z=b('WebMessengerWidthControl'),aa=b('clickRefAction'),ba=b('userAction');b('MercuryStateCheck');var ca=b('WebMessengerTemplates');d(['VideoCallCore'],x);var da,ea;d(['VaultBox'],function(la){ea=la.getInstance();});function fa(la,ma){var na=ma&&ma.getQueryData().hasOwnProperty('theater'),oa=ma&&v.isVaultBoxURI(ma);if(na){da=g.subscribe('PhotoSnowlift.CLOSE',ga.curry(la),g.SUBSCRIBE_NEW);return false;}else if(oa){if(ea)da=ea.subscribe('close',ga.curry(la),g.SUBSCRIBE_NEW);return false;}var pa=m.processURI(ma);if(pa){var qa=q.getCurrentStateData();if(pa.redirect){m.goNextURI(pa.master_state,pa.detail_state,pa.data,pa.replace);}else q.updateStateOnURI(pa.master_state,pa.detail_state,pa.data);l.transitionComplete();la._adsControl.stateChanged(qa,q.getCurrentStateData());return true;}ka(la);return false;}function ga(la){l.registerHandler(fa.curry(la),6);if(da){da.unsubscribe();da=null;}}function ha(){var la=q.getCurrentStateData();r.setLastSeen(la.folder,la.thread_id);}function ia(la,ma,na,oa,pa){y.engage();ga(this);g.inform('chat/set_does_page_occlude_tabs',true,g.BEHAVIOR_PERSISTENT);g.inform('chat/set_show_tab_unread_ui',false,g.BEHAVIOR_PERSISTENT);new t();n.handleUpdate(ma);i.empty(la);var qa=ca[':fb:web-messenger:page-skeleton'].build();i.setContent(la,qa.getRoot());o.registerGeneralShortcuts();this._masterViewManager=new j(qa.getNode('masterView'));this._detailViewManager=new h(qa.getNode('detailView'));this._pageTitleControl=new k();oa&&i.prependContent(qa.getRoot(),oa);this._widthControl=new z(this._masterViewManager.resizeTo.bind(this._masterViewManager),this._detailViewManager.resizeTo.bind(this._detailViewManager),pa);this._adsControl=w.init();var ra=na?new u(na):m.getDefaultURI();fa(this,ra);aa('web_messenger').set_namespace('web_messenger');ba('web_messenger').uai('load').add_event('tti',0,window._cstart);y.addSubscriptions(s.subscribe('threads-deleted',function(sa,ta){var ua=q.getCurrentStateData().thread_id,va=q.getCurrentDetailState();if(va==p.DETAIL.RECENT_MESSAGES&&ta[ua]){q.updateDetailState(p.DETAIL.RECENT_MESSAGES,{thread_id:null});}else ha();}),q.subscribe(p.STATE_CHANGE_EVENT,ha));d(['MercuryBrowserAlerts'],function(sa){y.addSubscriptions(s.subscribe('messages-received',function(ta,ua){for(var va in ua){var wa=ua[va];for(var xa=0;xa<wa.length;xa++)sa.messageReceived(wa[xa]);}}));sa.subscribe('before-alert',function(ta,event){if(event.threadID==ja())event.cancelAlert();});});}function ja(){var la=q.getCurrentDetailState(),ma=q.getCurrentStateData();if(la==p.DETAIL.RECENT_MESSAGES||la==p.DETAIL.SEARCH_CONTEXT)return ma.thread_id;return null;}function ka(la){var ma=true;d(['ChatTabModel'],function(na){ma&&na.persistLocalRaised();});y.release();g.inform('chat/set_does_page_occlude_tabs',false,g.BEHAVIOR_PERSISTENT);g.inform('chat/set_show_tab_unread_ui',true,g.BEHAVIOR_PERSISTENT);la._masterViewManager.destroy();la._detailViewManager.destroy();ma=false;}e.exports=ia;});
__d("WebMessengerComposerDataSource",["MercuryConstants","ExpandableDataSource","MercuryIDs","WebMessengerStateManager"],function(a,b,c,d,e,f){var g=b('MercuryConstants'),h=b('ExpandableDataSource'),i=b('MercuryIDs'),j=b('WebMessengerStateManager');for(var k in h)if(h.hasOwnProperty(k))m[k]=h[k];var l=h===null?null:h.prototype;m.prototype=Object.create(l);m.prototype.constructor=m;m.__superConstructor__=h;function m(q){q=q||{};q.kanaNormalization=true;h.call(this,q,g.MercuryTypeaheadConstants.COMPOSER_THREADS_INITIAL_LIMIT,g.MercuryTypeaheadConstants.COMPOSER_SHOW_MORE_LIMIT);this._maxResults=g.MercuryTypeaheadConstants.COMPOSER_FRIENDS_MAX+g.MercuryTypeaheadConstants.COMPOSER_THREADS_INITIAL_LIMIT+g.MercuryTypeaheadConstants.COMPOSER_NON_FRIENDS_MAX;this._statesPerTokens={};this.subscribe('fetchComplete',function(r,s){var t=s.fetch_context,u=s.response.getPayload().entries;if(t.bootstrap)p(u);});}m.prototype.buildData=function(q){var r=[],s=[],t=[],u=[];q.forEach(function(w){var x=l.getEntry.call(this,w);switch(x.render_type){case g.MercuryTypeaheadConstants.FRIEND_TYPE:if(r.length<g.MercuryTypeaheadConstants.COMPOSER_FRIENDS_MAX)r.push(w);break;case g.MercuryTypeaheadConstants.THREAD_TYPE:s.push(w);break;case g.MercuryTypeaheadConstants.NON_FRIEND_TYPE:if(t.length<g.MercuryTypeaheadConstants.COMPOSER_NON_FRIENDS_MAX)t.push(w);break;case g.MercuryTypeaheadConstants.FB4C_TYPE:if(u.length<g.MercuryTypeaheadConstants.COMPOSER_FRIENDS_MAX)u.push(w);break;}}.bind(this));var v=r.concat(u,s,t);if(!this.hasLoadedAllResults()){this._maxResults=v.length+1;}else this._maxResults=v.length;return l.buildData.call(this,v);};m.prototype.query=function(q,r,s){this.value=q;l.query.call(this,q,r,s);};m.prototype.getQueryData=function(q,r){var s=l.getQueryData.call(this,q,r);s.existing_token_ids=o();return s;};m.prototype.getStates=function(){var q=n();if(!this._statesPerTokens[q])this._statesPerTokens[q]={};return this._statesPerTokens[q];};m.prototype.fetchHandler=function(q,r){this.getState('loaded_all_threads_per_query')[r.value]=q.getPayload().end_of_threads;this.getState('loaded_initial_per_query')[r.value]=true;l.fetchHandler.call(this,q,r);};m.prototype.hasLoadedInitialResults=function(q){if(q===undefined)q=this.value;return this.getState('loaded_initial_per_query')[q];};m.prototype.hasLoadedAllResults=function(q){if(q===undefined)q=this.value;return this.getState('loaded_all_threads_per_query')[q];};function n(){var q=o().sort();return ','+q.join(',');}function o(){var q=j.getCurrentStateData();return (q.participants||[]).map(function(r){return i.tokenize(r).value;});}function p(q){q.forEach(function(r){r.render_type=g.MercuryTypeaheadConstants.FRIEND_TYPE;});}e.exports=m;});