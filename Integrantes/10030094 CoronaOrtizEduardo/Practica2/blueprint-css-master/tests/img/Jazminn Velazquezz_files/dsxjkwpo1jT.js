/*!CK:1901001038!*//*1379427310,178138187*/

if (self.CavalryLogger) { CavalryLogger.start_js(["ux1Of"]); }

__d("VideoUploader_DEPRECATED",["ArbiterMixin","AsyncRequest","copyProperties","Dialog","ErrorDialog","UserAgent","VideoUploadLogger","WaterfallIDGenerator","DOM","Run","submitForm","tx"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('AsyncRequest'),i=b('copyProperties'),j=b('Dialog'),k=b('ErrorDialog'),l=b('UserAgent'),m=b('VideoUploadLogger'),n=b('WaterfallIDGenerator'),o=b('DOM'),p=b('Run'),q=b('submitForm'),r=b('tx');function s(t){this._minSize=t.min_size;this._maxSize=t.max_size;this._extensions=t.extensions;this._source=t.source;this._targetID=t.target_id;this._loggingDelay=t.logging_delay;this._isUploadInProgress=false;}i(s.prototype,g,{isVideoFile:function(t){return !!this._extensions[this._getFileExtension(t)];},upload:function(t,u){this._fileForm=t;this._fileInput=u;this._fileSize=this._getFileSize(this._fileInput);this._fileExtension=this._getFileExtension(this._fileInput);this._videoID=null;this._sentBytes=0;this._totalBytes=0;var v=n.generate();o.find(t.getRoot(),"input[name='qn']").value=v;this._logger=new m({source:this._source,waterfall_id:v,target_id:this._targetID,delay:this._loggingDelay});var w={file_size:this._fileSize,file_extension:this._fileExtension};this._logger.logEvent(m.EVENT_REQUESTED_UPLOADING,w);if(!this._validateFormat()||!this._validateSize()){this.inform('file-invalidated');return;}this._subscriptions=[t.subscribe('submit',this._handleUploadSubmitted.bind(this)),t.subscribe('progress',this._handleUploadProgress.bind(this)),t.subscribe('initial',this._handleUploadResponded.bind(this)),t.subscribe('success',this._handleUploadSucceeded.bind(this)),t.subscribe('failure',this._handleUploadFailed.bind(this))];p.onLeave(this._cancelUpload.bind(this));this._isUploadInProgress=true;this._logger.logEvent(m.EVENT_STARTED_UPLOADING,w);q(this._fileForm.getRoot());},showCancelDialog:function(){new j().setTitle("Cancelar subida").setBody("\u00bfEst\u00e1s seguro de que deseas cancelar?").setButtons(j.CONFIRM,j.CANCEL).setHandler(this._handleUploadCanceled.bind(this)).setModal(true).show();},_cancelUpload:function(){if(this._isUploadInProgress)this._handleUploadCanceled();},_validateFormat:function(){if(!this._extensions[this._fileExtension]){k.show("Formato de archivo no compatible","El archivo que seleccionaste tiene un formato que no es compatible. Utiliza uno de nuestros \u003Ca href=\"http:\/\/www.facebook.com\/help\/?faq=218673814818907#What-formats-of-video-files-can-I-upload?\">formatos recomendados\u003C\/a> para archivos de video.");this._logger.logEvent(m.EVENT_FAILED_UPLOADING,{error_code:1363024,error_description:'Unsupported Video Format',file_extension:this._fileExtension,file_size:this._fileSize});return false;}return true;},_validateSize:function(){if(this._fileSize!==null&&this._fileSize<this._minSize){k.show("El archivo de video es demasiado peque\u00f1o",r._("El archivo de video que intentaste subir es demasiado peque\u00f1o. El tama\u00f1o m\u00ednimo para los archivos de video es de \u003Cb>{min-size} KB\u003C\/b>. Vuelve a intentar con un archivo de mayor tama\u00f1o.",{'min-size':Math.round(this._minSize/1024)}));this._logger.logEvent(m.EVENT_FAILED_UPLOADING,{error_code:1363022,error_description:'Video File Too Small',file_size:this._fileSize});return false;}if(this._fileSize!==null&&this._fileSize>this._maxSize){k.show("El archivo de video es demasiado grande",r._("El archivo de video que intentaste subir es demasiado grande. El tama\u00f1o m\u00e1ximo para los archivos de video es de \u003Cb>{max-size} MB\u003C\/b>. Vuelve a intentar con un archivo de menor tama\u00f1o.",{'max-size':Math.round(this._maxSize/1024/1024)}));this._logger.logEvent(m.EVENT_FAILED_UPLOADING,{error_code:1363023,error_description:'Video File Too Large',file_size:this._fileSize});return false;}return true;},_handleUploadSubmitted:function(t,u){if(this._shouldLogSendingBytesEvents())this._logger.logEvent(m.EVENT_STARTED_SENDING_BYTES,{file_size:this._fileSize});this.inform('upload-submitted',u);},_handleUploadProgress:function(t,u){if(u.event.lengthComputable&&this._shouldLogSendingBytesEvents()){this._sentBytes=u.event.loaded;this._totalBytes=u.event.total;if(this._sentBytes===this._totalBytes)this._logger.logEvent(m.EVENT_FINISHED_SENDING_BYTES,{sent_bytes:this._sentBytes,file_size:this._fileSize});}this.inform('upload-progressed',u);},_handleUploadResponded:function(t,u){this._logger.logEvent(m.EVENT_RECEIVED_RESPONSE,{file_size:this._fileSize});this.inform('upload-responded',u);},_handleUploadSucceeded:function(t,u){this._isUploadInProgress=false;this._videoID=u.response.getPayload().video_id;this._logger.logEvent(m.EVENT_FINISHED_UPLOADING,{video_id:this._videoID,file_size:this._fileSize});this.inform('upload-succeeded',u);this._cleanup();},_handleUploadFailed:function(t,u){this._isUploadInProgress=false;this._logger.logEvent(m.EVENT_FAILED_UPLOADING,{error_code:u.response.error,error_description:u.response.errorSummary,file_size:this._fileSize});if(this._shouldLogSendingBytesEvents()&&(this._sentBytes<this._totalBytes))this._logger.logEvent(m.EVENT_FAILED_SENDING_BYTES,{sent_bytes:this._sentBytes,total_bytes:this._totalBytes,file_size:this._fileSize});k.show(u.response.errorSummary,u.response.errorDescription);this.inform('upload-failed',u);this._cleanup();},_handleUploadCanceled:function(t,u){this._fileForm.abort();this._isUploadInProgress=false;if(this._videoID)new h('/ajax/video/actions/delete').setData({fbid:this._videoID,redirect:false}).send();this._logger.logEvent(m.EVENT_CANCELED_UPLOADING,{video_id:this._videoID,file_size:this._fileSize});if(this._shouldLogSendingBytesEvents()&&(this._sentBytes<this._totalBytes))this._logger.logEvent(m.EVENT_CANCELED_SENDING_BYTES,{sent_bytes:this._sentBytes,total_bytes:this._totalBytes,file_size:this._fileSize});this.inform('upload-canceled',u);},_cleanup:function(){this._subscriptions.forEach(function(t){t.unsubscribe();});},_getFileSize:function(t){if(!t.files||!t.files[0])return null;return t.files[0].size;},_getFileExtension:function(t){return t.value.split('.').pop().toLowerCase();},_shouldLogSendingBytesEvents:function(){return l.chrome()>=25;}});e.exports=s;});