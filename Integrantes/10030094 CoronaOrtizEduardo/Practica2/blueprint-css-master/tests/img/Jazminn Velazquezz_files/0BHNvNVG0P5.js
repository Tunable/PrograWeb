/*!CK:1611128197!*//*1377492027,178191641*/

if (self.CavalryLogger) { CavalryLogger.start_js(["4Cb22"]); }

__d("LayerPageContent.react",["React","cx"],function(a,b,c,d,e,f){var g=b('React'),h=b('cx'),i=g.createClass({displayName:'ReactLayerPageContent',render:function(){var j=(("uiLayerPageContentWrap")+(!this.props.useCustomPadding?' '+"uiLayerPageDefaultPadding":''));return (g.DOM.div({className:"uiLayerPageInner"},g.DOM.div({className:"uiLayerPage uiOverlay"},g.DOM.div({className:"uiOverlayContent"},g.DOM.div({className:j},g.DOM.div({className:"uiLayerPageContent"},this.props.children))))));}});e.exports=i;});
__d("LayerPageNavigationController",["Arbiter","DOM","PageTransitions","React","URI","UserAgent","arrayContains","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('DOM'),i=b('PageTransitions'),j=b('React'),k=b('URI'),l=b('UserAgent'),m=b('arrayContains'),n=b('copyProperties');function o(r){return r.length>=1&&r[r.length-1];}var p={constructLayer:function(){},getLayerPageContainerClass:function(){},setupLink:function(r,s){this._linkHandlers=this._linkHandlers||{};var t=k(s.href).getUnqualifiedURI().toString();this._linkHandlers[t]=r.display.bind(r,s.type,s.id,s.name,t,s.source,s.viewer_id);this._registerHandler();},_registerHandler:function(){if(!this._registeredHandler){i.registerHandler(this._handleTransition.bind(this),6);this._registeredHandler=true;}},_onBack:function(){if(this._popping)return;this._popping=true;var r=this._stack.pop();this._forwardStack.push(r);var s=-1;while(this._stack.length&&o(this._stack).isSnowlift()){r=this._stack.pop();this._forwardStack.push(r);g.inform('LayerPageNavigation/pop');s--;}this._rerender();this._poppingTransition=isNaN(l.opera());window.history.go(s);},_rerender:function(){var r=this.getLayerPageContainerClass();j.renderComponent(r({onBack:this._onBack.bind(this),onPopComplete:function(){this._popping=false;}.bind(this),stack:this._stack.slice()}),this._layerRoot);},_isSnowliftURI:function(r){return r.getUnqualifiedURI().setQueryData({}).toString()==='/photo.php';},_handleTransition:function(r){if(this._poppingTransition){this._poppingTransition=false;return this._transitionHandled();}if(this._forceTransitionComplete){this._forceTransitionComplete=false;return this._transitionHandled();}var s=r.getUnqualifiedURI().removeQueryData(['closeTheater']).toString();this._stack=this._stack||[];this._forwardStack=this._forwardStack||[];var t=this._stack.length,u=o(this._stack);if(u&&s===u.getPermalink()){this._forwardStack=[];return this._isSnowliftURI(r)?this._transitionHandledBySnowlift():this._transitionHandled();}var v=t>=2&&this._stack[t-2].getPermalink();if(v&&s===v){this._forwardStack.push(this._stack.pop());if(this._isSnowliftURI(r)){return this._transitionHandledBySnowlift();}else{g.inform('LayerPageNavigation/pop');this._rerender();return this._transitionHandled();}}if(this._isSnowliftURI(r)){var w=new q(this,{permalink:r,isSnowlift:true},{},{});this._stack.push(w);return this._transitionHandledBySnowlift();}var x=o(this._forwardStack);if(x&&s===x.getPermalink()){this._handlingForwardNavigation=true;this._forwardStack.pop().getShowFunction()();return this._transitionHandled();}if(t===1&&s===this._initialURI){this._forwardStack.push(this._stack.pop());g.inform('LayerPageNavigation/pop');this._layer.hide();return this._transitionHandled();}var y=this._linkHandlers[s];if(y){y();return this._transitionHandled();}this._layer&&this._layer.hide();return this._transitionNotHandled();},_transitionHandled:function(){if(this._isInSnowlift){this._isInSnowlift=false;this._registeredHandler=false;this._registerHandler();return false;}this._isInSnowlift=false;i.transitionComplete();return true;},_transitionNotHandled:function(){this._linkHandlers={};this._stack=[];this._forwardStack=[];this._registeredHandler=false;this._isInSnowlift=false;return false;},_transitionHandledBySnowlift:function(){this._isInSnowlift=true;this._registeredHandler=false;this._registerHandler();return false;},show:function(r,s,t){this._stack=this._stack||[];this._forwardStack=this._forwardStack||[];var u=new q(this,r,s,t);this._stack.push(u);g.inform('LayerPageNavigation/push');if(!this._layer){this._layerRoot=h.create('div');this._rerender();this._layer=this.constructLayer(r,this._layerRoot).show();this._layer.subscribe('hide',function(){var v=o(this._stack),w=i.getNextURI().getUnqualifiedURI().removeQueryData(['closeTheater']).toString();if(v&&v.getPermalink()===w){this._forceTransitionComplete=true;i.go(this._initialURI);}g.inform('LayerPageNavigation/hide');this._layer=null;this._stack=[];}.bind(this));this._initialURI=i.getMostRecentURI().getUnqualifiedURI().toString();}else this._rerender();if(this._handlingForwardNavigation)this._handlingForwardNavigation=false;return u;},getCurrentLayer:function(){return this._layer;}};function q(r,s,t,u){this._navigationInstance=r;this._config=s;this._header=t;this._body=u;}n(q.prototype,{getLayer:function(){return this._navigationInstance._layer;},getHeader:function(){return this._header;},getBody:function(){return this._body;},getPermalink:function(){if(this._hasSetPermalink)return this._config.permalink;this._hasSetPermalink=true;this._config.permalink=k(this._config.permalink).getUnqualifiedURI().removeQueryData(['closeTheater']).toString();return this._config.permalink;},getShowFunction:function(){return this._config.show;},update:function(r,s){if(!m(this._navigationInstance._stack,this))return;this._header=r||this._header;this._body=s||this._body;this._navigationInstance._rerender();},isSnowlift:function(){return this._config.isSnowlift===true;}});e.exports=p;});
__d("LayerPageNavigationMixin",["Animation","CSS","ScrollableArea","Style","UserAgent","queryThenMutateDOM","throttle"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('CSS'),i=b('ScrollableArea'),j=b('Style'),k=b('UserAgent'),l=b('queryThenMutateDOM'),m=b('throttle'),n=300,o=150,p;if(k.ie()<=8){p=function(r,s,t,u){j.apply(r,{opacity:s,marginLeft:t+'px'});u&&u();};}else p=function(r,s,t,u){new g(r).to('opacity',s).to('margin-left',t+'px').duration(n).ease(g.ease.both).ondone(u).go();};var q={_fadeOut:function(r,s,t){j.apply(r,{position:'absolute',top:'0',width:r.offsetWidth+'px'});var u=s==='left'?-o:o;p(r,0,u,function(){h.hide(r);j.apply(r,{position:'',top:'',width:''});t&&t();});},_fadeIn:function(r,s,t){h.show(r);j.apply(r,{marginLeft:(s==='left'?-o:o)+'px',opacity:'0'});p(r,1,0,t);},_updateMainNode:function(r){if(this._mainNode===r||!this.refs.shadow)return;this._mainNode=r;if(this._scrollSubscription){this._scrollSubscription.unsubscribe();this._scrollSubscription=null;}this._scrollableArea=i.getInstance(r);if(!this._scrollableArea){this.setState({shadow:false});return;}var s,t=m(l.bind(null,function(){s=this._scrollableArea.getScrollTop()>0;}.bind(this),function(){if(s!==this.state.shadow)this.setState({shadow:s});}.bind(this)));t();this._scrollSubscription=this._scrollableArea.subscribe('scroll',t);},_toggleBack:function(r){var s=this.refs.back.getDOMNode();if(r){h.show(s);new g(s).from('opacity',0).to('opacity',1).ease(g.ease.both).duration(n).go();}else{j.set(s,'position','absolute');new g(s).from('opacity',1).to('opacity',0).duration(n).ease(g.ease.both).ondone(function(){h.hide(s);j.set(s,'position','');}).go();}},componentDidUpdate:function(r){var s=this.state.stack,t=this.props.stack,u=r.stack;if(u.length===1&&t.length>1){this._toggleBack(true);}else if(u.length>1&&t.length===1)this._toggleBack(false);var v=this.refs.headers.getDOMNode().childNodes,w=this.refs.bodies.getDOMNode().childNodes,x=w.length;if(t.length>u.length){this._fadeOut(v[x-2],'left');this._fadeOut(w[x-2],'left');this._fadeIn(v[x-1],'right');this._fadeIn(w[x-1],'right');this._updateMainNode(w[x-1]);}else if(t.length<s.length){var y=4,z=function(){if(--y===0){this._updateStack(t);this._updateMainNode(w[x-2]);this.props.onPopComplete&&this.props.onPopComplete();}}.bind(this);this._fadeOut(v[x-1],'right',z);this._fadeOut(w[x-1],'right',z);this._fadeIn(v[x-2],'left',z);this._fadeIn(w[x-2],'left',z);}else if(s.length===1)this._updateMainNode(this.refs.bodies.getDOMNode().childNodes[0]);},componentWillReceiveProps:function(r){if(r.stack.length>this.state.stack.length)this._updateStack(r.stack);},_updateStack:function(r){this.setState({stack:r.slice()});},getInitialState:function(){return {shadow:false,stack:this.props.stack};}};e.exports=q;});
__d("HashtagLayerPageBody",["Arbiter","DOM","React","LegacyScrollableArea.react","XUISpinner.react","cx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('DOM'),i=b('React'),j=b('LegacyScrollableArea.react'),k=b('XUISpinner.react'),l=b('cx'),m=i.createClass({displayName:'HashtagLayerPageBody',_onScroll:function(){g.inform('dom-scroll');},getInitialState:function(){return {contentLoaded:false};},componentWillReceiveProps:function(n){if(n.body&&!this.props.body)this.setState({contentLoaded:true});},componentDidUpdate:function(n){if(this.props.body&&!n.body)h.setContent(this.refs.content.getDOMNode(),this.props.body);},render:function(){var n;if(!this.state.contentLoaded)n=k({className:"_59vj",size:"large"});return (j({fade:true,onScroll:this._onScroll,width:"600"},n,i.DOM.div({className:"_59vk",ref:"content"})));}});e.exports=m;});
__d("HashtagLayerPageContainer",["LayerPageContent.react","LayerPageNavigationMixin","React","cx"],function(a,b,c,d,e,f){var g=b('LayerPageContent.react'),h=b('LayerPageNavigationMixin'),i=b('React'),j=b('cx'),k=i.createClass({displayName:'HashtagLayerPageContainer',mixins:[h],render:function(){var l=this.state.stack,m=[],n=[];l.forEach(function(o){m.push(o.getHeader());n.push(o.getBody());});return (g({showCloseButton:"true",useCustomPadding:"true"},i.DOM.div({className:"_59vm"},i.DOM.a({className:"_59vo hidden_elem",onClick:this.props.onBack,ref:"back"},i.DOM.i({className:"_5a8a"})),i.DOM.a({className:"_59vp layerCancel"},i.DOM.i({className:"_59vq"})),i.DOM.div({className:"_59vn",ref:"headers"},m)),i.DOM.div({className:"_5gmg",ref:"bodies"},n)));}});e.exports=k;});
__d("LayerPage",["Arbiter","CSS","DOM","Layer","LayerButtons","LayerFormHooks","LayerHideOnTransition","LayerMouseHooks","LayerTabIsolation","ModalLayer","Style","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('Layer'),k=b('LayerButtons'),l=b('LayerFormHooks'),m=b('LayerHideOnTransition'),n=b('LayerMouseHooks'),o=b('LayerTabIsolation'),p=b('ModalLayer'),q=b('Style'),r=b('copyProperties');for(var s in j)if(j.hasOwnProperty(s))u[s]=j[s];var t=j===null?null:j.prototype;u.prototype=Object.create(t);u.prototype.constructor=u;u.__superConstructor__=j;function u(){if(j!==null)j.apply(this,arguments);}u.prototype._configure=function(x,y){if(x.width)this._width=Math.floor(x.width);if(x.bottomMargin!==undefined)this._bottomMargin=x.bottomMargin;t._configure.call(this,x,y);};u.prototype._getDefaultBehaviors=function(){return t._getDefaultBehaviors.call(this).concat([w,k,l,m,n,o,p]);};u.prototype.updatePosition=function(){var x=i.find(this.getRoot(),'div.uiLayerPage');if(this._width){var y=i.find(x,'div.uiLayerPageContentWrap'),z=this._width;if(h.hasClass(y,'uiLayerPageDefaultPadding'))z+=2*v;q.set(x,'width',z+'px');}return true;};u.prototype.getContentRoot=function(){if(!this._contentRoot)this._contentRoot=i.find(this.getRoot(),'.uiOverlayContent');return this._contentRoot;};u.prototype.getBottomMargin=function(){return this._bottomMargin;};var v=15;r(u.prototype,{_width:null,_bottomMargin:null});function w(x){this._layer=x;}w.prototype.enable=function(){this._subscription=this._layer.subscribe(['show','hide'],function(x,y){if(x==='show'){g.inform('layer_shown',{type:'LayerPage'});}else g.inform('layer_hidden',{type:'LayerPage'});});};w.prototype.disable=function(){this._subscription.unsubscribe();this._subscription=null;};r(w.prototype,{_subscription:null});e.exports=u;});
__d("LayerPageFitHeight",["DOMQuery","Event","Style","Vector","debounce"],function(a,b,c,d,e,f){var g=b('DOMQuery'),h=b('Event'),i=b('Style'),j=b('Vector'),k=b('debounce'),l=40,m=300;function n(o){this._layer=o;this._listener=null;this._subscription=null;this._bottomMargin=o.getBottomMargin();if(this._bottomMargin===null)this._bottomMargin=l;}n.prototype.enable=function(){this._listener=h.listen(window,'resize',k(this._handle.bind(this)));var o=this._layer.getContentRoot();this._wrap=g.find(o,'div.uiLayerPageContentWrap');this._inner=g.find(this._layer.getRoot(),'div.uiLayerPageInner');this._content=g.find(this._wrap,'div.uiLayerPageContent');this._footer=g.scry(o,'div.uiLayerPageFooter')[0]||null;this._subscription=this._layer.subscribe('show',this._handle.bind(this));};n.prototype.disable=function(){this._listener&&this._listener.remove();this._subscription&&this._subscription.unsubscribe();this._listener=this._subscription=null;this._wrap=this._content=this._inner=this._footer=null;};n.prototype._handle=function(){var o=j.getElementPosition(this._content).y,p=j.getViewportDimensions().y,q=0;if(this._footer)q=j.getElementDimensions(this._footer).y;var r=p-o-q-this._bottomMargin,s=Math.max(m,r);i.set(this._wrap,'height',s+'px');i.set(this._inner,'paddingBottom',this._bottomMargin+'px');this._layer.inform('resize',{height:s});};e.exports=n;});
__d("HashtagLayerPageController",["AsyncRequest","CSS","DOM","HashtagLayerPageBody","HashtagLayerPageContainer","LayerFadeOnHide","LayerHideOnBlur","LayerHideOnEscape","LayerHideOnTransition","LayerPage","LayerPageFitHeight","LayerPageNavigationController","Parent","React","UIPagelet","XUISpinner.react","copyProperties","csx","cx"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('CSS'),i=b('DOM'),j=b('HashtagLayerPageBody'),k=b('HashtagLayerPageContainer'),l=b('LayerFadeOnHide'),m=b('LayerHideOnBlur'),n=b('LayerHideOnEscape'),o=b('LayerHideOnTransition'),p=b('LayerPage'),q=b('LayerPageFitHeight'),r=b('LayerPageNavigationController'),s=b('Parent'),t=b('React'),u=b('UIPagelet'),v=b('XUISpinner.react'),w=b('copyProperties'),x=b('csx'),y=b('cx'),z={};w(z,r,{display:function(aa,ba,ca,da,ea,fa){var ga=function(){var ha=t.DOM.div({className:"_51ox"},ca),ia=z.show({permalink:da,show:ga},ha,j(null));new g('/ajax/pubcontent/covisit').setData({id:ba}).setHandler(this._similarTagsResponse.bind(this,ha.getDOMNode())).send();var ja=i.create('div');u.loadFromEndpoint('ViewHashtagLegacyPagelet',ja,{id:ba,viewer_id:fa},{displayCallback:function(ka){ia.update(null,j({body:ja}));ka();}});}.bind(this);ga();},_similarTagsResponse:function(aa,ba){var ca=ba.payload;if(ca===null||typeof ca==='undefined'||ca.length===0)return;for(var da in ca){var ea=i.create('a',{className:"_56h0",href:ca[da].link},ca[da].name);i.appendContent(aa,ea);}},constructLayer:function(aa,ba){w(aa,{addedBehaviors:[l,m,n,q],width:600,bottomMargin:0});return new p(aa,ba).disableBehavior(o);},getLayerPageContainerClass:function(){return k;},toggleClick:function(aa){var ba=s.byClass(aa,"_5bhk");if(ba)return;var ca=s.byClass(aa,"_5bhl"),da=s.byClass(ca,"_5bhm"),ea=i.find(da,"._5bhk");h.removeClass(ca,"_5bhl");h.addClass(ca,"_5bhk");h.removeClass(ea,"_5bhk");h.addClass(ea,"_5bhl");var fa=JSON.parse(aa.getAttribute('data-pub')),ga=i.find(aa,"^.uiPubContentStream .uiPubContentStories");t.renderComponent(t.DOM.div({className:"_46__"},v({size:"large"})),ga);u.loadFromEndpoint(fa.pagelet,ga,{id:fa.id,sort:fa.sort,stories_only:true});}});e.exports=z;});