/*!CK:4271793740!*//*1379296135,173224515*/

if (self.CavalryLogger) { CavalryLogger.start_js(["CnlPT"]); }

__d("StarsInput",["Event","ArbiterMixin","DOM","Parent","Run","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ArbiterMixin'),i=b('DOM'),j=b('Parent'),k=b('Run'),l=b('copyProperties');function m(n,o){this.root=n;this.hidden=o;this.stars=i.scry(n,'span');this.listeners=[g.listen(this.root,'click',this._onClick.bind(this))];k.onLeave(this.destroyListeners.bind(this));}l(m.prototype,h,{_onClick:function(event){var n=this._getStarIndexFromEvent(event);if(!n)return;this.hidden.value=n;this.inform('stars/value_changed');},_getStarIndexFromEvent:function(event){var n=j.byTag(event.getTarget(),'span');if(n)return this.stars.indexOf(n)+1;return 0;},destroyListeners:function(){this.listeners.forEach(function(n){n&&n.remove();});this.listeners=[];}});a.StarsInput=e.exports=m;});
__d("StarsRatableBase",["Event","CSS","DOM","Parent","Run","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('DOM'),j=b('Parent'),k=b('Run'),l=b('copyProperties');function m(n,o,p){this.root=n;this.freezeOnClick=o;this.stars=i.scry(n,'span');this.listeners=[g.listen(this.root,'click',this._onClick.bind(this)),g.listen(this.root,'mousemove',this._onMouseMove.bind(this)),g.listen(this.root,'mouseout',this._onMouseOut.bind(this))];this.holdMouseMove=false;this.setRating(p);k.onLeave(this.destroyListeners.bind(this));}m.init=function(n,o,p){return new m(n,o,p);};l(m.prototype,{_onClick:function(event){var n=this._getStarIndexFromEvent(event);if(!n)return;this.setRating(n);if(this.freezeOnClick){this.freeze();}else this.holdMouseMove=true;},_onMouseMove:function(event){if(this.holdMouseMove)return;var n=this._getStarIndexFromEvent(event);if(!n)return;this.setStars(n,true);},_onMouseOut:function(event){this.holdMouseMove=false;this.updateStars();},_getStarIndexFromEvent:function(event){var n=j.byTag(event.getTarget(),'span');if(n)return this.stars.indexOf(n)+1;return 0;},setRating:function(n){this._rating=n;this.updateStars();},updateStars:function(){this.setStars(this._rating);},setStars:function(n,o){var p=o?'hoverStar':'fullStar',q=o?'fullStar':'hoverStar';for(var r=0;r<this.stars.length;++r){h.removeClass(this.stars[r],q);var s=(r>=n);h.conditionClass(this.stars[r],p,!s);h.conditionClass(this.stars[r],'emptyStar',s);}},freeze:function(){h.addClass(this.root,'uiStarsRated');this.destroyListeners();},destroyListeners:function(){this.listeners.forEach(function(n){n&&n.remove();});this.listeners=[];}});a.StarsRatableBase=e.exports=m;});
__d("PageRecommendationInlineComposer",["Event","DOM","CSS"],function(a,b,c,d,e,f){var g=b('Event'),h=b('DOM'),i=b('CSS'),j={initControls:function(k,l,m){var n=h.scry(k,'textarea')[0];n&&g.listen(n,'focus',function(){i.addClass(n,'expand');l&&i.show(l);});g.listen(m,'click',function(){n.focus();});},clearTextarea:function(k){var l=h.find(document.body,'#'+k),m=h.scry(l,'textarea[name="note_message"]')[0];m.value='';}};e.exports=j;});
__d("EgoCollectionsRecommendation",["Arbiter","AsyncRequest","DOM","DOMClone","Tooltip","csx","isEmpty"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('DOM'),j=b('DOMClone'),k=b('Tooltip'),l=b('csx'),m=b('isEmpty'),n={},o={},p=1500;function q(t,u){new h(t).setHandler(function(v){if(!v.payload)return;var w=null;for(var x in u){if(!w){i.setContent(u[x],v.payload.icon);w=(u[x]).firstChild;}else i.setContent(u[x],w=j.shallowClone(w));k.set(w,v.payload.tooltip);}}).send();}function r(t,u,event,v){if(v.category!==t)return;var w=o[t];if(!m(w))q.curry(u,w).defer(p);}var s={keepIconSynced:function(t,u,v){if(!n[v])n[v]=g.subscribe('AudienceSelector/syncNonSelectorIcon',r.curry(v,u));o[v]||(o[v]={});o[v][t.id]=t;},replaceOrInsertTopUnit:function(t,u){if(!t)return;var v=i.find(t,'^.ego_unit_container'),w=i.scry(v,"._53ee");if(w[0]){i.replace(w[0],u);}else i.prependContent(v,u);}};e.exports=s;});
__d("FBSSurveyWrapper",[],function(a,b,c,d,e,f){function g(h){this.instance=h;}g.prototype.getSurvey=function(){return this.instance;};a.FBSSurveyWrapper=e.exports=g;});
__d("SSurvey",["ArbiterMixin","AsyncRequest","CSS","csx","DOM","mixin","highlight"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('AsyncRequest'),i=b('CSS'),j=b('csx'),k=b('DOM'),l=b('mixin'),m=b('highlight'),n=l(g);for(var o in n)if(n.hasOwnProperty(o))q[o]=n[o];var p=n===null?null:n.prototype;q.prototype=Object.create(p);q.prototype.constructor=q;q.__superConstructor__=n;function q(r,s,t,u,v,w){this.id=r;this.questions={};this.context=u;if(!t)t={};this.init(s,t,v,w);}q.prototype.init=function(r,s,t,u){this.form=r;this.currentQuestions=s;this.finishedQuestions={};this.subscriptions=[];if(u)m.highlight(this.form.controller);this.subscriptions.push(r.subscribe('submit',function(){this.informSurveyAdvance();}.bind(this)));for(var v in s){var w=s[v];this.questions[v]=w;t=t&&w&&w.hasLogicalFinish();if(w)this.subscriptions.push(w.subscribeFinished(this.updateQuestionStatus.bind(this,w,true)));}if(t){this.hideFooter();}else this.showFooter();this.autosubmit=t?true:false;};q.prototype.destroy=function(){while(this.subscriptions.length)this.subscriptions.pop().unsubscribe();};q.prototype.getID=function(){return this.id;};q.prototype.getQuestion=function(r){return this.questions[r];};q.prototype.getCurrentQuestions=function(){return this.questions;};q.prototype.shouldAutosubmit=function(){return this.autosubmit;};q.prototype.getForm=function(){return this.form;};q.prototype.getContextData=function(){return this.context;};q.prototype.getQuestionValues=function(){var r={};for(var s in this.currentQuestions){var t=this.currentQuestions[s];if(t)r[s]=t.getValue();}return r;};q.prototype.hideFooter=function(){var r=k.find(this.form.getRoot(),"._5k72");if(r)i.hide(r);};q.prototype.showFooter=function(){var r=k.find(this.form.getRoot(),"._5k72");if(r)i.show(r);};q.prototype.updateQuestionStatus=function(r,s){if(!s){delete this.finishedQuestions[r.getID()];return;}this.finishedQuestions[r.getID()]=true;var t=Object.keys(this.finishedQuestions).length,u=Object.keys(this.currentQuestions).length;if(this.autosubmit&&t===u)this.submit();};q.prototype.informSurveyAdvance=function(){this.inform('survey/advance',this.getQuestionValues());};q.prototype.subscribeSurveyAdvance=function(r){return this.subscribe('survey/advance',r);};q.prototype.submit=function(r){var s=this.form.getRoot(),t=new FormData(s),u=new h().setMethod('POST').setURI('/ajax/survey/simon/process/').setRawData(t).setRelativeTo(s);if(r)u.setHandler(r);u.send();this.informSurveyAdvance();};a.SSurvey=e.exports=q;});
__d("SSurveyController",[],function(a,b,c,d,e,f){var g={registerSurvey:function(h,i){if(!this.surveys)this.surveys={};var j=this.getSurvey(h);if(!j){this.surveys[h]=i;}else{j.init(i.getForm(),i.getCurrentQuestions(),i.shouldAutosubmit());i.destroy();}},getSurvey:function(h){if(!this.surveys)this.surveys={};return this.surveys[h];}};e.exports=g;});
__d("SSurveyDataReportController",["reportData","AsyncRequest"],function(a,b,c,d,e,f){var g=b('reportData'),h=b('AsyncRequest'),i={registerDataReport:function(j,k){var l=j.getSurvey();l.subscribeSurveyAdvance(function(m,n){var o=Object.keys(n);if(o==null||o.length!=1)return;var p=n[o[0]];if(p==null||p.length!=1)return;var q=parseInt(p[0],10);if(q<1||q>5)return;var r=k.context_data,s="star"+q,t={mf_story_key:r.mf_story_key,qid:r.qid,question_oid:o[0],survey_id:l.id};g(s,{ft:t});var u=k.viewstate_data;new h().setURI('/ajax/survey/infeed/report').setData(u).send();});}};e.exports=i;});
__d("SSurveyQuestionBase",["ArbiterMixin","mixin"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('mixin'),i=h(g);for(var j in i)if(i.hasOwnProperty(j))l[j]=i[j];var k=i===null?null:i.prototype;l.prototype=Object.create(k);l.prototype.constructor=l;l.__superConstructor__=i;function l(m){this.id=m;}l.prototype.getID=function(){return this.id;};l.prototype.getValue=function(){return null;};l.prototype.informValueChanged=function(){this.inform('survey/question/changed',this.getValue());};l.prototype.informFinished=function(){this.inform('survey/question/finished');};l.prototype.subscribeValueChanged=function(m){return this.subscribe('survey/question/changed',m);};l.prototype.subscribeFinished=function(m){return this.subscribe('survey/question/finished',m);};l.prototype.hasLogicalFinish=function(){return false;};a.SSurveyQuestionBase=e.exports=l;});
__d("SSurveyQuestionStarsInline",["Run","SSurveyQuestionBase"],function(a,b,c,d,e,f){var g=b('Run'),h=b('SSurveyQuestionBase');for(var i in h)if(h.hasOwnProperty(i))k[i]=h[i];var j=h===null?null:h.prototype;k.prototype=Object.create(j);k.prototype.constructor=k;k.__superConstructor__=h;function k(l,m){j.constructor.call(this,l);this.stars=m;this.listener=m.subscribe('stars/value_changed',this.onclick.bind(this));g.onLeave(this.destroyListeners.bind(this));}k.prototype.hasLogicalFinish=function(){return true;};k.prototype.getValue=function(){if(this.stars.hidden.value!=null)return [this.stars.hidden.value];return null;};k.prototype.onclick=function(event){this.destroyListeners();this.informValueChanged();this.informFinished();};k.prototype.destroyListeners=function(){if(this.listener)this.listener.unsubscribe();this.listener=null;};a.SSurveyQuestionStarsInline=e.exports=k;});